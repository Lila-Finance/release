import{c as yr,g as H0,a as fe,e as kr,b as V0,w as Il,r as xl,f as uc,t as ha,d as K0,h as B0,i as vi,D as G0,k as W0,N as se,j as J0,l as rc,m as Q0,V as Y0,R as X0,F as bh,K as Z0,x as e1,L as t1,n as Eh,$ as r1,p as i1,o as Gn,Z as Ih,J as n1,X as s1,E as hc,_ as Sl,q as Fr,s as a1,u as o1,v as on,y as Dt,U as tr,z as yi,A as ur,B as c1,C as cn,G as Pl,H as u1,I as h1,M as l1,O as Ol,P as f1,Q as Cl,S as Al,T as hn,W as ic,Y as na,a0 as ln,a1 as p1,a2 as sa,a3 as d1,a4 as g1,a5 as y1,a6 as ea,a7 as v1,a8 as _1,a9 as zo,aa as xh,ab as m1,ac as w1,ad as b1,ae as Sh,af as E1,ag as I1,ah as x1,ai as S1,aj as P1,ak as O1,al as C1,am as Hn,an as Rl,ao as Uo,ap as A1,aq as R1,ar as T1}from"./index-6f9f7e15.js";import{s as lc,i as Ph,c as N1,a as F1,b as Tl,f as fc,p as D1,J as mi,d as pc,e as dc,g as gc,h as gi,j as ii,k as Bn,l as j1,m as $1,H as qi}from"./http-b205c032.js";var la={},Nl={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(h){var i,r,s,a,l,m,b,I,T,M,Y,X,Z,B,ee,ce,me,ge,pe,he,le,q,V;(function(F){var ue=typeof yr=="object"?yr:typeof self=="object"?self:typeof this=="object"?this:{};F(f(ue,f(h.exports)));function f(v,_){return v!==ue&&(typeof Object.create=="function"?Object.defineProperty(v,"__esModule",{value:!0}):v.__esModule=!0),function(S,y){return v[S]=_?_(S,y):y}}})(function(F){var ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var _ in v)v.hasOwnProperty(_)&&(f[_]=v[_])};i=function(f,v){ue(f,v);function _(){this.constructor=f}f.prototype=v===null?Object.create(v):(_.prototype=v.prototype,new _)},r=Object.assign||function(f){for(var v,_=1,S=arguments.length;_<S;_++){v=arguments[_];for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(f[y]=v[y])}return f},s=function(f,v){var _={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&v.indexOf(S)<0&&(_[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,S=Object.getOwnPropertySymbols(f);y<S.length;y++)v.indexOf(S[y])<0&&Object.prototype.propertyIsEnumerable.call(f,S[y])&&(_[S[y]]=f[S[y]]);return _},a=function(f,v,_,S){var y=arguments.length,g=y<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,_):S,j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(f,v,_,S);else for(var W=f.length-1;W>=0;W--)(j=f[W])&&(g=(y<3?j(g):y>3?j(v,_,g):j(v,_))||g);return y>3&&g&&Object.defineProperty(v,_,g),g},l=function(f,v){return function(_,S){v(_,S,f)}},m=function(f,v){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,v)},b=function(f,v,_,S){function y(g){return g instanceof _?g:new _(function(j){j(g)})}return new(_||(_=Promise))(function(g,j){function W($){try{O(S.next($))}catch(Q){j(Q)}}function J($){try{O(S.throw($))}catch(Q){j(Q)}}function O($){$.done?g($.value):y($.value).then(W,J)}O((S=S.apply(f,v||[])).next())})},I=function(f,v){var _={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},S,y,g,j;return j={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function W(O){return function($){return J([O,$])}}function J(O){if(S)throw new TypeError("Generator is already executing.");for(;_;)try{if(S=1,y&&(g=O[0]&2?y.return:O[0]?y.throw||((g=y.return)&&g.call(y),0):y.next)&&!(g=g.call(y,O[1])).done)return g;switch(y=0,g&&(O=[O[0]&2,g.value]),O[0]){case 0:case 1:g=O;break;case 4:return _.label++,{value:O[1],done:!1};case 5:_.label++,y=O[1],O=[0];continue;case 7:O=_.ops.pop(),_.trys.pop();continue;default:if(g=_.trys,!(g=g.length>0&&g[g.length-1])&&(O[0]===6||O[0]===2)){_=0;continue}if(O[0]===3&&(!g||O[1]>g[0]&&O[1]<g[3])){_.label=O[1];break}if(O[0]===6&&_.label<g[1]){_.label=g[1],g=O;break}if(g&&_.label<g[2]){_.label=g[2],_.ops.push(O);break}g[2]&&_.ops.pop(),_.trys.pop();continue}O=v.call(f,_)}catch($){O=[6,$],y=0}finally{S=g=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},V=function(f,v,_,S){S===void 0&&(S=_),f[S]=v[_]},T=function(f,v){for(var _ in f)_!=="default"&&!v.hasOwnProperty(_)&&(v[_]=f[_])},M=function(f){var v=typeof Symbol=="function"&&Symbol.iterator,_=v&&f[v],S=0;if(_)return _.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&S>=f.length&&(f=void 0),{value:f&&f[S++],done:!f}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},Y=function(f,v){var _=typeof Symbol=="function"&&f[Symbol.iterator];if(!_)return f;var S=_.call(f),y,g=[],j;try{for(;(v===void 0||v-- >0)&&!(y=S.next()).done;)g.push(y.value)}catch(W){j={error:W}}finally{try{y&&!y.done&&(_=S.return)&&_.call(S)}finally{if(j)throw j.error}}return g},X=function(){for(var f=[],v=0;v<arguments.length;v++)f=f.concat(Y(arguments[v]));return f},Z=function(){for(var f=0,v=0,_=arguments.length;v<_;v++)f+=arguments[v].length;for(var S=Array(f),y=0,v=0;v<_;v++)for(var g=arguments[v],j=0,W=g.length;j<W;j++,y++)S[y]=g[j];return S},B=function(f){return this instanceof B?(this.v=f,this):new B(f)},ee=function(f,v,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var S=_.apply(f,v||[]),y,g=[];return y={},j("next"),j("throw"),j("return"),y[Symbol.asyncIterator]=function(){return this},y;function j(re){S[re]&&(y[re]=function(_e){return new Promise(function(ut,be){g.push([re,_e,ut,be])>1||W(re,_e)})})}function W(re,_e){try{J(S[re](_e))}catch(ut){Q(g[0][3],ut)}}function J(re){re.value instanceof B?Promise.resolve(re.value.v).then(O,$):Q(g[0][2],re)}function O(re){W("next",re)}function $(re){W("throw",re)}function Q(re,_e){re(_e),g.shift(),g.length&&W(g[0][0],g[0][1])}},ce=function(f){var v,_;return v={},S("next"),S("throw",function(y){throw y}),S("return"),v[Symbol.iterator]=function(){return this},v;function S(y,g){v[y]=f[y]?function(j){return(_=!_)?{value:B(f[y](j)),done:y==="return"}:g?g(j):j}:g}},me=function(f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f[Symbol.asyncIterator],_;return v?v.call(f):(f=typeof M=="function"?M(f):f[Symbol.iterator](),_={},S("next"),S("throw"),S("return"),_[Symbol.asyncIterator]=function(){return this},_);function S(g){_[g]=f[g]&&function(j){return new Promise(function(W,J){j=f[g](j),y(W,J,j.done,j.value)})}}function y(g,j,W,J){Promise.resolve(J).then(function(O){g({value:O,done:W})},j)}},ge=function(f,v){return Object.defineProperty?Object.defineProperty(f,"raw",{value:v}):f.raw=v,f},pe=function(f){if(f&&f.__esModule)return f;var v={};if(f!=null)for(var _ in f)Object.hasOwnProperty.call(f,_)&&(v[_]=f[_]);return v.default=f,v},he=function(f){return f&&f.__esModule?f:{default:f}},le=function(f,v){if(!v.has(f))throw new TypeError("attempted to get private field on non-instance");return v.get(f)},q=function(f,v,_){if(!v.has(f))throw new TypeError("attempted to set private field on non-instance");return v.set(f,_),_},F("__extends",i),F("__assign",r),F("__rest",s),F("__decorate",a),F("__param",l),F("__metadata",m),F("__awaiter",b),F("__generator",I),F("__exportStar",T),F("__createBinding",V),F("__values",M),F("__read",Y),F("__spread",X),F("__spreadArrays",Z),F("__await",B),F("__asyncGenerator",ee),F("__asyncDelegator",ce),F("__asyncValues",me),F("__makeTemplateObject",ge),F("__importStar",pe),F("__importDefault",he),F("__classPrivateFieldGet",le),F("__classPrivateFieldSet",q)})})(Nl);var Fl=Nl.exports,Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});function q1(h){if(typeof h!="string")throw new Error(`Cannot safe json parse value of type ${typeof h}`);try{return JSON.parse(h)}catch{return h}}Wn.safeJsonParse=q1;function L1(h){return typeof h=="string"?h:JSON.stringify(h,(i,r)=>typeof r>"u"?null:r)}Wn.safeJsonStringify=L1;var Fn={exports:{}},Oh;function M1(){return Oh||(Oh=1,function(){let h;function i(){}h=i,h.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},h.prototype.setItem=function(r,s){this[r]=String(s)},h.prototype.removeItem=function(r){delete this[r]},h.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},h.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},h.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yr<"u"&&yr.localStorage?Fn.exports=yr.localStorage:typeof window<"u"&&window.localStorage?Fn.exports=window.localStorage:Fn.exports=new i}()),Fn.exports}var ko={},Dn={},Ch;function z1(){if(Ch)return Dn;Ch=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.IKeyValueStorage=void 0;class h{}return Dn.IKeyValueStorage=h,Dn}var jn={},Ah;function U1(){if(Ah)return jn;Ah=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.parseEntry=void 0;const h=Wn;function i(r){var s;return[r[0],h.safeJsonParse((s=r[1])!==null&&s!==void 0?s:"")]}return jn.parseEntry=i,jn}var Rh;function k1(){return Rh||(Rh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0});const i=Fl;i.__exportStar(z1(),h),i.__exportStar(U1(),h)}(ko)),ko}Object.defineProperty(la,"__esModule",{value:!0});la.KeyValueStorage=void 0;const un=Fl,Th=Wn,H1=un.__importDefault(M1()),V1=k1();class Dl{constructor(){this.localStorage=H1.default}getKeys(){return un.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return un.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(V1.parseEntry)})}getItem(i){return un.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(i);if(r!==null)return Th.safeJsonParse(r)})}setItem(i,r){return un.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,Th.safeJsonStringify(r))})}removeItem(i){return un.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}la.KeyValueStorage=Dl;var K1=la.default=Dl,fn={},jl={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(h){var i,r,s,a,l,m,b,I,T,M,Y,X,Z,B,ee,ce,me,ge,pe,he,le,q,V;(function(F){var ue=typeof yr=="object"?yr:typeof self=="object"?self:typeof this=="object"?this:{};F(f(ue,f(h.exports)));function f(v,_){return v!==ue&&(typeof Object.create=="function"?Object.defineProperty(v,"__esModule",{value:!0}):v.__esModule=!0),function(S,y){return v[S]=_?_(S,y):y}}})(function(F){var ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var _ in v)v.hasOwnProperty(_)&&(f[_]=v[_])};i=function(f,v){ue(f,v);function _(){this.constructor=f}f.prototype=v===null?Object.create(v):(_.prototype=v.prototype,new _)},r=Object.assign||function(f){for(var v,_=1,S=arguments.length;_<S;_++){v=arguments[_];for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(f[y]=v[y])}return f},s=function(f,v){var _={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&v.indexOf(S)<0&&(_[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,S=Object.getOwnPropertySymbols(f);y<S.length;y++)v.indexOf(S[y])<0&&Object.prototype.propertyIsEnumerable.call(f,S[y])&&(_[S[y]]=f[S[y]]);return _},a=function(f,v,_,S){var y=arguments.length,g=y<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,_):S,j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(f,v,_,S);else for(var W=f.length-1;W>=0;W--)(j=f[W])&&(g=(y<3?j(g):y>3?j(v,_,g):j(v,_))||g);return y>3&&g&&Object.defineProperty(v,_,g),g},l=function(f,v){return function(_,S){v(_,S,f)}},m=function(f,v){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,v)},b=function(f,v,_,S){function y(g){return g instanceof _?g:new _(function(j){j(g)})}return new(_||(_=Promise))(function(g,j){function W($){try{O(S.next($))}catch(Q){j(Q)}}function J($){try{O(S.throw($))}catch(Q){j(Q)}}function O($){$.done?g($.value):y($.value).then(W,J)}O((S=S.apply(f,v||[])).next())})},I=function(f,v){var _={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},S,y,g,j;return j={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function W(O){return function($){return J([O,$])}}function J(O){if(S)throw new TypeError("Generator is already executing.");for(;_;)try{if(S=1,y&&(g=O[0]&2?y.return:O[0]?y.throw||((g=y.return)&&g.call(y),0):y.next)&&!(g=g.call(y,O[1])).done)return g;switch(y=0,g&&(O=[O[0]&2,g.value]),O[0]){case 0:case 1:g=O;break;case 4:return _.label++,{value:O[1],done:!1};case 5:_.label++,y=O[1],O=[0];continue;case 7:O=_.ops.pop(),_.trys.pop();continue;default:if(g=_.trys,!(g=g.length>0&&g[g.length-1])&&(O[0]===6||O[0]===2)){_=0;continue}if(O[0]===3&&(!g||O[1]>g[0]&&O[1]<g[3])){_.label=O[1];break}if(O[0]===6&&_.label<g[1]){_.label=g[1],g=O;break}if(g&&_.label<g[2]){_.label=g[2],_.ops.push(O);break}g[2]&&_.ops.pop(),_.trys.pop();continue}O=v.call(f,_)}catch($){O=[6,$],y=0}finally{S=g=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},V=function(f,v,_,S){S===void 0&&(S=_),f[S]=v[_]},T=function(f,v){for(var _ in f)_!=="default"&&!v.hasOwnProperty(_)&&(v[_]=f[_])},M=function(f){var v=typeof Symbol=="function"&&Symbol.iterator,_=v&&f[v],S=0;if(_)return _.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&S>=f.length&&(f=void 0),{value:f&&f[S++],done:!f}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},Y=function(f,v){var _=typeof Symbol=="function"&&f[Symbol.iterator];if(!_)return f;var S=_.call(f),y,g=[],j;try{for(;(v===void 0||v-- >0)&&!(y=S.next()).done;)g.push(y.value)}catch(W){j={error:W}}finally{try{y&&!y.done&&(_=S.return)&&_.call(S)}finally{if(j)throw j.error}}return g},X=function(){for(var f=[],v=0;v<arguments.length;v++)f=f.concat(Y(arguments[v]));return f},Z=function(){for(var f=0,v=0,_=arguments.length;v<_;v++)f+=arguments[v].length;for(var S=Array(f),y=0,v=0;v<_;v++)for(var g=arguments[v],j=0,W=g.length;j<W;j++,y++)S[y]=g[j];return S},B=function(f){return this instanceof B?(this.v=f,this):new B(f)},ee=function(f,v,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var S=_.apply(f,v||[]),y,g=[];return y={},j("next"),j("throw"),j("return"),y[Symbol.asyncIterator]=function(){return this},y;function j(re){S[re]&&(y[re]=function(_e){return new Promise(function(ut,be){g.push([re,_e,ut,be])>1||W(re,_e)})})}function W(re,_e){try{J(S[re](_e))}catch(ut){Q(g[0][3],ut)}}function J(re){re.value instanceof B?Promise.resolve(re.value.v).then(O,$):Q(g[0][2],re)}function O(re){W("next",re)}function $(re){W("throw",re)}function Q(re,_e){re(_e),g.shift(),g.length&&W(g[0][0],g[0][1])}},ce=function(f){var v,_;return v={},S("next"),S("throw",function(y){throw y}),S("return"),v[Symbol.iterator]=function(){return this},v;function S(y,g){v[y]=f[y]?function(j){return(_=!_)?{value:B(f[y](j)),done:y==="return"}:g?g(j):j}:g}},me=function(f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f[Symbol.asyncIterator],_;return v?v.call(f):(f=typeof M=="function"?M(f):f[Symbol.iterator](),_={},S("next"),S("throw"),S("return"),_[Symbol.asyncIterator]=function(){return this},_);function S(g){_[g]=f[g]&&function(j){return new Promise(function(W,J){j=f[g](j),y(W,J,j.done,j.value)})}}function y(g,j,W,J){Promise.resolve(J).then(function(O){g({value:O,done:W})},j)}},ge=function(f,v){return Object.defineProperty?Object.defineProperty(f,"raw",{value:v}):f.raw=v,f},pe=function(f){if(f&&f.__esModule)return f;var v={};if(f!=null)for(var _ in f)Object.hasOwnProperty.call(f,_)&&(v[_]=f[_]);return v.default=f,v},he=function(f){return f&&f.__esModule?f:{default:f}},le=function(f,v){if(!v.has(f))throw new TypeError("attempted to get private field on non-instance");return v.get(f)},q=function(f,v,_){if(!v.has(f))throw new TypeError("attempted to set private field on non-instance");return v.set(f,_),_},F("__extends",i),F("__assign",r),F("__rest",s),F("__decorate",a),F("__param",l),F("__metadata",m),F("__awaiter",b),F("__generator",I),F("__exportStar",T),F("__createBinding",V),F("__values",M),F("__read",Y),F("__spread",X),F("__spreadArrays",Z),F("__await",B),F("__asyncGenerator",ee),F("__asyncDelegator",ce),F("__asyncValues",me),F("__makeTemplateObject",ge),F("__importStar",pe),F("__importDefault",he),F("__classPrivateFieldGet",le),F("__classPrivateFieldSet",q)})})(jl);var fa=jl.exports,$n={},Ho={},qn={};class Li{}const B1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Li},Symbol.toStringTag,{value:"Module"})),G1=H0(B1);var Nh;function W1(){if(Nh)return qn;Nh=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.IHeartBeat=void 0;const h=G1;class i extends h.IEvents{constructor(s){super()}}return qn.IHeartBeat=i,qn}var Fh;function $l(){return Fh||(Fh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0}),fa.__exportStar(W1(),h)}(Ho)),Ho}var Vo={},ji={},Dh;function J1(){if(Dh)return ji;Dh=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.HEARTBEAT_EVENTS=ji.HEARTBEAT_INTERVAL=void 0;const h=fe;return ji.HEARTBEAT_INTERVAL=h.FIVE_SECONDS,ji.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ji}var jh;function ql(){return jh||(jh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0}),fa.__exportStar(J1(),h)}(Vo)),Vo}var $h;function Q1(){if($h)return $n;$h=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.HeartBeat=void 0;const h=fa,i=kr,r=fe,s=$l(),a=ql();class l extends s.IHeartBeat{constructor(b){super(b),this.events=new i.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(b==null?void 0:b.interval)||a.HEARTBEAT_INTERVAL}static init(b){return h.__awaiter(this,void 0,void 0,function*(){const I=new l(b);return yield I.init(),I})}init(){return h.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(b,I){this.events.on(b,I)}once(b,I){this.events.once(b,I)}off(b,I){this.events.off(b,I)}removeListener(b,I){this.events.removeListener(b,I)}initialize(){return h.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return $n.HeartBeat=l,$n}(function(h){Object.defineProperty(h,"__esModule",{value:!0});const i=fa;i.__exportStar(Q1(),h),i.__exportStar($l(),h),i.__exportStar(ql(),h)})(fn);var De={},Ll={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(h){var i,r,s,a,l,m,b,I,T,M,Y,X,Z,B,ee,ce,me,ge,pe,he,le,q,V;(function(F){var ue=typeof yr=="object"?yr:typeof self=="object"?self:typeof this=="object"?this:{};F(f(ue,f(h.exports)));function f(v,_){return v!==ue&&(typeof Object.create=="function"?Object.defineProperty(v,"__esModule",{value:!0}):v.__esModule=!0),function(S,y){return v[S]=_?_(S,y):y}}})(function(F){var ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var _ in v)v.hasOwnProperty(_)&&(f[_]=v[_])};i=function(f,v){ue(f,v);function _(){this.constructor=f}f.prototype=v===null?Object.create(v):(_.prototype=v.prototype,new _)},r=Object.assign||function(f){for(var v,_=1,S=arguments.length;_<S;_++){v=arguments[_];for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(f[y]=v[y])}return f},s=function(f,v){var _={};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&v.indexOf(S)<0&&(_[S]=f[S]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,S=Object.getOwnPropertySymbols(f);y<S.length;y++)v.indexOf(S[y])<0&&Object.prototype.propertyIsEnumerable.call(f,S[y])&&(_[S[y]]=f[S[y]]);return _},a=function(f,v,_,S){var y=arguments.length,g=y<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,_):S,j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(f,v,_,S);else for(var W=f.length-1;W>=0;W--)(j=f[W])&&(g=(y<3?j(g):y>3?j(v,_,g):j(v,_))||g);return y>3&&g&&Object.defineProperty(v,_,g),g},l=function(f,v){return function(_,S){v(_,S,f)}},m=function(f,v){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,v)},b=function(f,v,_,S){function y(g){return g instanceof _?g:new _(function(j){j(g)})}return new(_||(_=Promise))(function(g,j){function W($){try{O(S.next($))}catch(Q){j(Q)}}function J($){try{O(S.throw($))}catch(Q){j(Q)}}function O($){$.done?g($.value):y($.value).then(W,J)}O((S=S.apply(f,v||[])).next())})},I=function(f,v){var _={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},S,y,g,j;return j={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function W(O){return function($){return J([O,$])}}function J(O){if(S)throw new TypeError("Generator is already executing.");for(;_;)try{if(S=1,y&&(g=O[0]&2?y.return:O[0]?y.throw||((g=y.return)&&g.call(y),0):y.next)&&!(g=g.call(y,O[1])).done)return g;switch(y=0,g&&(O=[O[0]&2,g.value]),O[0]){case 0:case 1:g=O;break;case 4:return _.label++,{value:O[1],done:!1};case 5:_.label++,y=O[1],O=[0];continue;case 7:O=_.ops.pop(),_.trys.pop();continue;default:if(g=_.trys,!(g=g.length>0&&g[g.length-1])&&(O[0]===6||O[0]===2)){_=0;continue}if(O[0]===3&&(!g||O[1]>g[0]&&O[1]<g[3])){_.label=O[1];break}if(O[0]===6&&_.label<g[1]){_.label=g[1],g=O;break}if(g&&_.label<g[2]){_.label=g[2],_.ops.push(O);break}g[2]&&_.ops.pop(),_.trys.pop();continue}O=v.call(f,_)}catch($){O=[6,$],y=0}finally{S=g=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},V=function(f,v,_,S){S===void 0&&(S=_),f[S]=v[_]},T=function(f,v){for(var _ in f)_!=="default"&&!v.hasOwnProperty(_)&&(v[_]=f[_])},M=function(f){var v=typeof Symbol=="function"&&Symbol.iterator,_=v&&f[v],S=0;if(_)return _.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&S>=f.length&&(f=void 0),{value:f&&f[S++],done:!f}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},Y=function(f,v){var _=typeof Symbol=="function"&&f[Symbol.iterator];if(!_)return f;var S=_.call(f),y,g=[],j;try{for(;(v===void 0||v-- >0)&&!(y=S.next()).done;)g.push(y.value)}catch(W){j={error:W}}finally{try{y&&!y.done&&(_=S.return)&&_.call(S)}finally{if(j)throw j.error}}return g},X=function(){for(var f=[],v=0;v<arguments.length;v++)f=f.concat(Y(arguments[v]));return f},Z=function(){for(var f=0,v=0,_=arguments.length;v<_;v++)f+=arguments[v].length;for(var S=Array(f),y=0,v=0;v<_;v++)for(var g=arguments[v],j=0,W=g.length;j<W;j++,y++)S[y]=g[j];return S},B=function(f){return this instanceof B?(this.v=f,this):new B(f)},ee=function(f,v,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var S=_.apply(f,v||[]),y,g=[];return y={},j("next"),j("throw"),j("return"),y[Symbol.asyncIterator]=function(){return this},y;function j(re){S[re]&&(y[re]=function(_e){return new Promise(function(ut,be){g.push([re,_e,ut,be])>1||W(re,_e)})})}function W(re,_e){try{J(S[re](_e))}catch(ut){Q(g[0][3],ut)}}function J(re){re.value instanceof B?Promise.resolve(re.value.v).then(O,$):Q(g[0][2],re)}function O(re){W("next",re)}function $(re){W("throw",re)}function Q(re,_e){re(_e),g.shift(),g.length&&W(g[0][0],g[0][1])}},ce=function(f){var v,_;return v={},S("next"),S("throw",function(y){throw y}),S("return"),v[Symbol.iterator]=function(){return this},v;function S(y,g){v[y]=f[y]?function(j){return(_=!_)?{value:B(f[y](j)),done:y==="return"}:g?g(j):j}:g}},me=function(f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f[Symbol.asyncIterator],_;return v?v.call(f):(f=typeof M=="function"?M(f):f[Symbol.iterator](),_={},S("next"),S("throw"),S("return"),_[Symbol.asyncIterator]=function(){return this},_);function S(g){_[g]=f[g]&&function(j){return new Promise(function(W,J){j=f[g](j),y(W,J,j.done,j.value)})}}function y(g,j,W,J){Promise.resolve(J).then(function(O){g({value:O,done:W})},j)}},ge=function(f,v){return Object.defineProperty?Object.defineProperty(f,"raw",{value:v}):f.raw=v,f},pe=function(f){if(f&&f.__esModule)return f;var v={};if(f!=null)for(var _ in f)Object.hasOwnProperty.call(f,_)&&(v[_]=f[_]);return v.default=f,v},he=function(f){return f&&f.__esModule?f:{default:f}},le=function(f,v){if(!v.has(f))throw new TypeError("attempted to get private field on non-instance");return v.get(f)},q=function(f,v,_){if(!v.has(f))throw new TypeError("attempted to set private field on non-instance");return v.set(f,_),_},F("__extends",i),F("__assign",r),F("__rest",s),F("__decorate",a),F("__param",l),F("__metadata",m),F("__awaiter",b),F("__generator",I),F("__exportStar",T),F("__createBinding",V),F("__values",M),F("__read",Y),F("__spread",X),F("__spreadArrays",Z),F("__await",B),F("__asyncGenerator",ee),F("__asyncDelegator",ce),F("__asyncValues",me),F("__makeTemplateObject",ge),F("__importStar",pe),F("__importDefault",he),F("__classPrivateFieldGet",le),F("__classPrivateFieldSet",q)})})(Ll);var Y1=Ll.exports,Ko,qh;function X1(){if(qh)return Ko;qh=1;function h(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Ko=i;function i(r,s,a){var l=a&&a.stringify||h,m=1;if(typeof r=="object"&&r!==null){var b=s.length+m;if(b===1)return r;var I=new Array(b);I[0]=l(r);for(var T=1;T<b;T++)I[T]=l(s[T]);return I.join(" ")}if(typeof r!="string")return r;var M=s.length;if(M===0)return r;for(var Y="",X=1-m,Z=-1,B=r&&r.length||0,ee=0;ee<B;){if(r.charCodeAt(ee)===37&&ee+1<B){switch(Z=Z>-1?Z:0,r.charCodeAt(ee+1)){case 100:case 102:if(X>=M||s[X]==null)break;Z<ee&&(Y+=r.slice(Z,ee)),Y+=Number(s[X]),Z=ee+2,ee++;break;case 105:if(X>=M||s[X]==null)break;Z<ee&&(Y+=r.slice(Z,ee)),Y+=Math.floor(Number(s[X])),Z=ee+2,ee++;break;case 79:case 111:case 106:if(X>=M||s[X]===void 0)break;Z<ee&&(Y+=r.slice(Z,ee));var ce=typeof s[X];if(ce==="string"){Y+="'"+s[X]+"'",Z=ee+2,ee++;break}if(ce==="function"){Y+=s[X].name||"<anonymous>",Z=ee+2,ee++;break}Y+=l(s[X]),Z=ee+2,ee++;break;case 115:if(X>=M)break;Z<ee&&(Y+=r.slice(Z,ee)),Y+=String(s[X]),Z=ee+2,ee++;break;case 37:Z<ee&&(Y+=r.slice(Z,ee)),Y+="%",Z=ee+2,ee++,X--;break}++X}++ee}return Z===-1?r:(Z<B&&(Y+=r.slice(Z)),Y)}return Ko}var Bo,Lh;function Z1(){if(Lh)return Bo;Lh=1;const h=X1();Bo=a;const i=le().console||{},r={mapHttpRequest:B,mapHttpResponse:B,wrapRequestSerializer:ee,wrapResponseSerializer:ee,wrapErrorSerializer:ee,req:B,res:B,err:X};function s(q,V){return Array.isArray(q)?q.filter(function(ue){return ue!=="!stdSerializers.err"}):q===!0?Object.keys(V):!1}function a(q){q=q||{},q.browser=q.browser||{};const V=q.browser.transmit;if(V&&typeof V.send!="function")throw Error("pino: transmit option must have a send function");const F=q.browser.write||i;q.browser.write&&(q.browser.asObject=!0);const ue=q.serializers||{},f=s(q.browser.serialize,ue);let v=q.browser.serialize;Array.isArray(q.browser.serialize)&&q.browser.serialize.indexOf("!stdSerializers.err")>-1&&(v=!1);const _=["error","fatal","warn","info","debug","trace"];typeof F=="function"&&(F.error=F.fatal=F.warn=F.info=F.debug=F.trace=F),q.enabled===!1&&(q.level="silent");const S=q.level||"info",y=Object.create(F);y.log||(y.log=ce),Object.defineProperty(y,"levelVal",{get:j}),Object.defineProperty(y,"level",{get:W,set:J});const g={transmit:V,serialize:f,asObject:q.browser.asObject,levels:_,timestamp:Z(q)};y.levels=a.levels,y.level=S,y.setMaxListeners=y.getMaxListeners=y.emit=y.addListener=y.on=y.prependListener=y.once=y.prependOnceListener=y.removeListener=y.removeAllListeners=y.listeners=y.listenerCount=y.eventNames=y.write=y.flush=ce,y.serializers=ue,y._serialize=f,y._stdErrSerialize=v,y.child=O,V&&(y._logEvent=Y());function j(){return this.level==="silent"?1/0:this.levels.values[this.level]}function W(){return this._level}function J($){if($!=="silent"&&!this.levels.values[$])throw Error("unknown level "+$);this._level=$,l(g,y,"error","log"),l(g,y,"fatal","error"),l(g,y,"warn","error"),l(g,y,"info","log"),l(g,y,"debug","log"),l(g,y,"trace","log")}function O($,Q){if(!$)throw new Error("missing bindings for child Pino");Q=Q||{},f&&$.serializers&&(Q.serializers=$.serializers);const re=Q.serializers;if(f&&re){var _e=Object.assign({},ue,re),ut=q.browser.serialize===!0?Object.keys(_e):f;delete $.serializers,I([$],ut,_e,this._stdErrSerialize)}function be(xt){this._childLevel=(xt._childLevel|0)+1,this.error=T(xt,$,"error"),this.fatal=T(xt,$,"fatal"),this.warn=T(xt,$,"warn"),this.info=T(xt,$,"info"),this.debug=T(xt,$,"debug"),this.trace=T(xt,$,"trace"),_e&&(this.serializers=_e,this._serialize=ut),V&&(this._logEvent=Y([].concat(xt._logEvent.bindings,$)))}return be.prototype=this,new be(this)}return y}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:me,epochTime:ge,unixTime:pe,isoTime:he});function l(q,V,F,ue){const f=Object.getPrototypeOf(V);V[F]=V.levelVal>V.levels.values[F]?ce:f[F]?f[F]:i[F]||i[ue]||ce,m(q,V,F)}function m(q,V,F){!q.transmit&&V[F]===ce||(V[F]=function(ue){return function(){const v=q.timestamp(),_=new Array(arguments.length),S=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var y=0;y<_.length;y++)_[y]=arguments[y];if(q.serialize&&!q.asObject&&I(_,this._serialize,this.serializers,this._stdErrSerialize),q.asObject?ue.call(S,b(this,F,_,v)):ue.apply(S,_),q.transmit){const g=q.transmit.level||V.level,j=a.levels.values[g],W=a.levels.values[F];if(W<j)return;M(this,{ts:v,methodLevel:F,methodValue:W,transmitLevel:g,transmitValue:a.levels.values[q.transmit.level||V.level],send:q.transmit.send,val:V.levelVal},_)}}}(V[F]))}function b(q,V,F,ue){q._serialize&&I(F,q._serialize,q.serializers,q._stdErrSerialize);const f=F.slice();let v=f[0];const _={};ue&&(_.time=ue),_.level=a.levels.values[V];let S=(q._childLevel|0)+1;if(S<1&&(S=1),v!==null&&typeof v=="object"){for(;S--&&typeof f[0]=="object";)Object.assign(_,f.shift());v=f.length?h(f.shift(),f):void 0}else typeof v=="string"&&(v=h(f.shift(),f));return v!==void 0&&(_.msg=v),_}function I(q,V,F,ue){for(const f in q)if(ue&&q[f]instanceof Error)q[f]=a.stdSerializers.err(q[f]);else if(typeof q[f]=="object"&&!Array.isArray(q[f]))for(const v in q[f])V&&V.indexOf(v)>-1&&v in F&&(q[f][v]=F[v](q[f][v]))}function T(q,V,F){return function(){const ue=new Array(1+arguments.length);ue[0]=V;for(var f=1;f<ue.length;f++)ue[f]=arguments[f-1];return q[F].apply(this,ue)}}function M(q,V,F){const ue=V.send,f=V.ts,v=V.methodLevel,_=V.methodValue,S=V.val,y=q._logEvent.bindings;I(F,q._serialize||Object.keys(q.serializers),q.serializers,q._stdErrSerialize===void 0?!0:q._stdErrSerialize),q._logEvent.ts=f,q._logEvent.messages=F.filter(function(g){return y.indexOf(g)===-1}),q._logEvent.level.label=v,q._logEvent.level.value=_,ue(v,q._logEvent,S),q._logEvent=Y(y)}function Y(q){return{ts:0,messages:[],bindings:q||[],level:{label:"",value:0}}}function X(q){const V={type:q.constructor.name,msg:q.message,stack:q.stack};for(const F in q)V[F]===void 0&&(V[F]=q[F]);return V}function Z(q){return typeof q.timestamp=="function"?q.timestamp:q.timestamp===!1?me:ge}function B(){return{}}function ee(q){return q}function ce(){}function me(){return!1}function ge(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function he(){return new Date(Date.now()).toISOString()}function le(){function q(V){return typeof V<"u"&&V}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return q(self)||q(window)||q(this)||{}}}return Bo}var $i={},Mh;function Ml(){return Mh||(Mh=1,Object.defineProperty($i,"__esModule",{value:!0}),$i.PINO_CUSTOM_CONTEXT_KEY=$i.PINO_LOGGER_DEFAULTS=void 0,$i.PINO_LOGGER_DEFAULTS={level:"info"},$i.PINO_CUSTOM_CONTEXT_KEY="custom_context"),$i}var er={},zh;function e_(){if(zh)return er;zh=1,Object.defineProperty(er,"__esModule",{value:!0}),er.generateChildLogger=er.formatChildLoggerContext=er.getLoggerContext=er.setBrowserLoggerContext=er.getBrowserLoggerContext=er.getDefaultLoggerOptions=void 0;const h=Ml();function i(b){return Object.assign(Object.assign({},b),{level:(b==null?void 0:b.level)||h.PINO_LOGGER_DEFAULTS.level})}er.getDefaultLoggerOptions=i;function r(b,I=h.PINO_CUSTOM_CONTEXT_KEY){return b[I]||""}er.getBrowserLoggerContext=r;function s(b,I,T=h.PINO_CUSTOM_CONTEXT_KEY){return b[T]=I,b}er.setBrowserLoggerContext=s;function a(b,I=h.PINO_CUSTOM_CONTEXT_KEY){let T="";return typeof b.bindings>"u"?T=r(b,I):T=b.bindings().context||"",T}er.getLoggerContext=a;function l(b,I,T=h.PINO_CUSTOM_CONTEXT_KEY){const M=a(b,T);return M.trim()?`${M}/${I}`:I}er.formatChildLoggerContext=l;function m(b,I,T=h.PINO_CUSTOM_CONTEXT_KEY){const M=l(b,I,T),Y=b.child({context:M});return s(Y,M,T)}return er.generateChildLogger=m,er}(function(h){Object.defineProperty(h,"__esModule",{value:!0}),h.pino=void 0;const i=Y1,r=i.__importDefault(Z1());Object.defineProperty(h,"pino",{enumerable:!0,get:function(){return r.default}}),i.__exportStar(Ml(),h),i.__exportStar(e_(),h)})(De);class t_ extends Li{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class r_ extends Li{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class i_{constructor(i,r){this.logger=i,this.core=r}}let n_=class extends Li{constructor(i,r){super(),this.relayer=i,this.logger=r}},s_=class extends Li{constructor(i){super()}},a_=class{constructor(i,r,s,a){this.core=i,this.logger=r,this.name=s}};class o_ extends Li{constructor(i,r){super(),this.relayer=i,this.logger=r}}let c_=class extends Li{constructor(i,r){super(),this.core=i,this.logger=r}},u_=class{constructor(i,r){this.projectId=i,this.logger=r}},h_=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},l_=class{constructor(i){this.client=i}};var yc={},zl={};(function(h){Object.defineProperty(h,"__esModule",{value:!0});var i=V0,r=Il;h.DIGEST_LENGTH=64,h.BLOCK_SIZE=128;var s=function(){function b(){this.digestLength=h.DIGEST_LENGTH,this.blockSize=h.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return b.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},b.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},b.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},b.prototype.update=function(I,T){if(T===void 0&&(T=I.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var M=0;if(this._bytesHashed+=T,this._bufferLength>0){for(;this._bufferLength<h.BLOCK_SIZE&&T>0;)this._buffer[this._bufferLength++]=I[M++],T--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(T>=this.blockSize&&(M=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,I,M,T),T%=this.blockSize);T>0;)this._buffer[this._bufferLength++]=I[M++],T--;return this},b.prototype.finish=function(I){if(!this._finished){var T=this._bytesHashed,M=this._bufferLength,Y=T/536870912|0,X=T<<3,Z=T%128<112?128:256;this._buffer[M]=128;for(var B=M+1;B<Z-8;B++)this._buffer[B]=0;i.writeUint32BE(Y,this._buffer,Z-8),i.writeUint32BE(X,this._buffer,Z-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,Z),this._finished=!0}for(var B=0;B<this.digestLength/8;B++)i.writeUint32BE(this._stateHi[B],I,B*8),i.writeUint32BE(this._stateLo[B],I,B*8+4);return this},b.prototype.digest=function(){var I=new Uint8Array(this.digestLength);return this.finish(I),I},b.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},b.prototype.restoreState=function(I){return this._stateHi.set(I.stateHi),this._stateLo.set(I.stateLo),this._bufferLength=I.bufferLength,I.buffer&&this._buffer.set(I.buffer),this._bytesHashed=I.bytesHashed,this._finished=!1,this},b.prototype.cleanSavedState=function(I){r.wipe(I.stateHi),r.wipe(I.stateLo),I.buffer&&r.wipe(I.buffer),I.bufferLength=0,I.bytesHashed=0},b}();h.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(b,I,T,M,Y,X,Z){for(var B=T[0],ee=T[1],ce=T[2],me=T[3],ge=T[4],pe=T[5],he=T[6],le=T[7],q=M[0],V=M[1],F=M[2],ue=M[3],f=M[4],v=M[5],_=M[6],S=M[7],y,g,j,W,J,O,$,Q;Z>=128;){for(var re=0;re<16;re++){var _e=8*re+X;b[re]=i.readUint32BE(Y,_e),I[re]=i.readUint32BE(Y,_e+4)}for(var re=0;re<80;re++){var ut=B,be=ee,xt=ce,z=me,L=ge,N=pe,c=he,P=le,ae=q,we=V,Pe=F,je=ue,qe=f,Re=v,St=_,_t=S;if(y=le,g=S,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=(ge>>>14|f<<32-14)^(ge>>>18|f<<32-18)^(f>>>41-32|ge<<32-(41-32)),g=(f>>>14|ge<<32-14)^(f>>>18|ge<<32-18)^(ge>>>41-32|f<<32-(41-32)),J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,y=ge&pe^~ge&he,g=f&v^~f&_,J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,y=a[re*2],g=a[re*2+1],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,y=b[re%16],g=I[re%16],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,j=$&65535|Q<<16,W=J&65535|O<<16,y=j,g=W,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=(B>>>28|q<<32-28)^(q>>>34-32|B<<32-(34-32))^(q>>>39-32|B<<32-(39-32)),g=(q>>>28|B<<32-28)^(B>>>34-32|q<<32-(34-32))^(B>>>39-32|q<<32-(39-32)),J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,y=B&ee^B&ce^ee&ce,g=q&V^q&F^V&F,J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,P=$&65535|Q<<16,_t=J&65535|O<<16,y=z,g=je,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=j,g=W,J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,z=$&65535|Q<<16,je=J&65535|O<<16,ee=ut,ce=be,me=xt,ge=z,pe=L,he=N,le=c,B=P,V=ae,F=we,ue=Pe,f=je,v=qe,_=Re,S=St,q=_t,re%16===15)for(var _e=0;_e<16;_e++)y=b[_e],g=I[_e],J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=b[(_e+9)%16],g=I[(_e+9)%16],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,j=b[(_e+1)%16],W=I[(_e+1)%16],y=(j>>>1|W<<32-1)^(j>>>8|W<<32-8)^j>>>7,g=(W>>>1|j<<32-1)^(W>>>8|j<<32-8)^(W>>>7|j<<32-7),J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,j=b[(_e+14)%16],W=I[(_e+14)%16],y=(j>>>19|W<<32-19)^(W>>>61-32|j<<32-(61-32))^j>>>6,g=(W>>>19|j<<32-19)^(j>>>61-32|W<<32-(61-32))^(W>>>6|j<<32-6),J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,b[_e]=$&65535|Q<<16,I[_e]=J&65535|O<<16}y=B,g=q,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[0],g=M[0],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[0]=B=$&65535|Q<<16,M[0]=q=J&65535|O<<16,y=ee,g=V,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[1],g=M[1],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[1]=ee=$&65535|Q<<16,M[1]=V=J&65535|O<<16,y=ce,g=F,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[2],g=M[2],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[2]=ce=$&65535|Q<<16,M[2]=F=J&65535|O<<16,y=me,g=ue,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[3],g=M[3],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[3]=me=$&65535|Q<<16,M[3]=ue=J&65535|O<<16,y=ge,g=f,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[4],g=M[4],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[4]=ge=$&65535|Q<<16,M[4]=f=J&65535|O<<16,y=pe,g=v,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[5],g=M[5],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[5]=pe=$&65535|Q<<16,M[5]=v=J&65535|O<<16,y=he,g=_,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[6],g=M[6],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[6]=he=$&65535|Q<<16,M[6]=_=J&65535|O<<16,y=le,g=S,J=g&65535,O=g>>>16,$=y&65535,Q=y>>>16,y=T[7],g=M[7],J+=g&65535,O+=g>>>16,$+=y&65535,Q+=y>>>16,O+=J>>>16,$+=O>>>16,Q+=$>>>16,T[7]=le=$&65535|Q<<16,M[7]=S=J&65535|O<<16,X+=128,Z-=128}return X}function m(b){var I=new s;I.update(b);var T=I.digest();return I.clean(),T}h.hash=m})(zl);(function(h){Object.defineProperty(h,"__esModule",{value:!0}),h.convertSecretKeyToX25519=h.convertPublicKeyToX25519=h.verify=h.sign=h.extractPublicKeyFromSecretKey=h.generateKeyPair=h.generateKeyPairFromSeed=h.SEED_LENGTH=h.SECRET_KEY_LENGTH=h.PUBLIC_KEY_LENGTH=h.SIGNATURE_LENGTH=void 0;const i=xl,r=zl,s=Il;h.SIGNATURE_LENGTH=64,h.PUBLIC_KEY_LENGTH=32,h.SECRET_KEY_LENGTH=64,h.SEED_LENGTH=32;function a(z){const L=new Float64Array(16);if(z)for(let N=0;N<z.length;N++)L[N]=z[N];return L}const l=new Uint8Array(32);l[0]=9;const m=a(),b=a([1]),I=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),T=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),M=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),Y=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),X=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Z(z,L){for(let N=0;N<16;N++)z[N]=L[N]|0}function B(z){let L=1;for(let N=0;N<16;N++){let c=z[N]+L+65535;L=Math.floor(c/65536),z[N]=c-L*65536}z[0]+=L-1+37*(L-1)}function ee(z,L,N){const c=~(N-1);for(let P=0;P<16;P++){const ae=c&(z[P]^L[P]);z[P]^=ae,L[P]^=ae}}function ce(z,L){const N=a(),c=a();for(let P=0;P<16;P++)c[P]=L[P];B(c),B(c),B(c);for(let P=0;P<2;P++){N[0]=c[0]-65517;for(let we=1;we<15;we++)N[we]=c[we]-65535-(N[we-1]>>16&1),N[we-1]&=65535;N[15]=c[15]-32767-(N[14]>>16&1);const ae=N[15]>>16&1;N[14]&=65535,ee(c,N,1-ae)}for(let P=0;P<16;P++)z[2*P]=c[P]&255,z[2*P+1]=c[P]>>8}function me(z,L){let N=0;for(let c=0;c<32;c++)N|=z[c]^L[c];return(1&N-1>>>8)-1}function ge(z,L){const N=new Uint8Array(32),c=new Uint8Array(32);return ce(N,z),ce(c,L),me(N,c)}function pe(z){const L=new Uint8Array(32);return ce(L,z),L[0]&1}function he(z,L){for(let N=0;N<16;N++)z[N]=L[2*N]+(L[2*N+1]<<8);z[15]&=32767}function le(z,L,N){for(let c=0;c<16;c++)z[c]=L[c]+N[c]}function q(z,L,N){for(let c=0;c<16;c++)z[c]=L[c]-N[c]}function V(z,L,N){let c,P,ae=0,we=0,Pe=0,je=0,qe=0,Re=0,St=0,_t=0,st=0,Me=0,Ye=0,Xe=0,at=0,He=0,Ze=0,$e=0,Ke=0,ht=0,Ue=0,Pt=0,jt=0,Ut=0,kt=0,Lt=0,Wt=0,rr=0,Dr=0,Jt=0,Hr=0,ni=0,bi=0,lt=N[0],rt=N[1],ft=N[2],pt=N[3],ot=N[4],it=N[5],Ot=N[6],Ct=N[7],dt=N[8],At=N[9],gt=N[10],mt=N[11],yt=N[12],Qe=N[13],Rt=N[14],Tt=N[15];c=L[0],ae+=c*lt,we+=c*rt,Pe+=c*ft,je+=c*pt,qe+=c*ot,Re+=c*it,St+=c*Ot,_t+=c*Ct,st+=c*dt,Me+=c*At,Ye+=c*gt,Xe+=c*mt,at+=c*yt,He+=c*Qe,Ze+=c*Rt,$e+=c*Tt,c=L[1],we+=c*lt,Pe+=c*rt,je+=c*ft,qe+=c*pt,Re+=c*ot,St+=c*it,_t+=c*Ot,st+=c*Ct,Me+=c*dt,Ye+=c*At,Xe+=c*gt,at+=c*mt,He+=c*yt,Ze+=c*Qe,$e+=c*Rt,Ke+=c*Tt,c=L[2],Pe+=c*lt,je+=c*rt,qe+=c*ft,Re+=c*pt,St+=c*ot,_t+=c*it,st+=c*Ot,Me+=c*Ct,Ye+=c*dt,Xe+=c*At,at+=c*gt,He+=c*mt,Ze+=c*yt,$e+=c*Qe,Ke+=c*Rt,ht+=c*Tt,c=L[3],je+=c*lt,qe+=c*rt,Re+=c*ft,St+=c*pt,_t+=c*ot,st+=c*it,Me+=c*Ot,Ye+=c*Ct,Xe+=c*dt,at+=c*At,He+=c*gt,Ze+=c*mt,$e+=c*yt,Ke+=c*Qe,ht+=c*Rt,Ue+=c*Tt,c=L[4],qe+=c*lt,Re+=c*rt,St+=c*ft,_t+=c*pt,st+=c*ot,Me+=c*it,Ye+=c*Ot,Xe+=c*Ct,at+=c*dt,He+=c*At,Ze+=c*gt,$e+=c*mt,Ke+=c*yt,ht+=c*Qe,Ue+=c*Rt,Pt+=c*Tt,c=L[5],Re+=c*lt,St+=c*rt,_t+=c*ft,st+=c*pt,Me+=c*ot,Ye+=c*it,Xe+=c*Ot,at+=c*Ct,He+=c*dt,Ze+=c*At,$e+=c*gt,Ke+=c*mt,ht+=c*yt,Ue+=c*Qe,Pt+=c*Rt,jt+=c*Tt,c=L[6],St+=c*lt,_t+=c*rt,st+=c*ft,Me+=c*pt,Ye+=c*ot,Xe+=c*it,at+=c*Ot,He+=c*Ct,Ze+=c*dt,$e+=c*At,Ke+=c*gt,ht+=c*mt,Ue+=c*yt,Pt+=c*Qe,jt+=c*Rt,Ut+=c*Tt,c=L[7],_t+=c*lt,st+=c*rt,Me+=c*ft,Ye+=c*pt,Xe+=c*ot,at+=c*it,He+=c*Ot,Ze+=c*Ct,$e+=c*dt,Ke+=c*At,ht+=c*gt,Ue+=c*mt,Pt+=c*yt,jt+=c*Qe,Ut+=c*Rt,kt+=c*Tt,c=L[8],st+=c*lt,Me+=c*rt,Ye+=c*ft,Xe+=c*pt,at+=c*ot,He+=c*it,Ze+=c*Ot,$e+=c*Ct,Ke+=c*dt,ht+=c*At,Ue+=c*gt,Pt+=c*mt,jt+=c*yt,Ut+=c*Qe,kt+=c*Rt,Lt+=c*Tt,c=L[9],Me+=c*lt,Ye+=c*rt,Xe+=c*ft,at+=c*pt,He+=c*ot,Ze+=c*it,$e+=c*Ot,Ke+=c*Ct,ht+=c*dt,Ue+=c*At,Pt+=c*gt,jt+=c*mt,Ut+=c*yt,kt+=c*Qe,Lt+=c*Rt,Wt+=c*Tt,c=L[10],Ye+=c*lt,Xe+=c*rt,at+=c*ft,He+=c*pt,Ze+=c*ot,$e+=c*it,Ke+=c*Ot,ht+=c*Ct,Ue+=c*dt,Pt+=c*At,jt+=c*gt,Ut+=c*mt,kt+=c*yt,Lt+=c*Qe,Wt+=c*Rt,rr+=c*Tt,c=L[11],Xe+=c*lt,at+=c*rt,He+=c*ft,Ze+=c*pt,$e+=c*ot,Ke+=c*it,ht+=c*Ot,Ue+=c*Ct,Pt+=c*dt,jt+=c*At,Ut+=c*gt,kt+=c*mt,Lt+=c*yt,Wt+=c*Qe,rr+=c*Rt,Dr+=c*Tt,c=L[12],at+=c*lt,He+=c*rt,Ze+=c*ft,$e+=c*pt,Ke+=c*ot,ht+=c*it,Ue+=c*Ot,Pt+=c*Ct,jt+=c*dt,Ut+=c*At,kt+=c*gt,Lt+=c*mt,Wt+=c*yt,rr+=c*Qe,Dr+=c*Rt,Jt+=c*Tt,c=L[13],He+=c*lt,Ze+=c*rt,$e+=c*ft,Ke+=c*pt,ht+=c*ot,Ue+=c*it,Pt+=c*Ot,jt+=c*Ct,Ut+=c*dt,kt+=c*At,Lt+=c*gt,Wt+=c*mt,rr+=c*yt,Dr+=c*Qe,Jt+=c*Rt,Hr+=c*Tt,c=L[14],Ze+=c*lt,$e+=c*rt,Ke+=c*ft,ht+=c*pt,Ue+=c*ot,Pt+=c*it,jt+=c*Ot,Ut+=c*Ct,kt+=c*dt,Lt+=c*At,Wt+=c*gt,rr+=c*mt,Dr+=c*yt,Jt+=c*Qe,Hr+=c*Rt,ni+=c*Tt,c=L[15],$e+=c*lt,Ke+=c*rt,ht+=c*ft,Ue+=c*pt,Pt+=c*ot,jt+=c*it,Ut+=c*Ot,kt+=c*Ct,Lt+=c*dt,Wt+=c*At,rr+=c*gt,Dr+=c*mt,Jt+=c*yt,Hr+=c*Qe,ni+=c*Rt,bi+=c*Tt,ae+=38*Ke,we+=38*ht,Pe+=38*Ue,je+=38*Pt,qe+=38*jt,Re+=38*Ut,St+=38*kt,_t+=38*Lt,st+=38*Wt,Me+=38*rr,Ye+=38*Dr,Xe+=38*Jt,at+=38*Hr,He+=38*ni,Ze+=38*bi,P=1,c=ae+P+65535,P=Math.floor(c/65536),ae=c-P*65536,c=we+P+65535,P=Math.floor(c/65536),we=c-P*65536,c=Pe+P+65535,P=Math.floor(c/65536),Pe=c-P*65536,c=je+P+65535,P=Math.floor(c/65536),je=c-P*65536,c=qe+P+65535,P=Math.floor(c/65536),qe=c-P*65536,c=Re+P+65535,P=Math.floor(c/65536),Re=c-P*65536,c=St+P+65535,P=Math.floor(c/65536),St=c-P*65536,c=_t+P+65535,P=Math.floor(c/65536),_t=c-P*65536,c=st+P+65535,P=Math.floor(c/65536),st=c-P*65536,c=Me+P+65535,P=Math.floor(c/65536),Me=c-P*65536,c=Ye+P+65535,P=Math.floor(c/65536),Ye=c-P*65536,c=Xe+P+65535,P=Math.floor(c/65536),Xe=c-P*65536,c=at+P+65535,P=Math.floor(c/65536),at=c-P*65536,c=He+P+65535,P=Math.floor(c/65536),He=c-P*65536,c=Ze+P+65535,P=Math.floor(c/65536),Ze=c-P*65536,c=$e+P+65535,P=Math.floor(c/65536),$e=c-P*65536,ae+=P-1+37*(P-1),P=1,c=ae+P+65535,P=Math.floor(c/65536),ae=c-P*65536,c=we+P+65535,P=Math.floor(c/65536),we=c-P*65536,c=Pe+P+65535,P=Math.floor(c/65536),Pe=c-P*65536,c=je+P+65535,P=Math.floor(c/65536),je=c-P*65536,c=qe+P+65535,P=Math.floor(c/65536),qe=c-P*65536,c=Re+P+65535,P=Math.floor(c/65536),Re=c-P*65536,c=St+P+65535,P=Math.floor(c/65536),St=c-P*65536,c=_t+P+65535,P=Math.floor(c/65536),_t=c-P*65536,c=st+P+65535,P=Math.floor(c/65536),st=c-P*65536,c=Me+P+65535,P=Math.floor(c/65536),Me=c-P*65536,c=Ye+P+65535,P=Math.floor(c/65536),Ye=c-P*65536,c=Xe+P+65535,P=Math.floor(c/65536),Xe=c-P*65536,c=at+P+65535,P=Math.floor(c/65536),at=c-P*65536,c=He+P+65535,P=Math.floor(c/65536),He=c-P*65536,c=Ze+P+65535,P=Math.floor(c/65536),Ze=c-P*65536,c=$e+P+65535,P=Math.floor(c/65536),$e=c-P*65536,ae+=P-1+37*(P-1),z[0]=ae,z[1]=we,z[2]=Pe,z[3]=je,z[4]=qe,z[5]=Re,z[6]=St,z[7]=_t,z[8]=st,z[9]=Me,z[10]=Ye,z[11]=Xe,z[12]=at,z[13]=He,z[14]=Ze,z[15]=$e}function F(z,L){V(z,L,L)}function ue(z,L){const N=a();let c;for(c=0;c<16;c++)N[c]=L[c];for(c=253;c>=0;c--)F(N,N),c!==2&&c!==4&&V(N,N,L);for(c=0;c<16;c++)z[c]=N[c]}function f(z,L){const N=a();let c;for(c=0;c<16;c++)N[c]=L[c];for(c=250;c>=0;c--)F(N,N),c!==1&&V(N,N,L);for(c=0;c<16;c++)z[c]=N[c]}function v(z,L){const N=a(),c=a(),P=a(),ae=a(),we=a(),Pe=a(),je=a(),qe=a(),Re=a();q(N,z[1],z[0]),q(Re,L[1],L[0]),V(N,N,Re),le(c,z[0],z[1]),le(Re,L[0],L[1]),V(c,c,Re),V(P,z[3],L[3]),V(P,P,T),V(ae,z[2],L[2]),le(ae,ae,ae),q(we,c,N),q(Pe,ae,P),le(je,ae,P),le(qe,c,N),V(z[0],we,Pe),V(z[1],qe,je),V(z[2],je,Pe),V(z[3],we,qe)}function _(z,L,N){for(let c=0;c<4;c++)ee(z[c],L[c],N)}function S(z,L){const N=a(),c=a(),P=a();ue(P,L[2]),V(N,L[0],P),V(c,L[1],P),ce(z,c),z[31]^=pe(N)<<7}function y(z,L,N){Z(z[0],m),Z(z[1],b),Z(z[2],b),Z(z[3],m);for(let c=255;c>=0;--c){const P=N[c/8|0]>>(c&7)&1;_(z,L,P),v(L,z),v(z,z),_(z,L,P)}}function g(z,L){const N=[a(),a(),a(),a()];Z(N[0],M),Z(N[1],Y),Z(N[2],b),V(N[3],M,Y),y(z,N,L)}function j(z){if(z.length!==h.SEED_LENGTH)throw new Error(`ed25519: seed must be ${h.SEED_LENGTH} bytes`);const L=(0,r.hash)(z);L[0]&=248,L[31]&=127,L[31]|=64;const N=new Uint8Array(32),c=[a(),a(),a(),a()];g(c,L),S(N,c);const P=new Uint8Array(64);return P.set(z),P.set(N,32),{publicKey:N,secretKey:P}}h.generateKeyPairFromSeed=j;function W(z){const L=(0,i.randomBytes)(32,z),N=j(L);return(0,s.wipe)(L),N}h.generateKeyPair=W;function J(z){if(z.length!==h.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${h.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(z.subarray(32))}h.extractPublicKeyFromSecretKey=J;const O=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(z,L){let N,c,P,ae;for(c=63;c>=32;--c){for(N=0,P=c-32,ae=c-12;P<ae;++P)L[P]+=N-16*L[c]*O[P-(c-32)],N=Math.floor((L[P]+128)/256),L[P]-=N*256;L[P]+=N,L[c]=0}for(N=0,P=0;P<32;P++)L[P]+=N-(L[31]>>4)*O[P],N=L[P]>>8,L[P]&=255;for(P=0;P<32;P++)L[P]-=N*O[P];for(c=0;c<32;c++)L[c+1]+=L[c]>>8,z[c]=L[c]&255}function Q(z){const L=new Float64Array(64);for(let N=0;N<64;N++)L[N]=z[N];for(let N=0;N<64;N++)z[N]=0;$(z,L)}function re(z,L){const N=new Float64Array(64),c=[a(),a(),a(),a()],P=(0,r.hash)(z.subarray(0,32));P[0]&=248,P[31]&=127,P[31]|=64;const ae=new Uint8Array(64);ae.set(P.subarray(32),32);const we=new r.SHA512;we.update(ae.subarray(32)),we.update(L);const Pe=we.digest();we.clean(),Q(Pe),g(c,Pe),S(ae,c),we.reset(),we.update(ae.subarray(0,32)),we.update(z.subarray(32)),we.update(L);const je=we.digest();Q(je);for(let qe=0;qe<32;qe++)N[qe]=Pe[qe];for(let qe=0;qe<32;qe++)for(let Re=0;Re<32;Re++)N[qe+Re]+=je[qe]*P[Re];return $(ae.subarray(32),N),ae}h.sign=re;function _e(z,L){const N=a(),c=a(),P=a(),ae=a(),we=a(),Pe=a(),je=a();return Z(z[2],b),he(z[1],L),F(P,z[1]),V(ae,P,I),q(P,P,z[2]),le(ae,z[2],ae),F(we,ae),F(Pe,we),V(je,Pe,we),V(N,je,P),V(N,N,ae),f(N,N),V(N,N,P),V(N,N,ae),V(N,N,ae),V(z[0],N,ae),F(c,z[0]),V(c,c,ae),ge(c,P)&&V(z[0],z[0],X),F(c,z[0]),V(c,c,ae),ge(c,P)?-1:(pe(z[0])===L[31]>>7&&q(z[0],m,z[0]),V(z[3],z[0],z[1]),0)}function ut(z,L,N){const c=new Uint8Array(32),P=[a(),a(),a(),a()],ae=[a(),a(),a(),a()];if(N.length!==h.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${h.SIGNATURE_LENGTH} bytes`);if(_e(ae,z))return!1;const we=new r.SHA512;we.update(N.subarray(0,32)),we.update(z),we.update(L);const Pe=we.digest();return Q(Pe),y(P,ae,Pe),g(ae,N.subarray(32)),v(P,ae),S(c,P),!me(N,c)}h.verify=ut;function be(z){let L=[a(),a(),a(),a()];if(_e(L,z))throw new Error("Ed25519: invalid public key");let N=a(),c=a(),P=L[1];le(N,b,P),q(c,b,P),ue(c,c),V(N,N,c);let ae=new Uint8Array(32);return ce(ae,N),ae}h.convertPublicKeyToX25519=be;function xt(z){const L=(0,r.hash)(z.subarray(0,32));L[0]&=248,L[31]&=127,L[31]|=64;const N=new Uint8Array(L.subarray(0,32));return(0,s.wipe)(L),N}h.convertSecretKeyToX25519=xt})(yc);const f_="EdDSA",p_="JWT",Ul=".",kl="base64url",d_="utf8",g_="utf8",y_=":",v_="did",__="key",Uh="base58btc",m_="z",w_="K36",b_=32;function oa(h){return ha(uc(lc(h),d_),kl)}function Hl(h){const i=uc(w_,Uh),r=m_+ha(K0([i,h]),Uh);return[v_,__,r].join(y_)}function E_(h){return ha(h,kl)}function I_(h){return uc([oa(h.header),oa(h.payload)].join(Ul),g_)}function x_(h){return[oa(h.header),oa(h.payload),E_(h.signature)].join(Ul)}function kh(h=xl.randomBytes(b_)){return yc.generateKeyPairFromSeed(h)}async function S_(h,i,r,s,a=fe.fromMiliseconds(Date.now())){const l={alg:f_,typ:p_},m=Hl(s.publicKey),b=a+r,I={iss:m,sub:h,aud:i,iat:a,exp:b},T=I_({header:l,payload:I}),M=yc.sign(s.secretKey,T);return x_({header:l,payload:I,signature:M})}const P_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),O_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Hh=h=>h.split("?")[0],Vh=10,C_=P_();class A_{constructor(i){if(this.url=i,this.events=new kr.EventEmitter,this.registering=!1,!Ph(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(lc(i))}catch(s){this.onError(i.id,s)}}register(i=this.url){if(!Ph(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,s)=>{const a=N1.isReactNative()?void 0:{rejectUnauthorized:!F1(i)},l=new C_(i,[],a);O_()?l.onerror=m=>{const b=m;s(this.emitError(b.error))}:l.on("error",m=>{s(this.emitError(m))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?Tl(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const s=this.parseError(r),a=s.message||s.toString(),l=fc(i,a);this.events.emit("payload",l)}parseError(i,r=this.url){return D1(i,Hh(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Vh&&this.events.setMaxListeners(Vh)}emitError(i){const r=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${Hh(this.url)}`));return this.events.emit("register_error",r),r}}var ca={exports:{}};ca.exports;(function(h,i){var r=200,s="__lodash_hash_undefined__",a=1,l=2,m=9007199254740991,b="[object Arguments]",I="[object Array]",T="[object AsyncFunction]",M="[object Boolean]",Y="[object Date]",X="[object Error]",Z="[object Function]",B="[object GeneratorFunction]",ee="[object Map]",ce="[object Number]",me="[object Null]",ge="[object Object]",pe="[object Promise]",he="[object Proxy]",le="[object RegExp]",q="[object Set]",V="[object String]",F="[object Symbol]",ue="[object Undefined]",f="[object WeakMap]",v="[object ArrayBuffer]",_="[object DataView]",S="[object Float32Array]",y="[object Float64Array]",g="[object Int8Array]",j="[object Int16Array]",W="[object Int32Array]",J="[object Uint8Array]",O="[object Uint8ClampedArray]",$="[object Uint16Array]",Q="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,_e=/^\[object .+?Constructor\]$/,ut=/^(?:0|[1-9]\d*)$/,be={};be[S]=be[y]=be[g]=be[j]=be[W]=be[J]=be[O]=be[$]=be[Q]=!0,be[b]=be[I]=be[v]=be[M]=be[_]=be[Y]=be[X]=be[Z]=be[ee]=be[ce]=be[ge]=be[le]=be[q]=be[V]=be[f]=!1;var xt=typeof yr=="object"&&yr&&yr.Object===Object&&yr,z=typeof self=="object"&&self&&self.Object===Object&&self,L=xt||z||Function("return this")(),N=i&&!i.nodeType&&i,c=N&&!0&&h&&!h.nodeType&&h,P=c&&c.exports===N,ae=P&&xt.process,we=function(){try{return ae&&ae.binding&&ae.binding("util")}catch{}}(),Pe=we&&we.isTypedArray;function je(w,C){for(var K=-1,ie=w==null?0:w.length,Ge=0,Ie=[];++K<ie;){var et=w[K];C(et,K,w)&&(Ie[Ge++]=et)}return Ie}function qe(w,C){for(var K=-1,ie=C.length,Ge=w.length;++K<ie;)w[Ge+K]=C[K];return w}function Re(w,C){for(var K=-1,ie=w==null?0:w.length;++K<ie;)if(C(w[K],K,w))return!0;return!1}function St(w,C){for(var K=-1,ie=Array(w);++K<w;)ie[K]=C(K);return ie}function _t(w){return function(C){return w(C)}}function st(w,C){return w.has(C)}function Me(w,C){return w==null?void 0:w[C]}function Ye(w){var C=-1,K=Array(w.size);return w.forEach(function(ie,Ge){K[++C]=[Ge,ie]}),K}function Xe(w,C){return function(K){return w(C(K))}}function at(w){var C=-1,K=Array(w.size);return w.forEach(function(ie){K[++C]=ie}),K}var He=Array.prototype,Ze=Function.prototype,$e=Object.prototype,Ke=L["__core-js_shared__"],ht=Ze.toString,Ue=$e.hasOwnProperty,Pt=function(){var w=/[^.]+$/.exec(Ke&&Ke.keys&&Ke.keys.IE_PROTO||"");return w?"Symbol(src)_1."+w:""}(),jt=$e.toString,Ut=RegExp("^"+ht.call(Ue).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=P?L.Buffer:void 0,Lt=L.Symbol,Wt=L.Uint8Array,rr=$e.propertyIsEnumerable,Dr=He.splice,Jt=Lt?Lt.toStringTag:void 0,Hr=Object.getOwnPropertySymbols,ni=kt?kt.isBuffer:void 0,bi=Xe(Object.keys,Object),lt=hr(L,"DataView"),rt=hr(L,"Map"),ft=hr(L,"Promise"),pt=hr(L,"Set"),ot=hr(L,"WeakMap"),it=hr(Object,"create"),Ot=Kr(lt),Ct=Kr(rt),dt=Kr(ft),At=Kr(pt),gt=Kr(ot),mt=Lt?Lt.prototype:void 0,yt=mt?mt.valueOf:void 0;function Qe(w){var C=-1,K=w==null?0:w.length;for(this.clear();++C<K;){var ie=w[C];this.set(ie[0],ie[1])}}function Rt(){this.__data__=it?it(null):{},this.size=0}function Tt(w){var C=this.has(w)&&delete this.__data__[w];return this.size-=C?1:0,C}function ga(w){var C=this.__data__;if(it){var K=C[w];return K===s?void 0:K}return Ue.call(C,w)?C[w]:void 0}function ya(w){var C=this.__data__;return it?C[w]!==void 0:Ue.call(C,w)}function va(w,C){var K=this.__data__;return this.size+=this.has(w)?0:1,K[w]=it&&C===void 0?s:C,this}Qe.prototype.clear=Rt,Qe.prototype.delete=Tt,Qe.prototype.get=ga,Qe.prototype.has=ya,Qe.prototype.set=va;function vr(w){var C=-1,K=w==null?0:w.length;for(this.clear();++C<K;){var ie=w[C];this.set(ie[0],ie[1])}}function _a(){this.__data__=[],this.size=0}function ma(w){var C=this.__data__,K=Ei(C,w);if(K<0)return!1;var ie=C.length-1;return K==ie?C.pop():Dr.call(C,K,1),--this.size,!0}function wa(w){var C=this.__data__,K=Ei(C,w);return K<0?void 0:C[K][1]}function ba(w){return Ei(this.__data__,w)>-1}function Ea(w,C){var K=this.__data__,ie=Ei(K,w);return ie<0?(++this.size,K.push([w,C])):K[ie][1]=C,this}vr.prototype.clear=_a,vr.prototype.delete=ma,vr.prototype.get=wa,vr.prototype.has=ba,vr.prototype.set=Ea;function Vr(w){var C=-1,K=w==null?0:w.length;for(this.clear();++C<K;){var ie=w[C];this.set(ie[0],ie[1])}}function zi(){this.size=0,this.__data__={hash:new Qe,map:new(rt||vr),string:new Qe}}function Ia(w){var C=si(this,w).delete(w);return this.size-=C?1:0,C}function Ui(w){return si(this,w).get(w)}function xa(w){return si(this,w).has(w)}function Sa(w,C){var K=si(this,w),ie=K.size;return K.set(w,C),this.size+=K.size==ie?0:1,this}Vr.prototype.clear=zi,Vr.prototype.delete=Ia,Vr.prototype.get=Ui,Vr.prototype.has=xa,Vr.prototype.set=Sa;function ki(w){var C=-1,K=w==null?0:w.length;for(this.__data__=new Vr;++C<K;)this.add(w[C])}function Qn(w){return this.__data__.set(w,s),this}function Yn(w){return this.__data__.has(w)}ki.prototype.add=ki.prototype.push=Qn,ki.prototype.has=Yn;function Or(w){var C=this.__data__=new vr(w);this.size=C.size}function Pa(){this.__data__=new vr,this.size=0}function Oa(w){var C=this.__data__,K=C.delete(w);return this.size=C.size,K}function Ca(w){return this.__data__.get(w)}function Aa(w){return this.__data__.has(w)}function Xn(w,C){var K=this.__data__;if(K instanceof vr){var ie=K.__data__;if(!rt||ie.length<r-1)return ie.push([w,C]),this.size=++K.size,this;K=this.__data__=new Vr(ie)}return K.set(w,C),this.size=K.size,this}Or.prototype.clear=Pa,Or.prototype.delete=Oa,Or.prototype.get=Ca,Or.prototype.has=Aa,Or.prototype.set=Xn;function Zn(w,C){var K=Ki(w),ie=!K&&ls(w),Ge=!K&&!ie&&yn(w),Ie=!K&&!ie&&!Ge&&ds(w),et=K||ie||Ge||Ie,Nt=et?St(w.length,String):[],Ne=Nt.length;for(var We in w)(C||Ue.call(w,We))&&!(et&&(We=="length"||Ge&&(We=="offset"||We=="parent")||Ie&&(We=="buffer"||We=="byteLength"||We=="byteOffset")||as(We,Ne)))&&Nt.push(We);return Nt}function Ei(w,C){for(var K=w.length;K--;)if(hs(w[K][0],C))return K;return-1}function dn(w,C,K){var ie=C(w);return Ki(w)?ie:qe(ie,K(w))}function Ii(w){return w==null?w===void 0?ue:me:Jt&&Jt in Object(w)?ns(w):Na(w)}function gn(w){return Si(w)&&Ii(w)==b}function xi(w,C,K,ie,Ge){return w===C?!0:w==null||C==null||!Si(w)&&!Si(C)?w!==w&&C!==C:es(w,C,K,ie,xi,Ge)}function es(w,C,K,ie,Ge,Ie){var et=Ki(w),Nt=Ki(C),Ne=et?I:jr(w),We=Nt?I:jr(C);Ne=Ne==b?ge:Ne,We=We==b?ge:We;var wt=Ne==ge,ir=We==ge,Ft=Ne==We;if(Ft&&yn(w)){if(!yn(C))return!1;et=!0,wt=!1}if(Ft&&!wt)return Ie||(Ie=new Or),et||ds(w)?Hi(w,C,K,ie,Ge,Ie):Ta(w,C,Ne,K,ie,Ge,Ie);if(!(K&a)){var tt=wt&&Ue.call(w,"__wrapped__"),Qt=ir&&Ue.call(C,"__wrapped__");if(tt||Qt){var Cr=tt?w.value():w,_r=Qt?C.value():C;return Ie||(Ie=new Or),Ge(Cr,_r,K,ie,Ie)}}return Ft?(Ie||(Ie=new Or),is(w,C,K,ie,Ge,Ie)):!1}function Ra(w){if(!ps(w)||cs(w))return!1;var C=Bi(w)?Ut:_e;return C.test(Kr(w))}function ts(w){return Si(w)&&fs(w.length)&&!!be[Ii(w)]}function rs(w){if(!us(w))return bi(w);var C=[];for(var K in Object(w))Ue.call(w,K)&&K!="constructor"&&C.push(K);return C}function Hi(w,C,K,ie,Ge,Ie){var et=K&a,Nt=w.length,Ne=C.length;if(Nt!=Ne&&!(et&&Ne>Nt))return!1;var We=Ie.get(w);if(We&&Ie.get(C))return We==C;var wt=-1,ir=!0,Ft=K&l?new ki:void 0;for(Ie.set(w,C),Ie.set(C,w);++wt<Nt;){var tt=w[wt],Qt=C[wt];if(ie)var Cr=et?ie(Qt,tt,wt,C,w,Ie):ie(tt,Qt,wt,w,C,Ie);if(Cr!==void 0){if(Cr)continue;ir=!1;break}if(Ft){if(!Re(C,function(_r,$r){if(!st(Ft,$r)&&(tt===_r||Ge(tt,_r,K,ie,Ie)))return Ft.push($r)})){ir=!1;break}}else if(!(tt===Qt||Ge(tt,Qt,K,ie,Ie))){ir=!1;break}}return Ie.delete(w),Ie.delete(C),ir}function Ta(w,C,K,ie,Ge,Ie,et){switch(K){case _:if(w.byteLength!=C.byteLength||w.byteOffset!=C.byteOffset)return!1;w=w.buffer,C=C.buffer;case v:return!(w.byteLength!=C.byteLength||!Ie(new Wt(w),new Wt(C)));case M:case Y:case ce:return hs(+w,+C);case X:return w.name==C.name&&w.message==C.message;case le:case V:return w==C+"";case ee:var Nt=Ye;case q:var Ne=ie&a;if(Nt||(Nt=at),w.size!=C.size&&!Ne)return!1;var We=et.get(w);if(We)return We==C;ie|=l,et.set(w,C);var wt=Hi(Nt(w),Nt(C),ie,Ge,Ie,et);return et.delete(w),wt;case F:if(yt)return yt.call(w)==yt.call(C)}return!1}function is(w,C,K,ie,Ge,Ie){var et=K&a,Nt=Vi(w),Ne=Nt.length,We=Vi(C),wt=We.length;if(Ne!=wt&&!et)return!1;for(var ir=Ne;ir--;){var Ft=Nt[ir];if(!(et?Ft in C:Ue.call(C,Ft)))return!1}var tt=Ie.get(w);if(tt&&Ie.get(C))return tt==C;var Qt=!0;Ie.set(w,C),Ie.set(C,w);for(var Cr=et;++ir<Ne;){Ft=Nt[ir];var _r=w[Ft],$r=C[Ft];if(ie)var vn=et?ie($r,_r,Ft,C,w,Ie):ie(_r,$r,Ft,w,C,Ie);if(!(vn===void 0?_r===$r||Ge(_r,$r,K,ie,Ie):vn)){Qt=!1;break}Cr||(Cr=Ft=="constructor")}if(Qt&&!Cr){var Pi=w.constructor,Mt=C.constructor;Pi!=Mt&&"constructor"in w&&"constructor"in C&&!(typeof Pi=="function"&&Pi instanceof Pi&&typeof Mt=="function"&&Mt instanceof Mt)&&(Qt=!1)}return Ie.delete(w),Ie.delete(C),Qt}function Vi(w){return dn(w,ja,ss)}function si(w,C){var K=w.__data__;return os(C)?K[typeof C=="string"?"string":"hash"]:K.map}function hr(w,C){var K=Me(w,C);return Ra(K)?K:void 0}function ns(w){var C=Ue.call(w,Jt),K=w[Jt];try{w[Jt]=void 0;var ie=!0}catch{}var Ge=jt.call(w);return ie&&(C?w[Jt]=K:delete w[Jt]),Ge}var ss=Hr?function(w){return w==null?[]:(w=Object(w),je(Hr(w),function(C){return rr.call(w,C)}))}:Be,jr=Ii;(lt&&jr(new lt(new ArrayBuffer(1)))!=_||rt&&jr(new rt)!=ee||ft&&jr(ft.resolve())!=pe||pt&&jr(new pt)!=q||ot&&jr(new ot)!=f)&&(jr=function(w){var C=Ii(w),K=C==ge?w.constructor:void 0,ie=K?Kr(K):"";if(ie)switch(ie){case Ot:return _;case Ct:return ee;case dt:return pe;case At:return q;case gt:return f}return C});function as(w,C){return C=C??m,!!C&&(typeof w=="number"||ut.test(w))&&w>-1&&w%1==0&&w<C}function os(w){var C=typeof w;return C=="string"||C=="number"||C=="symbol"||C=="boolean"?w!=="__proto__":w===null}function cs(w){return!!Pt&&Pt in w}function us(w){var C=w&&w.constructor,K=typeof C=="function"&&C.prototype||$e;return w===K}function Na(w){return jt.call(w)}function Kr(w){if(w!=null){try{return ht.call(w)}catch{}try{return w+""}catch{}}return""}function hs(w,C){return w===C||w!==w&&C!==C}var ls=gn(function(){return arguments}())?gn:function(w){return Si(w)&&Ue.call(w,"callee")&&!rr.call(w,"callee")},Ki=Array.isArray;function Fa(w){return w!=null&&fs(w.length)&&!Bi(w)}var yn=ni||Ve;function Da(w,C){return xi(w,C)}function Bi(w){if(!ps(w))return!1;var C=Ii(w);return C==Z||C==B||C==T||C==he}function fs(w){return typeof w=="number"&&w>-1&&w%1==0&&w<=m}function ps(w){var C=typeof w;return w!=null&&(C=="object"||C=="function")}function Si(w){return w!=null&&typeof w=="object"}var ds=Pe?_t(Pe):ts;function ja(w){return Fa(w)?Zn(w):rs(w)}function Be(){return[]}function Ve(){return!1}h.exports=Da})(ca,ca.exports);var R_=ca.exports;const T_=B0(R_);function N_(h,i){if(h.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<h.length;a++){var l=h.charAt(a),m=l.charCodeAt(0);if(r[m]!==255)throw new TypeError(l+" is ambiguous");r[m]=a}var b=h.length,I=h.charAt(0),T=Math.log(b)/Math.log(256),M=Math.log(256)/Math.log(b);function Y(B){if(B instanceof Uint8Array||(ArrayBuffer.isView(B)?B=new Uint8Array(B.buffer,B.byteOffset,B.byteLength):Array.isArray(B)&&(B=Uint8Array.from(B))),!(B instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(B.length===0)return"";for(var ee=0,ce=0,me=0,ge=B.length;me!==ge&&B[me]===0;)me++,ee++;for(var pe=(ge-me)*M+1>>>0,he=new Uint8Array(pe);me!==ge;){for(var le=B[me],q=0,V=pe-1;(le!==0||q<ce)&&V!==-1;V--,q++)le+=256*he[V]>>>0,he[V]=le%b>>>0,le=le/b>>>0;if(le!==0)throw new Error("Non-zero carry");ce=q,me++}for(var F=pe-ce;F!==pe&&he[F]===0;)F++;for(var ue=I.repeat(ee);F<pe;++F)ue+=h.charAt(he[F]);return ue}function X(B){if(typeof B!="string")throw new TypeError("Expected String");if(B.length===0)return new Uint8Array;var ee=0;if(B[ee]!==" "){for(var ce=0,me=0;B[ee]===I;)ce++,ee++;for(var ge=(B.length-ee)*T+1>>>0,pe=new Uint8Array(ge);B[ee];){var he=r[B.charCodeAt(ee)];if(he===255)return;for(var le=0,q=ge-1;(he!==0||le<me)&&q!==-1;q--,le++)he+=b*pe[q]>>>0,pe[q]=he%256>>>0,he=he/256>>>0;if(he!==0)throw new Error("Non-zero carry");me=le,ee++}if(B[ee]!==" "){for(var V=ge-me;V!==ge&&pe[V]===0;)V++;for(var F=new Uint8Array(ce+(ge-V)),ue=ce;V!==ge;)F[ue++]=pe[V++];return F}}}function Z(B){var ee=X(B);if(ee)return ee;throw new Error(`Non-${i} character`)}return{encode:Y,decodeUnsafe:X,decode:Z}}var F_=N_,D_=F_;const Vl=h=>{if(h instanceof Uint8Array&&h.constructor.name==="Uint8Array")return h;if(h instanceof ArrayBuffer)return new Uint8Array(h);if(ArrayBuffer.isView(h))return new Uint8Array(h.buffer,h.byteOffset,h.byteLength);throw new Error("Unknown type, must be binary type")},j_=h=>new TextEncoder().encode(h),$_=h=>new TextDecoder().decode(h);class q_{constructor(i,r,s){this.name=i,this.prefix=r,this.baseEncode=s}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class L_{constructor(i,r,s){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return Kl(this,i)}}class M_{constructor(i){this.decoders=i}or(i){return Kl(this,i)}decode(i){const r=i[0],s=this.decoders[r];if(s)return s.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Kl=(h,i)=>new M_({...h.decoders||{[h.prefix]:h},...i.decoders||{[i.prefix]:i}});class z_{constructor(i,r,s,a){this.name=i,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new q_(i,r,s),this.decoder=new L_(i,r,a)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const pa=({name:h,prefix:i,encode:r,decode:s})=>new z_(h,i,r,s),Jn=({prefix:h,name:i,alphabet:r})=>{const{encode:s,decode:a}=D_(r,i);return pa({prefix:h,name:i,encode:s,decode:l=>Vl(a(l))})},U_=(h,i,r,s)=>{const a={};for(let M=0;M<i.length;++M)a[i[M]]=M;let l=h.length;for(;h[l-1]==="=";)--l;const m=new Uint8Array(l*r/8|0);let b=0,I=0,T=0;for(let M=0;M<l;++M){const Y=a[h[M]];if(Y===void 0)throw new SyntaxError(`Non-${s} character`);I=I<<r|Y,b+=r,b>=8&&(b-=8,m[T++]=255&I>>b)}if(b>=r||255&I<<8-b)throw new SyntaxError("Unexpected end of data");return m},k_=(h,i,r)=>{const s=i[i.length-1]==="=",a=(1<<r)-1;let l="",m=0,b=0;for(let I=0;I<h.length;++I)for(b=b<<8|h[I],m+=8;m>r;)m-=r,l+=i[a&b>>m];if(m&&(l+=i[a&b<<r-m]),s)for(;l.length*r&7;)l+="=";return l},Vt=({name:h,prefix:i,bitsPerChar:r,alphabet:s})=>pa({prefix:i,name:h,encode(a){return k_(a,s,r)},decode(a){return U_(a,s,r,h)}}),H_=pa({prefix:"\0",name:"identity",encode:h=>$_(h),decode:h=>j_(h)});var V_=Object.freeze({__proto__:null,identity:H_});const K_=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var B_=Object.freeze({__proto__:null,base2:K_});const G_=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var W_=Object.freeze({__proto__:null,base8:G_});const J_=Jn({prefix:"9",name:"base10",alphabet:"0123456789"});var Q_=Object.freeze({__proto__:null,base10:J_});const Y_=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),X_=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Z_=Object.freeze({__proto__:null,base16:Y_,base16upper:X_});const em=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),tm=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rm=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),im=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nm=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sm=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),am=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),om=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),cm=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var um=Object.freeze({__proto__:null,base32:em,base32upper:tm,base32pad:rm,base32padupper:im,base32hex:nm,base32hexupper:sm,base32hexpad:am,base32hexpadupper:om,base32z:cm});const hm=Jn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),lm=Jn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fm=Object.freeze({__proto__:null,base36:hm,base36upper:lm});const pm=Jn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dm=Jn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var gm=Object.freeze({__proto__:null,base58btc:pm,base58flickr:dm});const ym=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vm=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),_m=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mm=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var wm=Object.freeze({__proto__:null,base64:ym,base64pad:vm,base64url:_m,base64urlpad:mm});const Bl=Array.from(""),bm=Bl.reduce((h,i,r)=>(h[r]=i,h),[]),Em=Bl.reduce((h,i,r)=>(h[i.codePointAt(0)]=r,h),[]);function Im(h){return h.reduce((i,r)=>(i+=bm[r],i),"")}function xm(h){const i=[];for(const r of h){const s=Em[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(s)}return new Uint8Array(i)}const Sm=pa({prefix:"",name:"base256emoji",encode:Im,decode:xm});var Pm=Object.freeze({__proto__:null,base256emoji:Sm}),Om=Gl,Kh=128,Cm=127,Am=~Cm,Rm=Math.pow(2,31);function Gl(h,i,r){i=i||[],r=r||0;for(var s=r;h>=Rm;)i[r++]=h&255|Kh,h/=128;for(;h&Am;)i[r++]=h&255|Kh,h>>>=7;return i[r]=h|0,Gl.bytes=r-s+1,i}var Tm=nc,Nm=128,Bh=127;function nc(h,s){var r=0,s=s||0,a=0,l=s,m,b=h.length;do{if(l>=b)throw nc.bytes=0,new RangeError("Could not decode varint");m=h[l++],r+=a<28?(m&Bh)<<a:(m&Bh)*Math.pow(2,a),a+=7}while(m>=Nm);return nc.bytes=l-s,r}var Fm=Math.pow(2,7),Dm=Math.pow(2,14),jm=Math.pow(2,21),$m=Math.pow(2,28),qm=Math.pow(2,35),Lm=Math.pow(2,42),Mm=Math.pow(2,49),zm=Math.pow(2,56),Um=Math.pow(2,63),km=function(h){return h<Fm?1:h<Dm?2:h<jm?3:h<$m?4:h<qm?5:h<Lm?6:h<Mm?7:h<zm?8:h<Um?9:10},Hm={encode:Om,decode:Tm,encodingLength:km},Wl=Hm;const Gh=(h,i,r=0)=>(Wl.encode(h,i,r),i),Wh=h=>Wl.encodingLength(h),sc=(h,i)=>{const r=i.byteLength,s=Wh(h),a=s+Wh(r),l=new Uint8Array(a+r);return Gh(h,l,0),Gh(r,l,s),l.set(i,a),new Vm(h,r,i,l)};class Vm{constructor(i,r,s,a){this.code=i,this.size=r,this.digest=s,this.bytes=a}}const Jl=({name:h,code:i,encode:r})=>new Km(h,i,r);class Km{constructor(i,r,s){this.name=i,this.code=r,this.encode=s}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?sc(this.code,r):r.then(s=>sc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Ql=h=>async i=>new Uint8Array(await crypto.subtle.digest(h,i)),Bm=Jl({name:"sha2-256",code:18,encode:Ql("SHA-256")}),Gm=Jl({name:"sha2-512",code:19,encode:Ql("SHA-512")});var Wm=Object.freeze({__proto__:null,sha256:Bm,sha512:Gm});const Yl=0,Jm="identity",Xl=Vl,Qm=h=>sc(Yl,Xl(h)),Ym={code:Yl,name:Jm,encode:Xl,digest:Qm};var Xm=Object.freeze({__proto__:null,identity:Ym});new TextEncoder,new TextDecoder;const Jh={...V_,...B_,...W_,...Q_,...Z_,...um,...fm,...gm,...wm,...Pm};({...Wm,...Xm});function Zl(h){return globalThis.Buffer!=null?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):h}function Zm(h=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Zl(globalThis.Buffer.allocUnsafe(h)):new Uint8Array(h)}function ef(h,i,r,s){return{name:h,prefix:i,encoder:{name:h,prefix:i,encode:r},decoder:{decode:s}}}const Qh=ef("utf8","u",h=>"u"+new TextDecoder("utf8").decode(h),h=>new TextEncoder().encode(h.substring(1))),Go=ef("ascii","a",h=>{let i="a";for(let r=0;r<h.length;r++)i+=String.fromCharCode(h[r]);return i},h=>{h=h.substring(1);const i=Zm(h.length);for(let r=0;r<h.length;r++)i[r]=h.charCodeAt(r);return i}),ew={utf8:Qh,"utf-8":Qh,hex:Jh.base16,latin1:Go,ascii:Go,binary:Go,...Jh};function tw(h,i="utf8"){const r=ew[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Zl(globalThis.Buffer.from(h,"utf-8")):r.decoder.decode(`${r.prefix}${h}`)}const tf="wc",rw=2,vc="core",_i=`${tf}@2:${vc}:`,iw={name:vc,logger:"error"},nw={database:":memory:"},sw="crypto",Yh="client_ed25519_seed",aw=fe.ONE_DAY,ow="keychain",cw="0.3",uw="messages",hw="0.3",lw=fe.SIX_HOURS,fw="publisher",rf="irn",pw="error",nf="wss://relay.walletconnect.com",Xh="wss://relay.walletconnect.org",dw="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},gw="_subscription",ti={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},yw=fe.ONE_SECOND,vw="2.10.1",_w=1e4,mw="0.3",ww="WALLETCONNECT_CLIENT_ID",Ur={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},bw="subscription",Ew="0.3",Iw=fe.FIVE_SECONDS*1e3,xw="pairing",Sw="0.3",Ln={wc_pairingDelete:{req:{ttl:fe.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:fe.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:fe.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:fe.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:fe.ONE_DAY,prompt:!1,tag:0},res:{ttl:fe.ONE_DAY,prompt:!1,tag:0}}},Vn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},zr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Pw="history",Ow="0.3",Cw="expirer",Pr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Aw="0.3",Wo="verify-api",aa="https://verify.walletconnect.com",Zh="https://verify.walletconnect.org";class Rw{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=ow,this.version=cw,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:l}=se("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(l)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=i,this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,Cl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Al(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Tw{constructor(i,r,s){this.core=i,this.logger=r,this.name=sw,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),l=kh(a);return Hl(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=J0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const l=await this.getClientSeed(),m=kh(l),b=rc();return await S_(b,a,aw,m)},this.generateSharedKey=(a,l,m)=>{this.isInitialized();const b=this.getPrivateKey(a),I=Q0(b,l);return this.setSymKey(I,m)},this.setSymKey=async(a,l)=>{this.isInitialized();const m=l||Y0(a);return await this.keychain.set(m,a),m},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,l,m)=>{this.isInitialized();const b=X0(m),I=lc(l);if(bh(b)){const X=b.senderPublicKey,Z=b.receiverPublicKey;a=await this.generateSharedKey(X,Z)}const T=this.getSymKey(a),{type:M,senderPublicKey:Y}=b;return Z0({type:M,symKey:T,message:I,senderPublicKey:Y})},this.decode=async(a,l,m)=>{this.isInitialized();const b=e1(l,m);if(bh(b)){const I=b.receiverPublicKey,T=b.senderPublicKey;a=await this.generateSharedKey(I,T)}try{const I=this.getSymKey(a),T=t1({symKey:I,encoded:l});return Tl(T)}catch(I){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(I)}},this.getPayloadType=a=>{const l=Eh(a);return r1(l.type)},this.getPayloadSenderPublicKey=a=>{const l=Eh(a);return l.senderPublicKey?ha(l.senderPublicKey,i1):void 0},this.core=i,this.logger=De.generateChildLogger(r,this.name),this.keychain=s||new Rw(this.core,this.logger)}get context(){return De.getLoggerContext(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(Yh)}catch{i=rc(),await this.keychain.set(Yh,i)}return tw(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Nw extends i_{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=uw,this.version=hw,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const l=hn(a);let m=this.messages.get(s);return typeof m>"u"&&(m={}),typeof m[l]<"u"||(m[l]=a,this.messages.set(s,m),await this.persist()),l},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const l=this.get(s),m=hn(a);return typeof l[m]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=De.generateChildLogger(i,this.name),this.core=r}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,Cl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Al(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Fw extends n_{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new kr.EventEmitter,this.name=fw,this.queue=new Map,this.publishTimeout=fe.toMiliseconds(fe.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,l)=>{var m;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:l}});try{const b=(l==null?void 0:l.ttl)||lw,I=ic(l),T=(l==null?void 0:l.prompt)||!1,M=(l==null?void 0:l.tag)||0,Y=(l==null?void 0:l.id)||j1().toString(),X={topic:s,message:a,opts:{ttl:b,relay:I,prompt:T,tag:M,id:Y}},Z=setTimeout(()=>this.queue.set(Y,X),this.publishTimeout);try{await await Gn(this.rpcPublish(s,a,b,I,T,M,Y),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(Y),this.relayer.events.emit(Gt.publish,X)}catch(B){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(m=l==null?void 0:l.internal)!=null&&m.throwOnFailedPublish)throw this.removeRequestFromQueue(Y),B;return}finally{clearTimeout(Z)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:l}})}catch(b){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(b),b}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=i,this.logger=De.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return De.getLoggerContext(this.logger)}rpcPublish(i,r,s,a,l,m,b){var I,T,M,Y;const X={method:na(a.protocol).publish,params:{topic:i,message:r,ttl:s,prompt:l,tag:m},id:b};return vi((I=X.params)==null?void 0:I.prompt)&&((T=X.params)==null||delete T.prompt),vi((M=X.params)==null?void 0:M.tag)&&((Y=X.params)==null||delete Y.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:X}),this.relayer.request(X)}removeRequestFromQueue(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:s,opts:a}=i;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,i=>{this.removeRequestFromQueue(i.id.toString())})}}class Dw{constructor(){this.map=new Map,this.set=(i,r)=>{const s=this.get(i);this.exists(i,r)||this.map.set(i,[...s,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const s=this.get(i);if(!this.exists(i,r))return;const a=s.filter(l=>l!==r);if(!a.length){this.map.delete(i);return}this.map.set(i,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var jw=Object.defineProperty,$w=Object.defineProperties,qw=Object.getOwnPropertyDescriptors,el=Object.getOwnPropertySymbols,Lw=Object.prototype.hasOwnProperty,Mw=Object.prototype.propertyIsEnumerable,tl=(h,i,r)=>i in h?jw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,Mn=(h,i)=>{for(var r in i||(i={}))Lw.call(i,r)&&tl(h,r,i[r]);if(el)for(var r of el(i))Mw.call(i,r)&&tl(h,r,i[r]);return h},Jo=(h,i)=>$w(h,qw(i));class zw extends o_{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new Dw,this.events=new kr.EventEmitter,this.name=bw,this.version=Ew,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=_i,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const l=ic(a),m={topic:s,relay:l};this.pending.set(s,m);const b=await this.rpcSubscribe(s,l);return this.onSubscribe(b,m),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),b}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,l)=>{const m=new fe.Watch;m.start(this.pendingSubscriptionWatchLabel);const b=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(b),m.stop(this.pendingSubscriptionWatchLabel),a(!0)),m.elapsed(this.pendingSubscriptionWatchLabel)>=Iw&&(clearInterval(b),m.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=De.generateChildLogger(r,this.name),this.clientId=""}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let s=!1;try{s=this.getSubscription(i).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const s=this.topicMap.get(i);await Promise.all(s.map(async a=>await this.unsubscribeById(i,a,r)))}async unsubscribeById(i,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:s}});try{const a=ic(s);await this.rpcUnsubscribe(i,r,a);const l=tr("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(i,r){const s={method:na(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Gn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return hn(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,s={method:na(r.protocol).batchSubscribe,params:{topics:i.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Gn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(i,r,s){const a={method:na(s.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(i,r){this.setSubscription(i,Jo(Mn({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,Mn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,s),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,Mn({},r)),this.topicMap.set(r.topic,i),this.events.emit(Ur.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:s}=se("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const s=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(s.topic,i),this.events.emit(Ur.deleted,Jo(Mn({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ur.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ur.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=se("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);ln(r)&&this.onBatchSubscribe(r.map((s,a)=>Jo(Mn({},i[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(Ur.created,async i=>{const r=Ur.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(Ur.deleted,async i=>{const r=Ur.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var Uw=Object.defineProperty,rl=Object.getOwnPropertySymbols,kw=Object.prototype.hasOwnProperty,Hw=Object.prototype.propertyIsEnumerable,il=(h,i,r)=>i in h?Uw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,Vw=(h,i)=>{for(var r in i||(i={}))kw.call(i,r)&&il(h,r,i[r]);if(rl)for(var r of rl(i))Hw.call(i,r)&&il(h,r,i[r]);return h};class Kw extends s_{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new kr.EventEmitter,this.name=dw,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Gt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ti.payload,this.onPayloadHandler),this.provider.on(ti.connect,this.onConnectHandler),this.provider.on(ti.disconnect,this.onDisconnectHandler),this.provider.on(ti.error,this.onProviderErrorHandler)},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?De.generateChildLogger(i.logger,this.name):De.pino(De.getDefaultLoggerOptions({level:i.logger||pw})),this.messages=new Nw(this.logger,i.core),this.subscriber=new zw(this,this.logger),this.publisher=new Fw(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||nf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Xh}...`),await this.restartTransport(Xh)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},_w)}get context(){return De.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,s){this.isInitialized(),await this.publisher.publish(i,r,s),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(i))==null?void 0:s[0])||"";return a||(await Promise.all([new Promise(l=>{this.subscriber.once(Ur.created,m=>{m.topic===i&&l()})}),new Promise(async l=>{a=await this.subscriber.subscribe(i,r),l()})]),a)}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Gn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(i){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){i&&i!==this.relayUrl&&(this.relayUrl=i,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Ur.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Gn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ti.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(i){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=i||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ih())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new mi(new A_(n1({sdkVersion:vw,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:s}=i;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(i){const{topic:r,message:s}=i;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),pc(i)){if(!i.method.endsWith(gw))return;const r=i.params,{topic:s,message:a,publishedAt:l}=r.data,m={topic:s,message:a,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Vw({type:"event",event:r.id},m)),this.events.emit(r.id,m),await this.acknowledgePayload(i),await this.onMessageEvent(m)}else dc(i)&&this.events.emit(Gt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(Gt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=gc(i.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ti.payload,this.onPayloadHandler),this.provider.off(ti.connect,this.onConnectHandler),this.provider.off(ti.disconnect,this.onDisconnectHandler),this.provider.off(ti.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let i=await Ih();s1(async r=>{this.initialized&&i!==r&&(i=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(i=>this.logger.error(i))},fe.toMiliseconds(yw)))}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Bw=Object.defineProperty,nl=Object.getOwnPropertySymbols,Gw=Object.prototype.hasOwnProperty,Ww=Object.prototype.propertyIsEnumerable,sl=(h,i,r)=>i in h?Bw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,al=(h,i)=>{for(var r in i||(i={}))Gw.call(i,r)&&sl(h,r,i[r]);if(nl)for(var r of nl(i))Ww.call(i,r)&&sl(h,r,i[r]);return h};class da extends a_{constructor(i,r,s,a=_i,l=void 0){super(i,r,s,a),this.core=i,this.logger=r,this.name=s,this.map=new Map,this.version=mw,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(m=>{this.getKey&&m!==null&&!vi(m)?this.map.set(this.getKey(m),m):G0(m)?this.map.set(m.id,m):W0(m)&&this.map.set(m.topic,m)}),this.cached=[],this.initialized=!0)},this.set=async(m,b)=>{this.isInitialized(),this.map.has(m)?await this.update(m,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:m,value:b}),this.map.set(m,b),await this.persist())},this.get=m=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:m}),this.getData(m)),this.getAll=m=>(this.isInitialized(),m?this.values.filter(b=>Object.keys(m).every(I=>T_(b[I],m[I]))):this.values),this.update=async(m,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:m,update:b});const I=al(al({},this.getData(m)),b);this.map.set(m,I),await this.persist()},this.delete=async(m,b)=>{this.isInitialized(),this.map.has(m)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:m,reason:b}),this.map.delete(m),await this.persist())},this.logger=De.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=l}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:s}=se("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=se("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Jw{constructor(i,r){this.core=i,this.logger=r,this.name=xw,this.version=Sw,this.events=new hc,this.initialized=!1,this.storagePrefix=_i,this.ignoredPayloadTypes=[Sl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=rc(),a=await this.core.crypto.setSymKey(s),l=Fr(fe.FIVE_MINUTES),m={protocol:rf},b={topic:a,expiry:l,relay:m,active:!1},I=a1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:m});return await this.pairings.set(a,b),await this.core.relayer.subscribe(a),this.core.expirer.set(a,l),{topic:a,uri:I}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:l,relay:m}=o1(s.uri);let b;if(this.pairings.keys.includes(a)&&(b=this.pairings.get(a),b.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(l,a),await this.core.relayer.subscribe(a,{relay:m}));const I=Fr(fe.FIVE_MINUTES),T={topic:a,relay:m,expiry:I,active:!1};return await this.pairings.set(a,T),this.core.expirer.set(a,I),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Vn.create,T),T},this.activate=async({topic:s})=>{this.isInitialized();const a=Fr(fe.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const l=await this.sendRequest(a,"wc_pairingPing",{}),{done:m,resolve:b,reject:I}=on();this.events.once(Dt("pairing_ping",l),({error:T})=>{T?I(T):b()}),await m()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",tr("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,l)=>{const m=Bn(a,l),b=await this.core.crypto.encode(s,m),I=Ln[a].req;return this.core.history.set(s,m),this.core.relayer.publish(s,b,I),m.id},this.sendResult=async(s,a,l)=>{const m=gc(s,l),b=await this.core.crypto.encode(a,m),I=await this.core.history.get(a,s),T=Ln[I.request.method].res;await this.core.relayer.publish(a,b,T),await this.core.history.resolve(m)},this.sendError=async(s,a,l)=>{const m=fc(s,l),b=await this.core.crypto.encode(a,m),I=await this.core.history.get(a,s),T=Ln[I.request.method]?Ln[I.request.method].res:Ln.unregistered_method.res;await this.core.relayer.publish(a,b,T),await this.core.history.resolve(m)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,tr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>yi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:l}=s;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(a,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,l);default:return this.onUnknownRpcMethodRequest(a,l)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:l}=s,m=(await this.core.history.get(a,l.id)).request.method;switch(m){case"wc_pairingPing":return this.onPairingPingResponse(a,l);default:return this.onUnknownRpcMethodResponse(m)}},this.onPairingPingRequest=async(s,a)=>{const{id:l}=a;try{this.isValidPing({topic:s}),await this.sendResult(l,s,!0),this.events.emit(Vn.ping,{id:l,topic:s})}catch(m){await this.sendError(l,s,m),this.logger.error(m)}},this.onPairingPingResponse=(s,a)=>{const{id:l}=a;setTimeout(()=>{gi(a)?this.events.emit(Dt("pairing_ping",l),{}):ii(a)&&this.events.emit(Dt("pairing_ping",l),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:l}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Vn.delete,{id:l,topic:s})}catch(m){await this.sendError(l,s,m),this.logger.error(m)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:l,method:m}=a;try{if(this.registeredMethods.includes(m))return;const b=tr("WC_METHOD_UNSUPPORTED",m);await this.sendError(l,s,b),this.logger.error(b)}catch(b){await this.sendError(l,s,b),this.logger.error(b)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(tr("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!ur(s)){const{message:a}=se("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(a)}if(!c1(s.uri)){const{message:a}=se("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(a)}},this.isValidPing=async s=>{if(!ur(s)){const{message:l}=se("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(l)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!ur(s)){const{message:l}=se("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(l)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!cn(s,!1)){const{message:a}=se("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=se("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(yi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=se("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=i,this.logger=De.generateChildLogger(r,this.name),this.pairings=new da(this.core,this.logger,this.name,this.storagePrefix)}get context(){return De.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async i=>{const{topic:r,message:s}=i;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{pc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):dc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(Pr.expired,async i=>{const{topic:r}=Pl(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Vn.expire,{topic:r}))})}}class Qw extends r_{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new kr.EventEmitter,this.name=Pw,this.version=Ow,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:l}),this.records.has(a.id))return;const m={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:l,expiry:Fr(fe.THIRTY_DAYS)};this.records.set(m.id,m),this.events.emit(zr.created,m)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=ii(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(zr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(l=>{if(l.topic===s){if(typeof a<"u"&&l.id!==a)return;this.records.delete(l.id),this.events.emit(zr.deleted,l)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Bn(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(s)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:s}=se("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(zr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=se("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(zr.created,i=>{const r=zr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(zr.updated,i=>{const r=zr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(zr.deleted,i=>{const r=zr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{fe.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Yw extends c_{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new kr.EventEmitter,this.name=Cw,this.version=Aw,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const l=this.formatTarget(s),m={target:l,expiry:a};this.expirations.set(l,m),this.checkExpiry(l,m),this.events.emit(Pr.created,{target:l,expiration:m})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),l=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Pr.deleted,{target:a,expiration:l})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return u1(i);if(typeof i=="number")return h1(i);const{message:r}=se("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Pr.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=se("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:s}=se("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(i,r){const{expiry:s}=r;fe.toMiliseconds(s)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(Pr.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Pr.created,i=>{const r=Pr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Pr.expired,i=>{const r=Pr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Pr.deleted,i=>{const r=Pr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Xw extends u_{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=Wo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||l1()||!Ol())return;const a=(s==null?void 0:s.verifyUrl)||aa;this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Zh;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=(s==null?void 0:s.verifyUrl)||aa;let l;try{l=await this.fetchAttestation(s.attestationId,a)}catch(m){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(m),l=await this.fetchAttestation(s.attestationId,Zh)}return l},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const l=this.startAbortTimer(fe.ONE_SECOND*2),m=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(l),m.status===200?await m.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(l=>{if(document.getElementById(Wo))return l();window.addEventListener("message",a);const m=document.createElement("iframe");m.id=Wo,m.src=`${this.verifyUrl}/${this.projectId}`,m.style.display="none",document.body.append(m),this.iframe=m,s=l}),new Promise((l,m)=>setTimeout(()=>{window.removeEventListener("message",a),m("verify iframe load timeout")},fe.toMiliseconds(fe.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=De.generateChildLogger(r,this.name),this.verifyUrl=aa,this.abortController=new AbortController,this.isDevEnv=f1()&&{}.IS_VITEST}get context(){return De.getLoggerContext(this.logger)}startAbortTimer(i){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),fe.toMiliseconds(i))}}var Zw=Object.defineProperty,ol=Object.getOwnPropertySymbols,eb=Object.prototype.hasOwnProperty,tb=Object.prototype.propertyIsEnumerable,cl=(h,i,r)=>i in h?Zw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,ul=(h,i)=>{for(var r in i||(i={}))eb.call(i,r)&&cl(h,r,i[r]);if(ol)for(var r of ol(i))tb.call(i,r)&&cl(h,r,i[r]);return h};class _c extends t_{constructor(i){super(i),this.protocol=tf,this.version=rw,this.name=vc,this.events=new kr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||nf;const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:De.pino(De.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||iw.logger}));this.logger=De.generateChildLogger(r,this.name),this.heartbeat=new fn.HeartBeat,this.crypto=new Tw(this,this.logger,i==null?void 0:i.keychain),this.history=new Qw(this,this.logger),this.expirer=new Yw(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new K1(ul(ul({},nw),i==null?void 0:i.storageOptions)),this.relayer=new Kw({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Jw(this,this.logger),this.verify=new Xw(this.projectId||"",this.logger)}static async init(i){const r=new _c(i);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(ww,s),r}get context(){return De.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const rb=_c,sf="wc",af=2,of="client",mc=`${sf}@${af}:${of}:`,Qo={name:of,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},hl="WALLETCONNECT_DEEPLINK_CHOICE",ib="proposal",cf="Proposal expired",nb="session",ta=fe.SEVEN_DAYS,sb="engine",zn={wc_sessionPropose:{req:{ttl:fe.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:fe.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:fe.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:fe.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:fe.ONE_DAY,prompt:!1,tag:1104},res:{ttl:fe.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:fe.ONE_DAY,prompt:!1,tag:1106},res:{ttl:fe.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:fe.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:fe.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:fe.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:fe.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:fe.ONE_DAY,prompt:!1,tag:1112},res:{ttl:fe.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:fe.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:fe.THIRTY_SECONDS,prompt:!1,tag:1115}}},Yo={min:fe.FIVE_MINUTES,max:fe.SEVEN_DAYS},ri={idle:"IDLE",active:"ACTIVE"},ab="request",ob=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var cb=Object.defineProperty,ub=Object.defineProperties,hb=Object.getOwnPropertyDescriptors,ll=Object.getOwnPropertySymbols,lb=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,fl=(h,i,r)=>i in h?cb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,cr=(h,i)=>{for(var r in i||(i={}))lb.call(i,r)&&fl(h,r,i[r]);if(ll)for(var r of ll(i))fb.call(i,r)&&fl(h,r,i[r]);return h},Un=(h,i)=>ub(h,hb(i));class pb extends l_{constructor(i){super(i),this.name=sb,this.events=new hc,this.initialized=!1,this.ignoredPayloadTypes=[Sl],this.requestQueue={state:ri.idle,queue:[]},this.sessionRequestQueue={state:ri.idle,queue:[]},this.requestQueueDelay=fe.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(zn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},fe.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Un(cr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:l,optionalNamespaces:m,sessionProperties:b,relays:I}=s;let T=a,M,Y=!1;if(T&&(Y=this.client.core.pairing.pairings.get(T).active),!T||!Y){const{topic:pe,uri:he}=await this.client.core.pairing.create();T=pe,M=he}const X=await this.client.core.crypto.generateKeyPair(),Z=cr({requiredNamespaces:l,optionalNamespaces:m,relays:I??[{protocol:rf}],proposer:{publicKey:X,metadata:this.client.metadata}},b&&{sessionProperties:b}),{reject:B,resolve:ee,done:ce}=on(fe.FIVE_MINUTES,cf);if(this.events.once(Dt("session_connect"),async({error:pe,session:he})=>{if(pe)B(pe);else if(he){he.self.publicKey=X;const le=Un(cr({},he),{requiredNamespaces:he.requiredNamespaces,optionalNamespaces:he.optionalNamespaces});await this.client.session.set(he.topic,le),await this.setExpiry(he.topic,he.expiry),T&&await this.client.core.pairing.updateMetadata({topic:T,metadata:he.peer.metadata}),ee(le)}}),!T){const{message:pe}=se("NO_MATCHING_KEY",`connect() pairing topic: ${T}`);throw new Error(pe)}const me=await this.sendRequest({topic:T,method:"wc_sessionPropose",params:Z}),ge=Fr(fe.FIVE_MINUTES);return await this.setProposal(me,cr({id:me,expiry:ge},Z)),{uri:M,approval:ce}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:l,sessionProperties:m}=r,b=this.client.proposal.get(s);let{pairingTopic:I,proposer:T,requiredNamespaces:M,optionalNamespaces:Y}=b;I=I||"",sa(M)||(M=d1(l,"approve()"));const X=await this.client.core.crypto.generateKeyPair(),Z=T.publicKey,B=await this.client.core.crypto.generateSharedKey(X,Z);I&&s&&(await this.client.core.pairing.updateMetadata({topic:I,metadata:T.metadata}),await this.sendResult({id:s,topic:I,result:{relay:{protocol:a??"irn"},responderPublicKey:X}}),await this.client.proposal.delete(s,tr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:I}));const ee=cr({relay:{protocol:a??"irn"},namespaces:l,requiredNamespaces:M,optionalNamespaces:Y,pairingTopic:I,controller:{publicKey:X,metadata:this.client.metadata},expiry:Fr(ta)},m&&{sessionProperties:m});await this.client.core.relayer.subscribe(B),await this.sendRequest({topic:B,method:"wc_sessionSettle",params:ee,throwOnFailedPublish:!0});const ce=Un(cr({},ee),{topic:B,pairingTopic:I,acknowledged:!1,self:ee.controller,peer:{publicKey:T.publicKey,metadata:T.metadata},controller:X});return await this.client.session.set(B,ce),await this.setExpiry(B,Fr(ta)),{topic:B,acknowledged:()=>new Promise(me=>setTimeout(()=>me(this.client.session.get(B)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:l}=this.client.proposal.get(s);l&&(await this.sendError(s,l,a),await this.client.proposal.delete(s,tr("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,l=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:m,resolve:b,reject:I}=on();return this.events.once(Dt("session_update",l),({error:T})=>{T?I(T):b()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:m}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:l,resolve:m,reject:b}=on();return this.events.once(Dt("session_extend",a),({error:I})=>{I?b(I):m()}),await this.setExpiry(s,Fr(ta)),{acknowledged:l}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:l,expiry:m}=r,b=$1(),{done:I,resolve:T,reject:M}=on(m);return this.events.once(Dt("session_request",b),({error:Y,result:X})=>{Y?M(Y):T(X)}),await Promise.all([new Promise(async Y=>{await this.sendRequest({clientRpcId:b,topic:l,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:m,throwOnFailedPublish:!0}).catch(X=>M(X)),this.client.events.emit("session_request_sent",{topic:l,request:a,chainId:s,id:b}),Y()}),new Promise(async Y=>{const X=await this.client.core.storage.getItem(hl);g1({id:b,topic:l,wcDeepLink:X}),Y()}),I()]).then(Y=>Y[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:l}=a;gi(a)?await this.sendResult({id:l,topic:s,result:a.result,throwOnFailedPublish:!0}):ii(a)&&await this.sendError(l,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:l,resolve:m,reject:b}=on();this.events.once(Dt("session_ping",a),({error:I})=>{I?b(I):m()}),await l()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:l}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:l}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:tr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>y1(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(l=>{var m,b;return((m=l.peerMetadata)==null?void 0:m.url)&&((b=l.peerMetadata)==null?void 0:b.url)===r.peer.metadata.url&&l.topic&&l.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,tr("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(hl).catch(l=>this.client.logger.warn(l))},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,tr("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==r),a&&(this.sessionRequestQueue.state=ri.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=zn.wc_sessionRequest.req.ttl,{id:a,topic:l,params:m,verifyContext:b}=r;await this.client.pendingRequest.set(a,{id:a,topic:l,params:m,verifyContext:b}),s&&this.client.core.expirer.set(a,Fr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:l,expiry:m,relayRpcId:b,clientRpcId:I,throwOnFailedPublish:T}=r,M=Bn(a,l,I);if(Ol()&&ob.includes(a)){const Z=hn(JSON.stringify(M));this.client.core.verify.register({attestationId:Z})}const Y=await this.client.core.crypto.encode(s,M),X=zn[a].req;return m&&(X.ttl=m),b&&(X.id=b),this.client.core.history.set(s,M),T?(X.internal=Un(cr({},X.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,Y,X)):this.client.core.relayer.publish(s,Y,X).catch(Z=>this.client.logger.error(Z)),M.id},this.sendResult=async r=>{const{id:s,topic:a,result:l,throwOnFailedPublish:m}=r,b=gc(s,l),I=await this.client.core.crypto.encode(a,b),T=await this.client.core.history.get(a,s),M=zn[T.request.method].res;m?(M.internal=Un(cr({},M.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,I,M)):this.client.core.relayer.publish(a,I,M).catch(Y=>this.client.logger.error(Y)),await this.client.core.history.resolve(b)},this.sendError=async(r,s,a)=>{const l=fc(r,a),m=await this.client.core.crypto.encode(s,l),b=await this.client.core.history.get(s,r),I=zn[b.request.method].res;this.client.core.relayer.publish(s,m,I),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{yi(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{yi(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ri.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ri.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ri.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,l=a.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,l=(await this.client.core.history.get(s,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=se("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:l}=s;try{this.isValidConnect(cr({},s.params));const m=Fr(fe.FIVE_MINUTES),b=cr({id:l,pairingTopic:r,expiry:m},a);await this.setProposal(l,b);const I=hn(JSON.stringify(s)),T=await this.getVerifyContext(I,b.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:b,verifyContext:T})}catch(m){await this.sendError(l,r,m),this.client.logger.error(m)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(gi(s)){const{result:l}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const m=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:m});const b=m.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:b});const I=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:I});const T=await this.client.core.crypto.generateSharedKey(b,I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:T});const M=await this.client.core.relayer.subscribe(T);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:M}),await this.client.core.pairing.activate({topic:r})}else ii(s)&&(await this.client.proposal.delete(a,tr("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidSessionSettleRequest(l);const{relay:m,controller:b,expiry:I,namespaces:T,requiredNamespaces:M,optionalNamespaces:Y,sessionProperties:X,pairingTopic:Z}=s.params,B=cr({topic:r,relay:m,expiry:I,namespaces:T,acknowledged:!0,pairingTopic:Z,requiredNamespaces:M,optionalNamespaces:Y,controller:b.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:b.publicKey,metadata:b.metadata}},X&&{sessionProperties:X});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Dt("session_connect"),{session:B}),this.cleanupDuplicatePairings(B)}catch(m){await this.sendError(a,r,m),this.client.logger.error(m)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;gi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Dt("session_approve",a),{})):ii(s)&&(await this.client.session.delete(r,tr("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:l}=s;try{const m=`${r}_session_update`,b=ea.get(m);if(b&&this.isRequestOutOfSync(b,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(cr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:l,topic:r,result:!0}),this.client.events.emit("session_update",{id:l,topic:r,params:a}),ea.set(m,l)}catch(m){await this.sendError(l,r,m),this.client.logger.error(m)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;gi(s)?this.events.emit(Dt("session_update",a),{}):ii(s)&&this.events.emit(Dt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Fr(ta)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;gi(s)?this.events.emit(Dt("session_extend",a),{}):ii(s)&&this.events.emit(Dt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{gi(s)?this.events.emit(Dt("session_ping",a),{}):ii(s)&&this.events.emit(Dt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Gt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidRequest(cr({topic:r},l));const m=hn(JSON.stringify(Bn("wc_sessionRequest",l,a))),b=this.client.session.get(r),I=await this.getVerifyContext(m,b.peer.metadata),T={id:a,topic:r,params:l,verifyContext:I};await this.setPendingSessionRequest(T),this.addSessionRequestToSessionRequestQueue(T),this.processSessionRequestQueue()}catch(m){await this.sendError(a,r,m),this.client.logger.error(m)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;gi(s)?this.events.emit(Dt("session_request",a),{result:s.result}):ii(s)&&this.events.emit(Dt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:l}=s;try{const m=`${r}_session_event_${l.event.name}`,b=ea.get(m);if(b&&this.isRequestOutOfSync(b,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(cr({topic:r},l)),this.client.events.emit("session_event",{id:a,topic:r,params:l}),ea.set(m,a)}catch(m){await this.sendError(a,r,m),this.client.logger.error(m)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ri.idle,this.processSessionRequestQueue()},fe.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ri.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ri.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Bn("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer},s.id))},this.isValidConnect=async r=>{if(!ur(r)){const{message:I}=se("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(I)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:l,sessionProperties:m,relays:b}=r;if(vi(s)||await this.isValidPairingTopic(s),!v1(b,!0)){const{message:I}=se("MISSING_OR_INVALID",`connect() relays: ${b}`);throw new Error(I)}!vi(a)&&sa(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!vi(l)&&sa(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),vi(m)||this.validateSessionProps(m,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=_1(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!ur(r))throw new Error(se("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:l,sessionProperties:m}=r;await this.isValidProposalId(s);const b=this.client.proposal.get(s),I=zo(a,"approve()");if(I)throw new Error(I.message);const T=xh(b.requiredNamespaces,a,"approve()");if(T)throw new Error(T.message);if(!cn(l,!0)){const{message:M}=se("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(M)}vi(m)||this.validateSessionProps(m,"sessionProperties")},this.isValidReject=async r=>{if(!ur(r)){const{message:l}=se("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!m1(a)){const{message:l}=se("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!ur(r)){const{message:T}=se("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(T)}const{relay:s,controller:a,namespaces:l,expiry:m}=r;if(!w1(s)){const{message:T}=se("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(T)}const b=b1(a,"onSessionSettleRequest()");if(b)throw new Error(b.message);const I=zo(l,"onSessionSettleRequest()");if(I)throw new Error(I.message);if(yi(m)){const{message:T}=se("EXPIRED","onSessionSettleRequest()");throw new Error(T)}},this.isValidUpdate=async r=>{if(!ur(r)){const{message:I}=se("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(I)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const l=this.client.session.get(s),m=zo(a,"update()");if(m)throw new Error(m.message);const b=xh(l.requiredNamespaces,a,"update()");if(b)throw new Error(b.message)},this.isValidExtend=async r=>{if(!ur(r)){const{message:a}=se("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!ur(r)){const{message:I}=se("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(I)}const{topic:s,request:a,chainId:l,expiry:m}=r;await this.isValidSessionTopic(s);const{namespaces:b}=this.client.session.get(s);if(!Sh(b,l)){const{message:I}=se("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(I)}if(!E1(a)){const{message:I}=se("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(I)}if(!I1(b,l,a.method)){const{message:I}=se("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(I)}if(m&&!x1(m,Yo)){const{message:I}=se("MISSING_OR_INVALID",`request() expiry: ${m}. Expiry must be a number (in seconds) between ${Yo.min} and ${Yo.max}`);throw new Error(I)}},this.isValidRespond=async r=>{if(!ur(r)){const{message:l}=se("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:s,response:a}=r;if(await this.isValidSessionTopic(s),!S1(a)){const{message:l}=se("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!ur(r)){const{message:a}=se("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!ur(r)){const{message:b}=se("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(b)}const{topic:s,event:a,chainId:l}=r;await this.isValidSessionTopic(s);const{namespaces:m}=this.client.session.get(s);if(!Sh(m,l)){const{message:b}=se("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(b)}if(!P1(a)){const{message:b}=se("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(b)}if(!O1(m,l,a.name)){const{message:b}=se("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(b)}},this.isValidDisconnect=async r=>{if(!ur(r)){const{message:a}=se("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||aa,validation:"UNKNOWN",origin:s.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});l&&(a.verified.origin=l.origin,a.verified.isScam=l.isScam,a.verified.validation=l.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.info(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!cn(a,!1)){const{message:l}=se("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:i}=se("NOT_INITIALIZED",this.name);throw new Error(i)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async i=>{const{topic:r,message:s}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{pc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):dc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(Pr.expired,async i=>{const{topic:r,id:s}=Pl(i.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,se("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Vn.create,i=>this.onPairingCreated(i))}isValidPairingTopic(i){if(!cn(i,!1)){const{message:r}=se("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=se("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(yi(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=se("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!cn(i,!1)){const{message:r}=se("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=se("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(yi(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=se("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(cn(i,!1)){const{message:r}=se("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=se("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!C1(i)){const{message:r}=se("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=se("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(yi(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=se("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class db extends da{constructor(i,r){super(i,r,ib,mc),this.core=i,this.logger=r}}class gb extends da{constructor(i,r){super(i,r,nb,mc),this.core=i,this.logger=r}}class yb extends da{constructor(i,r){super(i,r,ab,mc,s=>s.id),this.core=i,this.logger=r}}let vb=class uf extends h_{constructor(i){super(i),this.protocol=sf,this.version=af,this.name=Qo.name,this.events=new kr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(i==null?void 0:i.name)||Qo.name,this.metadata=(i==null?void 0:i.metadata)||p1();const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:De.pino(De.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Qo.logger}));this.core=(i==null?void 0:i.core)||new rb(i),this.logger=De.generateChildLogger(r,this.name),this.session=new gb(this.core,this.logger),this.proposal=new db(this.core,this.logger),this.pendingRequest=new yb(this.core,this.logger),this.engine=new pb(this)}static async init(i){const r=new uf(i);return await r.initialize(),r}get context(){return De.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const pl="error",_b="wss://relay.walletconnect.com",mb="wc",wb="universal_provider",dl=`${mb}@2:${wb}:`,bb="https://rpc.walletconnect.com/v1/",wi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ac={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(h,i){(function(){var r,s="4.17.21",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",m="Expected a function",b="Invalid `variable` option passed into `_.template`",I="__lodash_hash_undefined__",T=500,M="__lodash_placeholder__",Y=1,X=2,Z=4,B=1,ee=2,ce=1,me=2,ge=4,pe=8,he=16,le=32,q=64,V=128,F=256,ue=512,f=30,v="...",_=800,S=16,y=1,g=2,j=3,W=1/0,J=9007199254740991,O=17976931348623157e292,$=0/0,Q=4294967295,re=Q-1,_e=Q>>>1,ut=[["ary",V],["bind",ce],["bindKey",me],["curry",pe],["curryRight",he],["flip",ue],["partial",le],["partialRight",q],["rearg",F]],be="[object Arguments]",xt="[object Array]",z="[object AsyncFunction]",L="[object Boolean]",N="[object Date]",c="[object DOMException]",P="[object Error]",ae="[object Function]",we="[object GeneratorFunction]",Pe="[object Map]",je="[object Number]",qe="[object Null]",Re="[object Object]",St="[object Promise]",_t="[object Proxy]",st="[object RegExp]",Me="[object Set]",Ye="[object String]",Xe="[object Symbol]",at="[object Undefined]",He="[object WeakMap]",Ze="[object WeakSet]",$e="[object ArrayBuffer]",Ke="[object DataView]",ht="[object Float32Array]",Ue="[object Float64Array]",Pt="[object Int8Array]",jt="[object Int16Array]",Ut="[object Int32Array]",kt="[object Uint8Array]",Lt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",rr="[object Uint32Array]",Dr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Hr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ni=/&(?:amp|lt|gt|quot|#39);/g,bi=/[&<>"']/g,lt=RegExp(ni.source),rt=RegExp(bi.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ot=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(dt.source),gt=/^\s+/,mt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,Rt=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ga=/[()=,{}\[\]\/\s]/,ya=/\\(\\)?/g,va=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vr=/\w*$/,_a=/^[-+]0x[0-9a-f]+$/i,ma=/^0b[01]+$/i,wa=/^\[object .+?Constructor\]$/,ba=/^0o[0-7]+$/i,Ea=/^(?:0|[1-9]\d*)$/,Vr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zi=/($^)/,Ia=/['\n\r\u2028\u2029\\]/g,Ui="\\ud800-\\udfff",xa="\\u0300-\\u036f",Sa="\\ufe20-\\ufe2f",ki="\\u20d0-\\u20ff",Qn=xa+Sa+ki,Yn="\\u2700-\\u27bf",Or="a-z\\xdf-\\xf6\\xf8-\\xff",Pa="\\xac\\xb1\\xd7\\xf7",Oa="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ca="\\u2000-\\u206f",Aa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xn="A-Z\\xc0-\\xd6\\xd8-\\xde",Zn="\\ufe0e\\ufe0f",Ei=Pa+Oa+Ca+Aa,dn="[']",Ii="["+Ui+"]",gn="["+Ei+"]",xi="["+Qn+"]",es="\\d+",Ra="["+Yn+"]",ts="["+Or+"]",rs="[^"+Ui+Ei+es+Yn+Or+Xn+"]",Hi="\\ud83c[\\udffb-\\udfff]",Ta="(?:"+xi+"|"+Hi+")",is="[^"+Ui+"]",Vi="(?:\\ud83c[\\udde6-\\uddff]){2}",si="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="["+Xn+"]",ns="\\u200d",ss="(?:"+ts+"|"+rs+")",jr="(?:"+hr+"|"+rs+")",as="(?:"+dn+"(?:d|ll|m|re|s|t|ve))?",os="(?:"+dn+"(?:D|LL|M|RE|S|T|VE))?",cs=Ta+"?",us="["+Zn+"]?",Na="(?:"+ns+"(?:"+[is,Vi,si].join("|")+")"+us+cs+")*",Kr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",hs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ls=us+cs+Na,Ki="(?:"+[Ra,Vi,si].join("|")+")"+ls,Fa="(?:"+[is+xi+"?",xi,Vi,si,Ii].join("|")+")",yn=RegExp(dn,"g"),Da=RegExp(xi,"g"),Bi=RegExp(Hi+"(?="+Hi+")|"+Fa+ls,"g"),fs=RegExp([hr+"?"+ts+"+"+as+"(?="+[gn,hr,"$"].join("|")+")",jr+"+"+os+"(?="+[gn,hr+ss,"$"].join("|")+")",hr+"?"+ss+"+"+as,hr+"+"+os,hs,Kr,es,Ki].join("|"),"g"),ps=RegExp("["+ns+Ui+Qn+Zn+"]"),Si=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ds=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ja=-1,Be={};Be[ht]=Be[Ue]=Be[Pt]=Be[jt]=Be[Ut]=Be[kt]=Be[Lt]=Be[Wt]=Be[rr]=!0,Be[be]=Be[xt]=Be[$e]=Be[L]=Be[Ke]=Be[N]=Be[P]=Be[ae]=Be[Pe]=Be[je]=Be[Re]=Be[st]=Be[Me]=Be[Ye]=Be[He]=!1;var Ve={};Ve[be]=Ve[xt]=Ve[$e]=Ve[Ke]=Ve[L]=Ve[N]=Ve[ht]=Ve[Ue]=Ve[Pt]=Ve[jt]=Ve[Ut]=Ve[Pe]=Ve[je]=Ve[Re]=Ve[st]=Ve[Me]=Ve[Ye]=Ve[Xe]=Ve[kt]=Ve[Lt]=Ve[Wt]=Ve[rr]=!0,Ve[P]=Ve[ae]=Ve[He]=!1;var w={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},K={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ie={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ge=parseFloat,Ie=parseInt,et=typeof kn=="object"&&kn&&kn.Object===Object&&kn,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Ne=et||Nt||Function("return this")(),We=i&&!i.nodeType&&i,wt=We&&!0&&h&&!h.nodeType&&h,ir=wt&&wt.exports===We,Ft=ir&&et.process,tt=function(){try{var A=wt&&wt.require&&wt.require("util").types;return A||Ft&&Ft.binding&&Ft.binding("util")}catch{}}(),Qt=tt&&tt.isArrayBuffer,Cr=tt&&tt.isDate,_r=tt&&tt.isMap,$r=tt&&tt.isRegExp,vn=tt&&tt.isSet,Pi=tt&&tt.isTypedArray;function Mt(A,U,D){switch(D.length){case 0:return A.call(U);case 1:return A.call(U,D[0]);case 2:return A.call(U,D[0],D[1]);case 3:return A.call(U,D[0],D[1],D[2])}return A.apply(U,D)}function ff(A,U,D,ne){for(var Ee=-1,Le=A==null?0:A.length;++Ee<Le;){var $t=A[Ee];U(ne,$t,D($t),A)}return ne}function mr(A,U){for(var D=-1,ne=A==null?0:A.length;++D<ne&&U(A[D],D,A)!==!1;);return A}function pf(A,U){for(var D=A==null?0:A.length;D--&&U(A[D],D,A)!==!1;);return A}function Ec(A,U){for(var D=-1,ne=A==null?0:A.length;++D<ne;)if(!U(A[D],D,A))return!1;return!0}function ai(A,U){for(var D=-1,ne=A==null?0:A.length,Ee=0,Le=[];++D<ne;){var $t=A[D];U($t,D,A)&&(Le[Ee++]=$t)}return Le}function gs(A,U){var D=A==null?0:A.length;return!!D&&Gi(A,U,0)>-1}function $a(A,U,D){for(var ne=-1,Ee=A==null?0:A.length;++ne<Ee;)if(D(U,A[ne]))return!0;return!1}function nt(A,U){for(var D=-1,ne=A==null?0:A.length,Ee=Array(ne);++D<ne;)Ee[D]=U(A[D],D,A);return Ee}function oi(A,U){for(var D=-1,ne=U.length,Ee=A.length;++D<ne;)A[Ee+D]=U[D];return A}function qa(A,U,D,ne){var Ee=-1,Le=A==null?0:A.length;for(ne&&Le&&(D=A[++Ee]);++Ee<Le;)D=U(D,A[Ee],Ee,A);return D}function df(A,U,D,ne){var Ee=A==null?0:A.length;for(ne&&Ee&&(D=A[--Ee]);Ee--;)D=U(D,A[Ee],Ee,A);return D}function La(A,U){for(var D=-1,ne=A==null?0:A.length;++D<ne;)if(U(A[D],D,A))return!0;return!1}var gf=Ma("length");function yf(A){return A.split("")}function vf(A){return A.match(Tt)||[]}function Ic(A,U,D){var ne;return D(A,function(Ee,Le,$t){if(U(Ee,Le,$t))return ne=Le,!1}),ne}function ys(A,U,D,ne){for(var Ee=A.length,Le=D+(ne?1:-1);ne?Le--:++Le<Ee;)if(U(A[Le],Le,A))return Le;return-1}function Gi(A,U,D){return U===U?Af(A,U,D):ys(A,xc,D)}function _f(A,U,D,ne){for(var Ee=D-1,Le=A.length;++Ee<Le;)if(ne(A[Ee],U))return Ee;return-1}function xc(A){return A!==A}function Sc(A,U){var D=A==null?0:A.length;return D?Ua(A,U)/D:$}function Ma(A){return function(U){return U==null?r:U[A]}}function za(A){return function(U){return A==null?r:A[U]}}function Pc(A,U,D,ne,Ee){return Ee(A,function(Le,$t,Je){D=ne?(ne=!1,Le):U(D,Le,$t,Je)}),D}function mf(A,U){var D=A.length;for(A.sort(U);D--;)A[D]=A[D].value;return A}function Ua(A,U){for(var D,ne=-1,Ee=A.length;++ne<Ee;){var Le=U(A[ne]);Le!==r&&(D=D===r?Le:D+Le)}return D}function ka(A,U){for(var D=-1,ne=Array(A);++D<A;)ne[D]=U(D);return ne}function wf(A,U){return nt(U,function(D){return[D,A[D]]})}function Oc(A){return A&&A.slice(0,Tc(A)+1).replace(gt,"")}function lr(A){return function(U){return A(U)}}function Ha(A,U){return nt(U,function(D){return A[D]})}function _n(A,U){return A.has(U)}function Cc(A,U){for(var D=-1,ne=A.length;++D<ne&&Gi(U,A[D],0)>-1;);return D}function Ac(A,U){for(var D=A.length;D--&&Gi(U,A[D],0)>-1;);return D}function bf(A,U){for(var D=A.length,ne=0;D--;)A[D]===U&&++ne;return ne}var Ef=za(w),If=za(C);function xf(A){return"\\"+ie[A]}function Sf(A,U){return A==null?r:A[U]}function Wi(A){return ps.test(A)}function Pf(A){return Si.test(A)}function Of(A){for(var U,D=[];!(U=A.next()).done;)D.push(U.value);return D}function Va(A){var U=-1,D=Array(A.size);return A.forEach(function(ne,Ee){D[++U]=[Ee,ne]}),D}function Rc(A,U){return function(D){return A(U(D))}}function ci(A,U){for(var D=-1,ne=A.length,Ee=0,Le=[];++D<ne;){var $t=A[D];($t===U||$t===M)&&(A[D]=M,Le[Ee++]=D)}return Le}function vs(A){var U=-1,D=Array(A.size);return A.forEach(function(ne){D[++U]=ne}),D}function Cf(A){var U=-1,D=Array(A.size);return A.forEach(function(ne){D[++U]=[ne,ne]}),D}function Af(A,U,D){for(var ne=D-1,Ee=A.length;++ne<Ee;)if(A[ne]===U)return ne;return-1}function Rf(A,U,D){for(var ne=D+1;ne--;)if(A[ne]===U)return ne;return ne}function Ji(A){return Wi(A)?Nf(A):gf(A)}function Ar(A){return Wi(A)?Ff(A):yf(A)}function Tc(A){for(var U=A.length;U--&&mt.test(A.charAt(U)););return U}var Tf=za(K);function Nf(A){for(var U=Bi.lastIndex=0;Bi.test(A);)++U;return U}function Ff(A){return A.match(Bi)||[]}function Df(A){return A.match(fs)||[]}var jf=function A(U){U=U==null?Ne:Qi.defaults(Ne.Object(),U,Qi.pick(Ne,ds));var D=U.Array,ne=U.Date,Ee=U.Error,Le=U.Function,$t=U.Math,Je=U.Object,Ka=U.RegExp,$f=U.String,wr=U.TypeError,_s=D.prototype,qf=Le.prototype,Yi=Je.prototype,ms=U["__core-js_shared__"],ws=qf.toString,ke=Yi.hasOwnProperty,Lf=0,Nc=function(){var e=/[^.]+$/.exec(ms&&ms.keys&&ms.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),bs=Yi.toString,Mf=ws.call(Je),zf=Ne._,Uf=Ka("^"+ws.call(ke).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Es=ir?U.Buffer:r,ui=U.Symbol,Is=U.Uint8Array,Fc=Es?Es.allocUnsafe:r,xs=Rc(Je.getPrototypeOf,Je),Dc=Je.create,jc=Yi.propertyIsEnumerable,Ss=_s.splice,$c=ui?ui.isConcatSpreadable:r,mn=ui?ui.iterator:r,Oi=ui?ui.toStringTag:r,Ps=function(){try{var e=Ni(Je,"defineProperty");return e({},"",{}),e}catch{}}(),kf=U.clearTimeout!==Ne.clearTimeout&&U.clearTimeout,Hf=ne&&ne.now!==Ne.Date.now&&ne.now,Vf=U.setTimeout!==Ne.setTimeout&&U.setTimeout,Os=$t.ceil,Cs=$t.floor,Ba=Je.getOwnPropertySymbols,Kf=Es?Es.isBuffer:r,qc=U.isFinite,Bf=_s.join,Gf=Rc(Je.keys,Je),qt=$t.max,Kt=$t.min,Wf=ne.now,Jf=U.parseInt,Lc=$t.random,Qf=_s.reverse,Ga=Ni(U,"DataView"),wn=Ni(U,"Map"),Wa=Ni(U,"Promise"),Xi=Ni(U,"Set"),bn=Ni(U,"WeakMap"),En=Ni(Je,"create"),As=bn&&new bn,Zi={},Yf=Fi(Ga),Xf=Fi(wn),Zf=Fi(Wa),ep=Fi(Xi),tp=Fi(bn),Rs=ui?ui.prototype:r,In=Rs?Rs.valueOf:r,Mc=Rs?Rs.toString:r;function p(e){if(vt(e)&&!xe(e)&&!(e instanceof Te)){if(e instanceof br)return e;if(ke.call(e,"__wrapped__"))return zu(e)}return new br(e)}var en=function(){function e(){}return function(t){if(!ct(t))return{};if(Dc)return Dc(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Ts(){}function br(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}p.templateSettings={escape:ft,evaluate:pt,interpolate:ot,variable:"",imports:{_:p}},p.prototype=Ts.prototype,p.prototype.constructor=p,br.prototype=en(Ts.prototype),br.prototype.constructor=br;function Te(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Q,this.__views__=[]}function rp(){var e=new Te(this.__wrapped__);return e.__actions__=nr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nr(this.__views__),e}function ip(){if(this.__filtered__){var e=new Te(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function np(){var e=this.__wrapped__.value(),t=this.__dir__,n=xe(e),o=t<0,u=n?e.length:0,d=yd(0,u,this.__views__),E=d.start,x=d.end,R=x-E,k=o?x:E-1,H=this.__iteratees__,G=H.length,te=0,oe=Kt(R,this.__takeCount__);if(!n||!o&&u==R&&oe==R)return uu(e,this.__actions__);var ye=[];e:for(;R--&&te<oe;){k+=t;for(var Oe=-1,ve=e[k];++Oe<G;){var Ae=H[Oe],Fe=Ae.iteratee,dr=Ae.type,Zt=Fe(ve);if(dr==g)ve=Zt;else if(!Zt){if(dr==y)continue e;break e}}ye[te++]=ve}return ye}Te.prototype=en(Ts.prototype),Te.prototype.constructor=Te;function Ci(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function sp(){this.__data__=En?En(null):{},this.size=0}function ap(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function op(e){var t=this.__data__;if(En){var n=t[e];return n===I?r:n}return ke.call(t,e)?t[e]:r}function cp(e){var t=this.__data__;return En?t[e]!==r:ke.call(t,e)}function up(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=En&&t===r?I:t,this}Ci.prototype.clear=sp,Ci.prototype.delete=ap,Ci.prototype.get=op,Ci.prototype.has=cp,Ci.prototype.set=up;function Br(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function hp(){this.__data__=[],this.size=0}function lp(e){var t=this.__data__,n=Ns(t,e);if(n<0)return!1;var o=t.length-1;return n==o?t.pop():Ss.call(t,n,1),--this.size,!0}function fp(e){var t=this.__data__,n=Ns(t,e);return n<0?r:t[n][1]}function pp(e){return Ns(this.__data__,e)>-1}function dp(e,t){var n=this.__data__,o=Ns(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this}Br.prototype.clear=hp,Br.prototype.delete=lp,Br.prototype.get=fp,Br.prototype.has=pp,Br.prototype.set=dp;function Gr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function gp(){this.size=0,this.__data__={hash:new Ci,map:new(wn||Br),string:new Ci}}function yp(e){var t=Vs(this,e).delete(e);return this.size-=t?1:0,t}function vp(e){return Vs(this,e).get(e)}function _p(e){return Vs(this,e).has(e)}function mp(e,t){var n=Vs(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this}Gr.prototype.clear=gp,Gr.prototype.delete=yp,Gr.prototype.get=vp,Gr.prototype.has=_p,Gr.prototype.set=mp;function Ai(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Gr;++t<n;)this.add(e[t])}function wp(e){return this.__data__.set(e,I),this}function bp(e){return this.__data__.has(e)}Ai.prototype.add=Ai.prototype.push=wp,Ai.prototype.has=bp;function Rr(e){var t=this.__data__=new Br(e);this.size=t.size}function Ep(){this.__data__=new Br,this.size=0}function Ip(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function xp(e){return this.__data__.get(e)}function Sp(e){return this.__data__.has(e)}function Pp(e,t){var n=this.__data__;if(n instanceof Br){var o=n.__data__;if(!wn||o.length<a-1)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new Gr(o)}return n.set(e,t),this.size=n.size,this}Rr.prototype.clear=Ep,Rr.prototype.delete=Ip,Rr.prototype.get=xp,Rr.prototype.has=Sp,Rr.prototype.set=Pp;function zc(e,t){var n=xe(e),o=!n&&Di(e),u=!n&&!o&&di(e),d=!n&&!o&&!u&&sn(e),E=n||o||u||d,x=E?ka(e.length,$f):[],R=x.length;for(var k in e)(t||ke.call(e,k))&&!(E&&(k=="length"||u&&(k=="offset"||k=="parent")||d&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||Yr(k,R)))&&x.push(k);return x}function Uc(e){var t=e.length;return t?e[so(0,t-1)]:r}function Op(e,t){return Ks(nr(e),Ri(t,0,e.length))}function Cp(e){return Ks(nr(e))}function Ja(e,t,n){(n!==r&&!Tr(e[t],n)||n===r&&!(t in e))&&Wr(e,t,n)}function xn(e,t,n){var o=e[t];(!(ke.call(e,t)&&Tr(o,n))||n===r&&!(t in e))&&Wr(e,t,n)}function Ns(e,t){for(var n=e.length;n--;)if(Tr(e[n][0],t))return n;return-1}function Ap(e,t,n,o){return hi(e,function(u,d,E){t(o,u,n(u),E)}),o}function kc(e,t){return e&&Lr(t,zt(t),e)}function Rp(e,t){return e&&Lr(t,ar(t),e)}function Wr(e,t,n){t=="__proto__"&&Ps?Ps(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Qa(e,t){for(var n=-1,o=t.length,u=D(o),d=e==null;++n<o;)u[n]=d?r:To(e,t[n]);return u}function Ri(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Er(e,t,n,o,u,d){var E,x=t&Y,R=t&X,k=t&Z;if(n&&(E=u?n(e,o,u,d):n(e)),E!==r)return E;if(!ct(e))return e;var H=xe(e);if(H){if(E=_d(e),!x)return nr(e,E)}else{var G=Bt(e),te=G==ae||G==we;if(di(e))return fu(e,x);if(G==Re||G==be||te&&!u){if(E=R||te?{}:Tu(e),!x)return R?od(e,Rp(E,e)):ad(e,kc(E,e))}else{if(!Ve[G])return u?e:{};E=md(e,G,x)}}d||(d=new Rr);var oe=d.get(e);if(oe)return oe;d.set(e,E),ah(e)?e.forEach(function(ve){E.add(Er(ve,t,n,ve,e,d))}):nh(e)&&e.forEach(function(ve,Ae){E.set(Ae,Er(ve,t,n,Ae,e,d))});var ye=k?R?vo:yo:R?ar:zt,Oe=H?r:ye(e);return mr(Oe||e,function(ve,Ae){Oe&&(Ae=ve,ve=e[Ae]),xn(E,Ae,Er(ve,t,n,Ae,e,d))}),E}function Tp(e){var t=zt(e);return function(n){return Hc(n,e,t)}}function Hc(e,t,n){var o=n.length;if(e==null)return!o;for(e=Je(e);o--;){var u=n[o],d=t[u],E=e[u];if(E===r&&!(u in e)||!d(E))return!1}return!0}function Vc(e,t,n){if(typeof e!="function")throw new wr(m);return Tn(function(){e.apply(r,n)},t)}function Sn(e,t,n,o){var u=-1,d=gs,E=!0,x=e.length,R=[],k=t.length;if(!x)return R;n&&(t=nt(t,lr(n))),o?(d=$a,E=!1):t.length>=a&&(d=_n,E=!1,t=new Ai(t));e:for(;++u<x;){var H=e[u],G=n==null?H:n(H);if(H=o||H!==0?H:0,E&&G===G){for(var te=k;te--;)if(t[te]===G)continue e;R.push(H)}else d(t,G,o)||R.push(H)}return R}var hi=vu(qr),Kc=vu(Xa,!0);function Np(e,t){var n=!0;return hi(e,function(o,u,d){return n=!!t(o,u,d),n}),n}function Fs(e,t,n){for(var o=-1,u=e.length;++o<u;){var d=e[o],E=t(d);if(E!=null&&(x===r?E===E&&!pr(E):n(E,x)))var x=E,R=d}return R}function Fp(e,t,n,o){var u=e.length;for(n=Se(n),n<0&&(n=-n>u?0:u+n),o=o===r||o>u?u:Se(o),o<0&&(o+=u),o=n>o?0:ch(o);n<o;)e[n++]=t;return e}function Bc(e,t){var n=[];return hi(e,function(o,u,d){t(o,u,d)&&n.push(o)}),n}function Ht(e,t,n,o,u){var d=-1,E=e.length;for(n||(n=bd),u||(u=[]);++d<E;){var x=e[d];t>0&&n(x)?t>1?Ht(x,t-1,n,o,u):oi(u,x):o||(u[u.length]=x)}return u}var Ya=_u(),Gc=_u(!0);function qr(e,t){return e&&Ya(e,t,zt)}function Xa(e,t){return e&&Gc(e,t,zt)}function Ds(e,t){return ai(t,function(n){return Xr(e[n])})}function Ti(e,t){t=fi(t,e);for(var n=0,o=t.length;e!=null&&n<o;)e=e[Mr(t[n++])];return n&&n==o?e:r}function Wc(e,t,n){var o=t(e);return xe(e)?o:oi(o,n(e))}function Yt(e){return e==null?e===r?at:qe:Oi&&Oi in Je(e)?gd(e):Cd(e)}function Za(e,t){return e>t}function Dp(e,t){return e!=null&&ke.call(e,t)}function jp(e,t){return e!=null&&t in Je(e)}function $p(e,t,n){return e>=Kt(t,n)&&e<qt(t,n)}function eo(e,t,n){for(var o=n?$a:gs,u=e[0].length,d=e.length,E=d,x=D(d),R=1/0,k=[];E--;){var H=e[E];E&&t&&(H=nt(H,lr(t))),R=Kt(H.length,R),x[E]=!n&&(t||u>=120&&H.length>=120)?new Ai(E&&H):r}H=e[0];var G=-1,te=x[0];e:for(;++G<u&&k.length<R;){var oe=H[G],ye=t?t(oe):oe;if(oe=n||oe!==0?oe:0,!(te?_n(te,ye):o(k,ye,n))){for(E=d;--E;){var Oe=x[E];if(!(Oe?_n(Oe,ye):o(e[E],ye,n)))continue e}te&&te.push(ye),k.push(oe)}}return k}function qp(e,t,n,o){return qr(e,function(u,d,E){t(o,n(u),d,E)}),o}function Pn(e,t,n){t=fi(t,e),e=ju(e,t);var o=e==null?e:e[Mr(xr(t))];return o==null?r:Mt(o,e,n)}function Jc(e){return vt(e)&&Yt(e)==be}function Lp(e){return vt(e)&&Yt(e)==$e}function Mp(e){return vt(e)&&Yt(e)==N}function On(e,t,n,o,u){return e===t?!0:e==null||t==null||!vt(e)&&!vt(t)?e!==e&&t!==t:zp(e,t,n,o,On,u)}function zp(e,t,n,o,u,d){var E=xe(e),x=xe(t),R=E?xt:Bt(e),k=x?xt:Bt(t);R=R==be?Re:R,k=k==be?Re:k;var H=R==Re,G=k==Re,te=R==k;if(te&&di(e)){if(!di(t))return!1;E=!0,H=!1}if(te&&!H)return d||(d=new Rr),E||sn(e)?Cu(e,t,n,o,u,d):pd(e,t,R,n,o,u,d);if(!(n&B)){var oe=H&&ke.call(e,"__wrapped__"),ye=G&&ke.call(t,"__wrapped__");if(oe||ye){var Oe=oe?e.value():e,ve=ye?t.value():t;return d||(d=new Rr),u(Oe,ve,n,o,d)}}return te?(d||(d=new Rr),dd(e,t,n,o,u,d)):!1}function Up(e){return vt(e)&&Bt(e)==Pe}function to(e,t,n,o){var u=n.length,d=u,E=!o;if(e==null)return!d;for(e=Je(e);u--;){var x=n[u];if(E&&x[2]?x[1]!==e[x[0]]:!(x[0]in e))return!1}for(;++u<d;){x=n[u];var R=x[0],k=e[R],H=x[1];if(E&&x[2]){if(k===r&&!(R in e))return!1}else{var G=new Rr;if(o)var te=o(k,H,R,e,t,G);if(!(te===r?On(H,k,B|ee,o,G):te))return!1}}return!0}function Qc(e){if(!ct(e)||Id(e))return!1;var t=Xr(e)?Uf:wa;return t.test(Fi(e))}function kp(e){return vt(e)&&Yt(e)==st}function Hp(e){return vt(e)&&Bt(e)==Me}function Vp(e){return vt(e)&&Ys(e.length)&&!!Be[Yt(e)]}function Yc(e){return typeof e=="function"?e:e==null?or:typeof e=="object"?xe(e)?eu(e[0],e[1]):Zc(e):mh(e)}function ro(e){if(!Rn(e))return Gf(e);var t=[];for(var n in Je(e))ke.call(e,n)&&n!="constructor"&&t.push(n);return t}function Kp(e){if(!ct(e))return Od(e);var t=Rn(e),n=[];for(var o in e)o=="constructor"&&(t||!ke.call(e,o))||n.push(o);return n}function io(e,t){return e<t}function Xc(e,t){var n=-1,o=sr(e)?D(e.length):[];return hi(e,function(u,d,E){o[++n]=t(u,d,E)}),o}function Zc(e){var t=mo(e);return t.length==1&&t[0][2]?Fu(t[0][0],t[0][1]):function(n){return n===e||to(n,e,t)}}function eu(e,t){return bo(e)&&Nu(t)?Fu(Mr(e),t):function(n){var o=To(n,e);return o===r&&o===t?No(n,e):On(t,o,B|ee)}}function js(e,t,n,o,u){e!==t&&Ya(t,function(d,E){if(u||(u=new Rr),ct(d))Bp(e,t,E,n,js,o,u);else{var x=o?o(Io(e,E),d,E+"",e,t,u):r;x===r&&(x=d),Ja(e,E,x)}},ar)}function Bp(e,t,n,o,u,d,E){var x=Io(e,n),R=Io(t,n),k=E.get(R);if(k){Ja(e,n,k);return}var H=d?d(x,R,n+"",e,t,E):r,G=H===r;if(G){var te=xe(R),oe=!te&&di(R),ye=!te&&!oe&&sn(R);H=R,te||oe||ye?xe(x)?H=x:bt(x)?H=nr(x):oe?(G=!1,H=fu(R,!0)):ye?(G=!1,H=pu(R,!0)):H=[]:Nn(R)||Di(R)?(H=x,Di(x)?H=uh(x):(!ct(x)||Xr(x))&&(H=Tu(R))):G=!1}G&&(E.set(R,H),u(H,R,o,d,E),E.delete(R)),Ja(e,n,H)}function tu(e,t){var n=e.length;if(n)return t+=t<0?n:0,Yr(t,n)?e[t]:r}function ru(e,t,n){t.length?t=nt(t,function(d){return xe(d)?function(E){return Ti(E,d.length===1?d[0]:d)}:d}):t=[or];var o=-1;t=nt(t,lr(de()));var u=Xc(e,function(d,E,x){var R=nt(t,function(k){return k(d)});return{criteria:R,index:++o,value:d}});return mf(u,function(d,E){return sd(d,E,n)})}function Gp(e,t){return iu(e,t,function(n,o){return No(e,o)})}function iu(e,t,n){for(var o=-1,u=t.length,d={};++o<u;){var E=t[o],x=Ti(e,E);n(x,E)&&Cn(d,fi(E,e),x)}return d}function Wp(e){return function(t){return Ti(t,e)}}function no(e,t,n,o){var u=o?_f:Gi,d=-1,E=t.length,x=e;for(e===t&&(t=nr(t)),n&&(x=nt(e,lr(n)));++d<E;)for(var R=0,k=t[d],H=n?n(k):k;(R=u(x,H,R,o))>-1;)x!==e&&Ss.call(x,R,1),Ss.call(e,R,1);return e}function nu(e,t){for(var n=e?t.length:0,o=n-1;n--;){var u=t[n];if(n==o||u!==d){var d=u;Yr(u)?Ss.call(e,u,1):co(e,u)}}return e}function so(e,t){return e+Cs(Lc()*(t-e+1))}function Jp(e,t,n,o){for(var u=-1,d=qt(Os((t-e)/(n||1)),0),E=D(d);d--;)E[o?d:++u]=e,e+=n;return E}function ao(e,t){var n="";if(!e||t<1||t>J)return n;do t%2&&(n+=e),t=Cs(t/2),t&&(e+=e);while(t);return n}function Ce(e,t){return xo(Du(e,t,or),e+"")}function Qp(e){return Uc(an(e))}function Yp(e,t){var n=an(e);return Ks(n,Ri(t,0,n.length))}function Cn(e,t,n,o){if(!ct(e))return e;t=fi(t,e);for(var u=-1,d=t.length,E=d-1,x=e;x!=null&&++u<d;){var R=Mr(t[u]),k=n;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(u!=E){var H=x[R];k=o?o(H,R,x):r,k===r&&(k=ct(H)?H:Yr(t[u+1])?[]:{})}xn(x,R,k),x=x[R]}return e}var su=As?function(e,t){return As.set(e,t),e}:or,Xp=Ps?function(e,t){return Ps(e,"toString",{configurable:!0,enumerable:!1,value:Do(t),writable:!0})}:or;function Zp(e){return Ks(an(e))}function Ir(e,t,n){var o=-1,u=e.length;t<0&&(t=-t>u?0:u+t),n=n>u?u:n,n<0&&(n+=u),u=t>n?0:n-t>>>0,t>>>=0;for(var d=D(u);++o<u;)d[o]=e[o+t];return d}function ed(e,t){var n;return hi(e,function(o,u,d){return n=t(o,u,d),!n}),!!n}function $s(e,t,n){var o=0,u=e==null?o:e.length;if(typeof t=="number"&&t===t&&u<=_e){for(;o<u;){var d=o+u>>>1,E=e[d];E!==null&&!pr(E)&&(n?E<=t:E<t)?o=d+1:u=d}return u}return oo(e,t,or,n)}function oo(e,t,n,o){var u=0,d=e==null?0:e.length;if(d===0)return 0;t=n(t);for(var E=t!==t,x=t===null,R=pr(t),k=t===r;u<d;){var H=Cs((u+d)/2),G=n(e[H]),te=G!==r,oe=G===null,ye=G===G,Oe=pr(G);if(E)var ve=o||ye;else k?ve=ye&&(o||te):x?ve=ye&&te&&(o||!oe):R?ve=ye&&te&&!oe&&(o||!Oe):oe||Oe?ve=!1:ve=o?G<=t:G<t;ve?u=H+1:d=H}return Kt(d,re)}function au(e,t){for(var n=-1,o=e.length,u=0,d=[];++n<o;){var E=e[n],x=t?t(E):E;if(!n||!Tr(x,R)){var R=x;d[u++]=E===0?0:E}}return d}function ou(e){return typeof e=="number"?e:pr(e)?$:+e}function fr(e){if(typeof e=="string")return e;if(xe(e))return nt(e,fr)+"";if(pr(e))return Mc?Mc.call(e):"";var t=e+"";return t=="0"&&1/e==-W?"-0":t}function li(e,t,n){var o=-1,u=gs,d=e.length,E=!0,x=[],R=x;if(n)E=!1,u=$a;else if(d>=a){var k=t?null:ld(e);if(k)return vs(k);E=!1,u=_n,R=new Ai}else R=t?[]:x;e:for(;++o<d;){var H=e[o],G=t?t(H):H;if(H=n||H!==0?H:0,E&&G===G){for(var te=R.length;te--;)if(R[te]===G)continue e;t&&R.push(G),x.push(H)}else u(R,G,n)||(R!==x&&R.push(G),x.push(H))}return x}function co(e,t){return t=fi(t,e),e=ju(e,t),e==null||delete e[Mr(xr(t))]}function cu(e,t,n,o){return Cn(e,t,n(Ti(e,t)),o)}function qs(e,t,n,o){for(var u=e.length,d=o?u:-1;(o?d--:++d<u)&&t(e[d],d,e););return n?Ir(e,o?0:d,o?d+1:u):Ir(e,o?d+1:0,o?u:d)}function uu(e,t){var n=e;return n instanceof Te&&(n=n.value()),qa(t,function(o,u){return u.func.apply(u.thisArg,oi([o],u.args))},n)}function uo(e,t,n){var o=e.length;if(o<2)return o?li(e[0]):[];for(var u=-1,d=D(o);++u<o;)for(var E=e[u],x=-1;++x<o;)x!=u&&(d[u]=Sn(d[u]||E,e[x],t,n));return li(Ht(d,1),t,n)}function hu(e,t,n){for(var o=-1,u=e.length,d=t.length,E={};++o<u;){var x=o<d?t[o]:r;n(E,e[o],x)}return E}function ho(e){return bt(e)?e:[]}function lo(e){return typeof e=="function"?e:or}function fi(e,t){return xe(e)?e:bo(e,t)?[e]:Mu(ze(e))}var td=Ce;function pi(e,t,n){var o=e.length;return n=n===r?o:n,!t&&n>=o?e:Ir(e,t,n)}var lu=kf||function(e){return Ne.clearTimeout(e)};function fu(e,t){if(t)return e.slice();var n=e.length,o=Fc?Fc(n):new e.constructor(n);return e.copy(o),o}function fo(e){var t=new e.constructor(e.byteLength);return new Is(t).set(new Is(e)),t}function rd(e,t){var n=t?fo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function id(e){var t=new e.constructor(e.source,vr.exec(e));return t.lastIndex=e.lastIndex,t}function nd(e){return In?Je(In.call(e)):{}}function pu(e,t){var n=t?fo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function du(e,t){if(e!==t){var n=e!==r,o=e===null,u=e===e,d=pr(e),E=t!==r,x=t===null,R=t===t,k=pr(t);if(!x&&!k&&!d&&e>t||d&&E&&R&&!x&&!k||o&&E&&R||!n&&R||!u)return 1;if(!o&&!d&&!k&&e<t||k&&n&&u&&!o&&!d||x&&n&&u||!E&&u||!R)return-1}return 0}function sd(e,t,n){for(var o=-1,u=e.criteria,d=t.criteria,E=u.length,x=n.length;++o<E;){var R=du(u[o],d[o]);if(R){if(o>=x)return R;var k=n[o];return R*(k=="desc"?-1:1)}}return e.index-t.index}function gu(e,t,n,o){for(var u=-1,d=e.length,E=n.length,x=-1,R=t.length,k=qt(d-E,0),H=D(R+k),G=!o;++x<R;)H[x]=t[x];for(;++u<E;)(G||u<d)&&(H[n[u]]=e[u]);for(;k--;)H[x++]=e[u++];return H}function yu(e,t,n,o){for(var u=-1,d=e.length,E=-1,x=n.length,R=-1,k=t.length,H=qt(d-x,0),G=D(H+k),te=!o;++u<H;)G[u]=e[u];for(var oe=u;++R<k;)G[oe+R]=t[R];for(;++E<x;)(te||u<d)&&(G[oe+n[E]]=e[u++]);return G}function nr(e,t){var n=-1,o=e.length;for(t||(t=D(o));++n<o;)t[n]=e[n];return t}function Lr(e,t,n,o){var u=!n;n||(n={});for(var d=-1,E=t.length;++d<E;){var x=t[d],R=o?o(n[x],e[x],x,n,e):r;R===r&&(R=e[x]),u?Wr(n,x,R):xn(n,x,R)}return n}function ad(e,t){return Lr(e,wo(e),t)}function od(e,t){return Lr(e,Au(e),t)}function Ls(e,t){return function(n,o){var u=xe(n)?ff:Ap,d=t?t():{};return u(n,e,de(o,2),d)}}function tn(e){return Ce(function(t,n){var o=-1,u=n.length,d=u>1?n[u-1]:r,E=u>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(u--,d):r,E&&Xt(n[0],n[1],E)&&(d=u<3?r:d,u=1),t=Je(t);++o<u;){var x=n[o];x&&e(t,x,o,d)}return t})}function vu(e,t){return function(n,o){if(n==null)return n;if(!sr(n))return e(n,o);for(var u=n.length,d=t?u:-1,E=Je(n);(t?d--:++d<u)&&o(E[d],d,E)!==!1;);return n}}function _u(e){return function(t,n,o){for(var u=-1,d=Je(t),E=o(t),x=E.length;x--;){var R=E[e?x:++u];if(n(d[R],R,d)===!1)break}return t}}function cd(e,t,n){var o=t&ce,u=An(e);function d(){var E=this&&this!==Ne&&this instanceof d?u:e;return E.apply(o?n:this,arguments)}return d}function mu(e){return function(t){t=ze(t);var n=Wi(t)?Ar(t):r,o=n?n[0]:t.charAt(0),u=n?pi(n,1).join(""):t.slice(1);return o[e]()+u}}function rn(e){return function(t){return qa(vh(yh(t).replace(yn,"")),e,"")}}function An(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=en(e.prototype),o=e.apply(n,t);return ct(o)?o:n}}function ud(e,t,n){var o=An(e);function u(){for(var d=arguments.length,E=D(d),x=d,R=nn(u);x--;)E[x]=arguments[x];var k=d<3&&E[0]!==R&&E[d-1]!==R?[]:ci(E,R);if(d-=k.length,d<n)return xu(e,t,Ms,u.placeholder,r,E,k,r,r,n-d);var H=this&&this!==Ne&&this instanceof u?o:e;return Mt(H,this,E)}return u}function wu(e){return function(t,n,o){var u=Je(t);if(!sr(t)){var d=de(n,3);t=zt(t),n=function(x){return d(u[x],x,u)}}var E=e(t,n,o);return E>-1?u[d?t[E]:E]:r}}function bu(e){return Qr(function(t){var n=t.length,o=n,u=br.prototype.thru;for(e&&t.reverse();o--;){var d=t[o];if(typeof d!="function")throw new wr(m);if(u&&!E&&Hs(d)=="wrapper")var E=new br([],!0)}for(o=E?o:n;++o<n;){d=t[o];var x=Hs(d),R=x=="wrapper"?_o(d):r;R&&Eo(R[0])&&R[1]==(V|pe|le|F)&&!R[4].length&&R[9]==1?E=E[Hs(R[0])].apply(E,R[3]):E=d.length==1&&Eo(d)?E[x]():E.thru(d)}return function(){var k=arguments,H=k[0];if(E&&k.length==1&&xe(H))return E.plant(H).value();for(var G=0,te=n?t[G].apply(this,k):H;++G<n;)te=t[G].call(this,te);return te}})}function Ms(e,t,n,o,u,d,E,x,R,k){var H=t&V,G=t&ce,te=t&me,oe=t&(pe|he),ye=t&ue,Oe=te?r:An(e);function ve(){for(var Ae=arguments.length,Fe=D(Ae),dr=Ae;dr--;)Fe[dr]=arguments[dr];if(oe)var Zt=nn(ve),gr=bf(Fe,Zt);if(o&&(Fe=gu(Fe,o,u,oe)),d&&(Fe=yu(Fe,d,E,oe)),Ae-=gr,oe&&Ae<k){var Et=ci(Fe,Zt);return xu(e,t,Ms,ve.placeholder,n,Fe,Et,x,R,k-Ae)}var Nr=G?n:this,ei=te?Nr[e]:e;return Ae=Fe.length,x?Fe=Ad(Fe,x):ye&&Ae>1&&Fe.reverse(),H&&R<Ae&&(Fe.length=R),this&&this!==Ne&&this instanceof ve&&(ei=Oe||An(ei)),ei.apply(Nr,Fe)}return ve}function Eu(e,t){return function(n,o){return qp(n,e,t(o),{})}}function zs(e,t){return function(n,o){var u;if(n===r&&o===r)return t;if(n!==r&&(u=n),o!==r){if(u===r)return o;typeof n=="string"||typeof o=="string"?(n=fr(n),o=fr(o)):(n=ou(n),o=ou(o)),u=e(n,o)}return u}}function po(e){return Qr(function(t){return t=nt(t,lr(de())),Ce(function(n){var o=this;return e(t,function(u){return Mt(u,o,n)})})})}function Us(e,t){t=t===r?" ":fr(t);var n=t.length;if(n<2)return n?ao(t,e):t;var o=ao(t,Os(e/Ji(t)));return Wi(t)?pi(Ar(o),0,e).join(""):o.slice(0,e)}function hd(e,t,n,o){var u=t&ce,d=An(e);function E(){for(var x=-1,R=arguments.length,k=-1,H=o.length,G=D(H+R),te=this&&this!==Ne&&this instanceof E?d:e;++k<H;)G[k]=o[k];for(;R--;)G[k++]=arguments[++x];return Mt(te,u?n:this,G)}return E}function Iu(e){return function(t,n,o){return o&&typeof o!="number"&&Xt(t,n,o)&&(n=o=r),t=Zr(t),n===r?(n=t,t=0):n=Zr(n),o=o===r?t<n?1:-1:Zr(o),Jp(t,n,o,e)}}function ks(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Sr(t),n=Sr(n)),e(t,n)}}function xu(e,t,n,o,u,d,E,x,R,k){var H=t&pe,G=H?E:r,te=H?r:E,oe=H?d:r,ye=H?r:d;t|=H?le:q,t&=~(H?q:le),t&ge||(t&=~(ce|me));var Oe=[e,t,u,oe,G,ye,te,x,R,k],ve=n.apply(r,Oe);return Eo(e)&&$u(ve,Oe),ve.placeholder=o,qu(ve,e,t)}function go(e){var t=$t[e];return function(n,o){if(n=Sr(n),o=o==null?0:Kt(Se(o),292),o&&qc(n)){var u=(ze(n)+"e").split("e"),d=t(u[0]+"e"+(+u[1]+o));return u=(ze(d)+"e").split("e"),+(u[0]+"e"+(+u[1]-o))}return t(n)}}var ld=Xi&&1/vs(new Xi([,-0]))[1]==W?function(e){return new Xi(e)}:qo;function Su(e){return function(t){var n=Bt(t);return n==Pe?Va(t):n==Me?Cf(t):wf(t,e(t))}}function Jr(e,t,n,o,u,d,E,x){var R=t&me;if(!R&&typeof e!="function")throw new wr(m);var k=o?o.length:0;if(k||(t&=~(le|q),o=u=r),E=E===r?E:qt(Se(E),0),x=x===r?x:Se(x),k-=u?u.length:0,t&q){var H=o,G=u;o=u=r}var te=R?r:_o(e),oe=[e,t,n,o,u,H,G,d,E,x];if(te&&Pd(oe,te),e=oe[0],t=oe[1],n=oe[2],o=oe[3],u=oe[4],x=oe[9]=oe[9]===r?R?0:e.length:qt(oe[9]-k,0),!x&&t&(pe|he)&&(t&=~(pe|he)),!t||t==ce)var ye=cd(e,t,n);else t==pe||t==he?ye=ud(e,t,x):(t==le||t==(ce|le))&&!u.length?ye=hd(e,t,n,o):ye=Ms.apply(r,oe);var Oe=te?su:$u;return qu(Oe(ye,oe),e,t)}function Pu(e,t,n,o){return e===r||Tr(e,Yi[n])&&!ke.call(o,n)?t:e}function Ou(e,t,n,o,u,d){return ct(e)&&ct(t)&&(d.set(t,e),js(e,t,r,Ou,d),d.delete(t)),e}function fd(e){return Nn(e)?r:e}function Cu(e,t,n,o,u,d){var E=n&B,x=e.length,R=t.length;if(x!=R&&!(E&&R>x))return!1;var k=d.get(e),H=d.get(t);if(k&&H)return k==t&&H==e;var G=-1,te=!0,oe=n&ee?new Ai:r;for(d.set(e,t),d.set(t,e);++G<x;){var ye=e[G],Oe=t[G];if(o)var ve=E?o(Oe,ye,G,t,e,d):o(ye,Oe,G,e,t,d);if(ve!==r){if(ve)continue;te=!1;break}if(oe){if(!La(t,function(Ae,Fe){if(!_n(oe,Fe)&&(ye===Ae||u(ye,Ae,n,o,d)))return oe.push(Fe)})){te=!1;break}}else if(!(ye===Oe||u(ye,Oe,n,o,d))){te=!1;break}}return d.delete(e),d.delete(t),te}function pd(e,t,n,o,u,d,E){switch(n){case Ke:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case $e:return!(e.byteLength!=t.byteLength||!d(new Is(e),new Is(t)));case L:case N:case je:return Tr(+e,+t);case P:return e.name==t.name&&e.message==t.message;case st:case Ye:return e==t+"";case Pe:var x=Va;case Me:var R=o&B;if(x||(x=vs),e.size!=t.size&&!R)return!1;var k=E.get(e);if(k)return k==t;o|=ee,E.set(e,t);var H=Cu(x(e),x(t),o,u,d,E);return E.delete(e),H;case Xe:if(In)return In.call(e)==In.call(t)}return!1}function dd(e,t,n,o,u,d){var E=n&B,x=yo(e),R=x.length,k=yo(t),H=k.length;if(R!=H&&!E)return!1;for(var G=R;G--;){var te=x[G];if(!(E?te in t:ke.call(t,te)))return!1}var oe=d.get(e),ye=d.get(t);if(oe&&ye)return oe==t&&ye==e;var Oe=!0;d.set(e,t),d.set(t,e);for(var ve=E;++G<R;){te=x[G];var Ae=e[te],Fe=t[te];if(o)var dr=E?o(Fe,Ae,te,t,e,d):o(Ae,Fe,te,e,t,d);if(!(dr===r?Ae===Fe||u(Ae,Fe,n,o,d):dr)){Oe=!1;break}ve||(ve=te=="constructor")}if(Oe&&!ve){var Zt=e.constructor,gr=t.constructor;Zt!=gr&&"constructor"in e&&"constructor"in t&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof gr=="function"&&gr instanceof gr)&&(Oe=!1)}return d.delete(e),d.delete(t),Oe}function Qr(e){return xo(Du(e,r,Hu),e+"")}function yo(e){return Wc(e,zt,wo)}function vo(e){return Wc(e,ar,Au)}var _o=As?function(e){return As.get(e)}:qo;function Hs(e){for(var t=e.name+"",n=Zi[t],o=ke.call(Zi,t)?n.length:0;o--;){var u=n[o],d=u.func;if(d==null||d==e)return u.name}return t}function nn(e){var t=ke.call(p,"placeholder")?p:e;return t.placeholder}function de(){var e=p.iteratee||jo;return e=e===jo?Yc:e,arguments.length?e(arguments[0],arguments[1]):e}function Vs(e,t){var n=e.__data__;return Ed(t)?n[typeof t=="string"?"string":"hash"]:n.map}function mo(e){for(var t=zt(e),n=t.length;n--;){var o=t[n],u=e[o];t[n]=[o,u,Nu(u)]}return t}function Ni(e,t){var n=Sf(e,t);return Qc(n)?n:r}function gd(e){var t=ke.call(e,Oi),n=e[Oi];try{e[Oi]=r;var o=!0}catch{}var u=bs.call(e);return o&&(t?e[Oi]=n:delete e[Oi]),u}var wo=Ba?function(e){return e==null?[]:(e=Je(e),ai(Ba(e),function(t){return jc.call(e,t)}))}:Lo,Au=Ba?function(e){for(var t=[];e;)oi(t,wo(e)),e=xs(e);return t}:Lo,Bt=Yt;(Ga&&Bt(new Ga(new ArrayBuffer(1)))!=Ke||wn&&Bt(new wn)!=Pe||Wa&&Bt(Wa.resolve())!=St||Xi&&Bt(new Xi)!=Me||bn&&Bt(new bn)!=He)&&(Bt=function(e){var t=Yt(e),n=t==Re?e.constructor:r,o=n?Fi(n):"";if(o)switch(o){case Yf:return Ke;case Xf:return Pe;case Zf:return St;case ep:return Me;case tp:return He}return t});function yd(e,t,n){for(var o=-1,u=n.length;++o<u;){var d=n[o],E=d.size;switch(d.type){case"drop":e+=E;break;case"dropRight":t-=E;break;case"take":t=Kt(t,e+E);break;case"takeRight":e=qt(e,t-E);break}}return{start:e,end:t}}function vd(e){var t=e.match(Qe);return t?t[1].split(Rt):[]}function Ru(e,t,n){t=fi(t,e);for(var o=-1,u=t.length,d=!1;++o<u;){var E=Mr(t[o]);if(!(d=e!=null&&n(e,E)))break;e=e[E]}return d||++o!=u?d:(u=e==null?0:e.length,!!u&&Ys(u)&&Yr(E,u)&&(xe(e)||Di(e)))}function _d(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ke.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Tu(e){return typeof e.constructor=="function"&&!Rn(e)?en(xs(e)):{}}function md(e,t,n){var o=e.constructor;switch(t){case $e:return fo(e);case L:case N:return new o(+e);case Ke:return rd(e,n);case ht:case Ue:case Pt:case jt:case Ut:case kt:case Lt:case Wt:case rr:return pu(e,n);case Pe:return new o;case je:case Ye:return new o(e);case st:return id(e);case Me:return new o;case Xe:return nd(e)}}function wd(e,t){var n=t.length;if(!n)return e;var o=n-1;return t[o]=(n>1?"& ":"")+t[o],t=t.join(n>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+t+`] */
`)}function bd(e){return xe(e)||Di(e)||!!($c&&e&&e[$c])}function Yr(e,t){var n=typeof e;return t=t??J,!!t&&(n=="number"||n!="symbol"&&Ea.test(e))&&e>-1&&e%1==0&&e<t}function Xt(e,t,n){if(!ct(n))return!1;var o=typeof t;return(o=="number"?sr(n)&&Yr(t,n.length):o=="string"&&t in n)?Tr(n[t],e):!1}function bo(e,t){if(xe(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||pr(e)?!0:Ot.test(e)||!it.test(e)||t!=null&&e in Je(t)}function Ed(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Eo(e){var t=Hs(e),n=p[t];if(typeof n!="function"||!(t in Te.prototype))return!1;if(e===n)return!0;var o=_o(n);return!!o&&e===o[0]}function Id(e){return!!Nc&&Nc in e}var xd=ms?Xr:Mo;function Rn(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Yi;return e===n}function Nu(e){return e===e&&!ct(e)}function Fu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in Je(n))}}function Sd(e){var t=Js(e,function(o){return n.size===T&&n.clear(),o}),n=t.cache;return t}function Pd(e,t){var n=e[1],o=t[1],u=n|o,d=u<(ce|me|V),E=o==V&&n==pe||o==V&&n==F&&e[7].length<=t[8]||o==(V|F)&&t[7].length<=t[8]&&n==pe;if(!(d||E))return e;o&ce&&(e[2]=t[2],u|=n&ce?0:ge);var x=t[3];if(x){var R=e[3];e[3]=R?gu(R,x,t[4]):x,e[4]=R?ci(e[3],M):t[4]}return x=t[5],x&&(R=e[5],e[5]=R?yu(R,x,t[6]):x,e[6]=R?ci(e[5],M):t[6]),x=t[7],x&&(e[7]=x),o&V&&(e[8]=e[8]==null?t[8]:Kt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function Od(e){var t=[];if(e!=null)for(var n in Je(e))t.push(n);return t}function Cd(e){return bs.call(e)}function Du(e,t,n){return t=qt(t===r?e.length-1:t,0),function(){for(var o=arguments,u=-1,d=qt(o.length-t,0),E=D(d);++u<d;)E[u]=o[t+u];u=-1;for(var x=D(t+1);++u<t;)x[u]=o[u];return x[t]=n(E),Mt(e,this,x)}}function ju(e,t){return t.length<2?e:Ti(e,Ir(t,0,-1))}function Ad(e,t){for(var n=e.length,o=Kt(t.length,n),u=nr(e);o--;){var d=t[o];e[o]=Yr(d,n)?u[d]:r}return e}function Io(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var $u=Lu(su),Tn=Vf||function(e,t){return Ne.setTimeout(e,t)},xo=Lu(Xp);function qu(e,t,n){var o=t+"";return xo(e,wd(o,Rd(vd(o),n)))}function Lu(e){var t=0,n=0;return function(){var o=Wf(),u=S-(o-n);if(n=o,u>0){if(++t>=_)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Ks(e,t){var n=-1,o=e.length,u=o-1;for(t=t===r?o:t;++n<t;){var d=so(n,u),E=e[d];e[d]=e[n],e[n]=E}return e.length=t,e}var Mu=Sd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ct,function(n,o,u,d){t.push(u?d.replace(ya,"$1"):o||n)}),t});function Mr(e){if(typeof e=="string"||pr(e))return e;var t=e+"";return t=="0"&&1/e==-W?"-0":t}function Fi(e){if(e!=null){try{return ws.call(e)}catch{}try{return e+""}catch{}}return""}function Rd(e,t){return mr(ut,function(n){var o="_."+n[0];t&n[1]&&!gs(e,o)&&e.push(o)}),e.sort()}function zu(e){if(e instanceof Te)return e.clone();var t=new br(e.__wrapped__,e.__chain__);return t.__actions__=nr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Td(e,t,n){(n?Xt(e,t,n):t===r)?t=1:t=qt(Se(t),0);var o=e==null?0:e.length;if(!o||t<1)return[];for(var u=0,d=0,E=D(Os(o/t));u<o;)E[d++]=Ir(e,u,u+=t);return E}function Nd(e){for(var t=-1,n=e==null?0:e.length,o=0,u=[];++t<n;){var d=e[t];d&&(u[o++]=d)}return u}function Fd(){var e=arguments.length;if(!e)return[];for(var t=D(e-1),n=arguments[0],o=e;o--;)t[o-1]=arguments[o];return oi(xe(n)?nr(n):[n],Ht(t,1))}var Dd=Ce(function(e,t){return bt(e)?Sn(e,Ht(t,1,bt,!0)):[]}),jd=Ce(function(e,t){var n=xr(t);return bt(n)&&(n=r),bt(e)?Sn(e,Ht(t,1,bt,!0),de(n,2)):[]}),$d=Ce(function(e,t){var n=xr(t);return bt(n)&&(n=r),bt(e)?Sn(e,Ht(t,1,bt,!0),r,n):[]});function qd(e,t,n){var o=e==null?0:e.length;return o?(t=n||t===r?1:Se(t),Ir(e,t<0?0:t,o)):[]}function Ld(e,t,n){var o=e==null?0:e.length;return o?(t=n||t===r?1:Se(t),t=o-t,Ir(e,0,t<0?0:t)):[]}function Md(e,t){return e&&e.length?qs(e,de(t,3),!0,!0):[]}function zd(e,t){return e&&e.length?qs(e,de(t,3),!0):[]}function Ud(e,t,n,o){var u=e==null?0:e.length;return u?(n&&typeof n!="number"&&Xt(e,t,n)&&(n=0,o=u),Fp(e,t,n,o)):[]}function Uu(e,t,n){var o=e==null?0:e.length;if(!o)return-1;var u=n==null?0:Se(n);return u<0&&(u=qt(o+u,0)),ys(e,de(t,3),u)}function ku(e,t,n){var o=e==null?0:e.length;if(!o)return-1;var u=o-1;return n!==r&&(u=Se(n),u=n<0?qt(o+u,0):Kt(u,o-1)),ys(e,de(t,3),u,!0)}function Hu(e){var t=e==null?0:e.length;return t?Ht(e,1):[]}function kd(e){var t=e==null?0:e.length;return t?Ht(e,W):[]}function Hd(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:Se(t),Ht(e,t)):[]}function Vd(e){for(var t=-1,n=e==null?0:e.length,o={};++t<n;){var u=e[t];o[u[0]]=u[1]}return o}function Vu(e){return e&&e.length?e[0]:r}function Kd(e,t,n){var o=e==null?0:e.length;if(!o)return-1;var u=n==null?0:Se(n);return u<0&&(u=qt(o+u,0)),Gi(e,t,u)}function Bd(e){var t=e==null?0:e.length;return t?Ir(e,0,-1):[]}var Gd=Ce(function(e){var t=nt(e,ho);return t.length&&t[0]===e[0]?eo(t):[]}),Wd=Ce(function(e){var t=xr(e),n=nt(e,ho);return t===xr(n)?t=r:n.pop(),n.length&&n[0]===e[0]?eo(n,de(t,2)):[]}),Jd=Ce(function(e){var t=xr(e),n=nt(e,ho);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?eo(n,r,t):[]});function Qd(e,t){return e==null?"":Bf.call(e,t)}function xr(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Yd(e,t,n){var o=e==null?0:e.length;if(!o)return-1;var u=o;return n!==r&&(u=Se(n),u=u<0?qt(o+u,0):Kt(u,o-1)),t===t?Rf(e,t,u):ys(e,xc,u,!0)}function Xd(e,t){return e&&e.length?tu(e,Se(t)):r}var Zd=Ce(Ku);function Ku(e,t){return e&&e.length&&t&&t.length?no(e,t):e}function eg(e,t,n){return e&&e.length&&t&&t.length?no(e,t,de(n,2)):e}function tg(e,t,n){return e&&e.length&&t&&t.length?no(e,t,r,n):e}var rg=Qr(function(e,t){var n=e==null?0:e.length,o=Qa(e,t);return nu(e,nt(t,function(u){return Yr(u,n)?+u:u}).sort(du)),o});function ig(e,t){var n=[];if(!(e&&e.length))return n;var o=-1,u=[],d=e.length;for(t=de(t,3);++o<d;){var E=e[o];t(E,o,e)&&(n.push(E),u.push(o))}return nu(e,u),n}function So(e){return e==null?e:Qf.call(e)}function ng(e,t,n){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&Xt(e,t,n)?(t=0,n=o):(t=t==null?0:Se(t),n=n===r?o:Se(n)),Ir(e,t,n)):[]}function sg(e,t){return $s(e,t)}function ag(e,t,n){return oo(e,t,de(n,2))}function og(e,t){var n=e==null?0:e.length;if(n){var o=$s(e,t);if(o<n&&Tr(e[o],t))return o}return-1}function cg(e,t){return $s(e,t,!0)}function ug(e,t,n){return oo(e,t,de(n,2),!0)}function hg(e,t){var n=e==null?0:e.length;if(n){var o=$s(e,t,!0)-1;if(Tr(e[o],t))return o}return-1}function lg(e){return e&&e.length?au(e):[]}function fg(e,t){return e&&e.length?au(e,de(t,2)):[]}function pg(e){var t=e==null?0:e.length;return t?Ir(e,1,t):[]}function dg(e,t,n){return e&&e.length?(t=n||t===r?1:Se(t),Ir(e,0,t<0?0:t)):[]}function gg(e,t,n){var o=e==null?0:e.length;return o?(t=n||t===r?1:Se(t),t=o-t,Ir(e,t<0?0:t,o)):[]}function yg(e,t){return e&&e.length?qs(e,de(t,3),!1,!0):[]}function vg(e,t){return e&&e.length?qs(e,de(t,3)):[]}var _g=Ce(function(e){return li(Ht(e,1,bt,!0))}),mg=Ce(function(e){var t=xr(e);return bt(t)&&(t=r),li(Ht(e,1,bt,!0),de(t,2))}),wg=Ce(function(e){var t=xr(e);return t=typeof t=="function"?t:r,li(Ht(e,1,bt,!0),r,t)});function bg(e){return e&&e.length?li(e):[]}function Eg(e,t){return e&&e.length?li(e,de(t,2)):[]}function Ig(e,t){return t=typeof t=="function"?t:r,e&&e.length?li(e,r,t):[]}function Po(e){if(!(e&&e.length))return[];var t=0;return e=ai(e,function(n){if(bt(n))return t=qt(n.length,t),!0}),ka(t,function(n){return nt(e,Ma(n))})}function Bu(e,t){if(!(e&&e.length))return[];var n=Po(e);return t==null?n:nt(n,function(o){return Mt(t,r,o)})}var xg=Ce(function(e,t){return bt(e)?Sn(e,t):[]}),Sg=Ce(function(e){return uo(ai(e,bt))}),Pg=Ce(function(e){var t=xr(e);return bt(t)&&(t=r),uo(ai(e,bt),de(t,2))}),Og=Ce(function(e){var t=xr(e);return t=typeof t=="function"?t:r,uo(ai(e,bt),r,t)}),Cg=Ce(Po);function Ag(e,t){return hu(e||[],t||[],xn)}function Rg(e,t){return hu(e||[],t||[],Cn)}var Tg=Ce(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Bu(e,n)});function Gu(e){var t=p(e);return t.__chain__=!0,t}function Ng(e,t){return t(e),e}function Bs(e,t){return t(e)}var Fg=Qr(function(e){var t=e.length,n=t?e[0]:0,o=this.__wrapped__,u=function(d){return Qa(d,e)};return t>1||this.__actions__.length||!(o instanceof Te)||!Yr(n)?this.thru(u):(o=o.slice(n,+n+(t?1:0)),o.__actions__.push({func:Bs,args:[u],thisArg:r}),new br(o,this.__chain__).thru(function(d){return t&&!d.length&&d.push(r),d}))});function Dg(){return Gu(this)}function jg(){return new br(this.value(),this.__chain__)}function $g(){this.__values__===r&&(this.__values__=oh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function qg(){return this}function Lg(e){for(var t,n=this;n instanceof Ts;){var o=zu(n);o.__index__=0,o.__values__=r,t?u.__wrapped__=o:t=o;var u=o;n=n.__wrapped__}return u.__wrapped__=e,t}function Mg(){var e=this.__wrapped__;if(e instanceof Te){var t=e;return this.__actions__.length&&(t=new Te(this)),t=t.reverse(),t.__actions__.push({func:Bs,args:[So],thisArg:r}),new br(t,this.__chain__)}return this.thru(So)}function zg(){return uu(this.__wrapped__,this.__actions__)}var Ug=Ls(function(e,t,n){ke.call(e,n)?++e[n]:Wr(e,n,1)});function kg(e,t,n){var o=xe(e)?Ec:Np;return n&&Xt(e,t,n)&&(t=r),o(e,de(t,3))}function Hg(e,t){var n=xe(e)?ai:Bc;return n(e,de(t,3))}var Vg=wu(Uu),Kg=wu(ku);function Bg(e,t){return Ht(Gs(e,t),1)}function Gg(e,t){return Ht(Gs(e,t),W)}function Wg(e,t,n){return n=n===r?1:Se(n),Ht(Gs(e,t),n)}function Wu(e,t){var n=xe(e)?mr:hi;return n(e,de(t,3))}function Ju(e,t){var n=xe(e)?pf:Kc;return n(e,de(t,3))}var Jg=Ls(function(e,t,n){ke.call(e,n)?e[n].push(t):Wr(e,n,[t])});function Qg(e,t,n,o){e=sr(e)?e:an(e),n=n&&!o?Se(n):0;var u=e.length;return n<0&&(n=qt(u+n,0)),Xs(e)?n<=u&&e.indexOf(t,n)>-1:!!u&&Gi(e,t,n)>-1}var Yg=Ce(function(e,t,n){var o=-1,u=typeof t=="function",d=sr(e)?D(e.length):[];return hi(e,function(E){d[++o]=u?Mt(t,E,n):Pn(E,t,n)}),d}),Xg=Ls(function(e,t,n){Wr(e,n,t)});function Gs(e,t){var n=xe(e)?nt:Xc;return n(e,de(t,3))}function Zg(e,t,n,o){return e==null?[]:(xe(t)||(t=t==null?[]:[t]),n=o?r:n,xe(n)||(n=n==null?[]:[n]),ru(e,t,n))}var ey=Ls(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function ty(e,t,n){var o=xe(e)?qa:Pc,u=arguments.length<3;return o(e,de(t,4),n,u,hi)}function ry(e,t,n){var o=xe(e)?df:Pc,u=arguments.length<3;return o(e,de(t,4),n,u,Kc)}function iy(e,t){var n=xe(e)?ai:Bc;return n(e,Qs(de(t,3)))}function ny(e){var t=xe(e)?Uc:Qp;return t(e)}function sy(e,t,n){(n?Xt(e,t,n):t===r)?t=1:t=Se(t);var o=xe(e)?Op:Yp;return o(e,t)}function ay(e){var t=xe(e)?Cp:Zp;return t(e)}function oy(e){if(e==null)return 0;if(sr(e))return Xs(e)?Ji(e):e.length;var t=Bt(e);return t==Pe||t==Me?e.size:ro(e).length}function cy(e,t,n){var o=xe(e)?La:ed;return n&&Xt(e,t,n)&&(t=r),o(e,de(t,3))}var uy=Ce(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Xt(e,t[0],t[1])?t=[]:n>2&&Xt(t[0],t[1],t[2])&&(t=[t[0]]),ru(e,Ht(t,1),[])}),Ws=Hf||function(){return Ne.Date.now()};function hy(e,t){if(typeof t!="function")throw new wr(m);return e=Se(e),function(){if(--e<1)return t.apply(this,arguments)}}function Qu(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Jr(e,V,r,r,r,r,t)}function Yu(e,t){var n;if(typeof t!="function")throw new wr(m);return e=Se(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Oo=Ce(function(e,t,n){var o=ce;if(n.length){var u=ci(n,nn(Oo));o|=le}return Jr(e,o,t,n,u)}),Xu=Ce(function(e,t,n){var o=ce|me;if(n.length){var u=ci(n,nn(Xu));o|=le}return Jr(t,o,e,n,u)});function Zu(e,t,n){t=n?r:t;var o=Jr(e,pe,r,r,r,r,r,t);return o.placeholder=Zu.placeholder,o}function eh(e,t,n){t=n?r:t;var o=Jr(e,he,r,r,r,r,r,t);return o.placeholder=eh.placeholder,o}function th(e,t,n){var o,u,d,E,x,R,k=0,H=!1,G=!1,te=!0;if(typeof e!="function")throw new wr(m);t=Sr(t)||0,ct(n)&&(H=!!n.leading,G="maxWait"in n,d=G?qt(Sr(n.maxWait)||0,t):d,te="trailing"in n?!!n.trailing:te);function oe(Et){var Nr=o,ei=u;return o=u=r,k=Et,E=e.apply(ei,Nr),E}function ye(Et){return k=Et,x=Tn(Ae,t),H?oe(Et):E}function Oe(Et){var Nr=Et-R,ei=Et-k,wh=t-Nr;return G?Kt(wh,d-ei):wh}function ve(Et){var Nr=Et-R,ei=Et-k;return R===r||Nr>=t||Nr<0||G&&ei>=d}function Ae(){var Et=Ws();if(ve(Et))return Fe(Et);x=Tn(Ae,Oe(Et))}function Fe(Et){return x=r,te&&o?oe(Et):(o=u=r,E)}function dr(){x!==r&&lu(x),k=0,o=R=u=x=r}function Zt(){return x===r?E:Fe(Ws())}function gr(){var Et=Ws(),Nr=ve(Et);if(o=arguments,u=this,R=Et,Nr){if(x===r)return ye(R);if(G)return lu(x),x=Tn(Ae,t),oe(R)}return x===r&&(x=Tn(Ae,t)),E}return gr.cancel=dr,gr.flush=Zt,gr}var ly=Ce(function(e,t){return Vc(e,1,t)}),fy=Ce(function(e,t,n){return Vc(e,Sr(t)||0,n)});function py(e){return Jr(e,ue)}function Js(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new wr(m);var n=function(){var o=arguments,u=t?t.apply(this,o):o[0],d=n.cache;if(d.has(u))return d.get(u);var E=e.apply(this,o);return n.cache=d.set(u,E)||d,E};return n.cache=new(Js.Cache||Gr),n}Js.Cache=Gr;function Qs(e){if(typeof e!="function")throw new wr(m);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function dy(e){return Yu(2,e)}var gy=td(function(e,t){t=t.length==1&&xe(t[0])?nt(t[0],lr(de())):nt(Ht(t,1),lr(de()));var n=t.length;return Ce(function(o){for(var u=-1,d=Kt(o.length,n);++u<d;)o[u]=t[u].call(this,o[u]);return Mt(e,this,o)})}),Co=Ce(function(e,t){var n=ci(t,nn(Co));return Jr(e,le,r,t,n)}),rh=Ce(function(e,t){var n=ci(t,nn(rh));return Jr(e,q,r,t,n)}),yy=Qr(function(e,t){return Jr(e,F,r,r,r,t)});function vy(e,t){if(typeof e!="function")throw new wr(m);return t=t===r?t:Se(t),Ce(e,t)}function _y(e,t){if(typeof e!="function")throw new wr(m);return t=t==null?0:qt(Se(t),0),Ce(function(n){var o=n[t],u=pi(n,0,t);return o&&oi(u,o),Mt(e,this,u)})}function my(e,t,n){var o=!0,u=!0;if(typeof e!="function")throw new wr(m);return ct(n)&&(o="leading"in n?!!n.leading:o,u="trailing"in n?!!n.trailing:u),th(e,t,{leading:o,maxWait:t,trailing:u})}function wy(e){return Qu(e,1)}function by(e,t){return Co(lo(t),e)}function Ey(){if(!arguments.length)return[];var e=arguments[0];return xe(e)?e:[e]}function Iy(e){return Er(e,Z)}function xy(e,t){return t=typeof t=="function"?t:r,Er(e,Z,t)}function Sy(e){return Er(e,Y|Z)}function Py(e,t){return t=typeof t=="function"?t:r,Er(e,Y|Z,t)}function Oy(e,t){return t==null||Hc(e,t,zt(t))}function Tr(e,t){return e===t||e!==e&&t!==t}var Cy=ks(Za),Ay=ks(function(e,t){return e>=t}),Di=Jc(function(){return arguments}())?Jc:function(e){return vt(e)&&ke.call(e,"callee")&&!jc.call(e,"callee")},xe=D.isArray,Ry=Qt?lr(Qt):Lp;function sr(e){return e!=null&&Ys(e.length)&&!Xr(e)}function bt(e){return vt(e)&&sr(e)}function Ty(e){return e===!0||e===!1||vt(e)&&Yt(e)==L}var di=Kf||Mo,Ny=Cr?lr(Cr):Mp;function Fy(e){return vt(e)&&e.nodeType===1&&!Nn(e)}function Dy(e){if(e==null)return!0;if(sr(e)&&(xe(e)||typeof e=="string"||typeof e.splice=="function"||di(e)||sn(e)||Di(e)))return!e.length;var t=Bt(e);if(t==Pe||t==Me)return!e.size;if(Rn(e))return!ro(e).length;for(var n in e)if(ke.call(e,n))return!1;return!0}function jy(e,t){return On(e,t)}function $y(e,t,n){n=typeof n=="function"?n:r;var o=n?n(e,t):r;return o===r?On(e,t,r,n):!!o}function Ao(e){if(!vt(e))return!1;var t=Yt(e);return t==P||t==c||typeof e.message=="string"&&typeof e.name=="string"&&!Nn(e)}function qy(e){return typeof e=="number"&&qc(e)}function Xr(e){if(!ct(e))return!1;var t=Yt(e);return t==ae||t==we||t==z||t==_t}function ih(e){return typeof e=="number"&&e==Se(e)}function Ys(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ct(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function vt(e){return e!=null&&typeof e=="object"}var nh=_r?lr(_r):Up;function Ly(e,t){return e===t||to(e,t,mo(t))}function My(e,t,n){return n=typeof n=="function"?n:r,to(e,t,mo(t),n)}function zy(e){return sh(e)&&e!=+e}function Uy(e){if(xd(e))throw new Ee(l);return Qc(e)}function ky(e){return e===null}function Hy(e){return e==null}function sh(e){return typeof e=="number"||vt(e)&&Yt(e)==je}function Nn(e){if(!vt(e)||Yt(e)!=Re)return!1;var t=xs(e);if(t===null)return!0;var n=ke.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&ws.call(n)==Mf}var Ro=$r?lr($r):kp;function Vy(e){return ih(e)&&e>=-J&&e<=J}var ah=vn?lr(vn):Hp;function Xs(e){return typeof e=="string"||!xe(e)&&vt(e)&&Yt(e)==Ye}function pr(e){return typeof e=="symbol"||vt(e)&&Yt(e)==Xe}var sn=Pi?lr(Pi):Vp;function Ky(e){return e===r}function By(e){return vt(e)&&Bt(e)==He}function Gy(e){return vt(e)&&Yt(e)==Ze}var Wy=ks(io),Jy=ks(function(e,t){return e<=t});function oh(e){if(!e)return[];if(sr(e))return Xs(e)?Ar(e):nr(e);if(mn&&e[mn])return Of(e[mn]());var t=Bt(e),n=t==Pe?Va:t==Me?vs:an;return n(e)}function Zr(e){if(!e)return e===0?e:0;if(e=Sr(e),e===W||e===-W){var t=e<0?-1:1;return t*O}return e===e?e:0}function Se(e){var t=Zr(e),n=t%1;return t===t?n?t-n:t:0}function ch(e){return e?Ri(Se(e),0,Q):0}function Sr(e){if(typeof e=="number")return e;if(pr(e))return $;if(ct(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ct(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Oc(e);var n=ma.test(e);return n||ba.test(e)?Ie(e.slice(2),n?2:8):_a.test(e)?$:+e}function uh(e){return Lr(e,ar(e))}function Qy(e){return e?Ri(Se(e),-J,J):e===0?e:0}function ze(e){return e==null?"":fr(e)}var Yy=tn(function(e,t){if(Rn(t)||sr(t)){Lr(t,zt(t),e);return}for(var n in t)ke.call(t,n)&&xn(e,n,t[n])}),hh=tn(function(e,t){Lr(t,ar(t),e)}),Zs=tn(function(e,t,n,o){Lr(t,ar(t),e,o)}),Xy=tn(function(e,t,n,o){Lr(t,zt(t),e,o)}),Zy=Qr(Qa);function ev(e,t){var n=en(e);return t==null?n:kc(n,t)}var tv=Ce(function(e,t){e=Je(e);var n=-1,o=t.length,u=o>2?t[2]:r;for(u&&Xt(t[0],t[1],u)&&(o=1);++n<o;)for(var d=t[n],E=ar(d),x=-1,R=E.length;++x<R;){var k=E[x],H=e[k];(H===r||Tr(H,Yi[k])&&!ke.call(e,k))&&(e[k]=d[k])}return e}),rv=Ce(function(e){return e.push(r,Ou),Mt(lh,r,e)});function iv(e,t){return Ic(e,de(t,3),qr)}function nv(e,t){return Ic(e,de(t,3),Xa)}function sv(e,t){return e==null?e:Ya(e,de(t,3),ar)}function av(e,t){return e==null?e:Gc(e,de(t,3),ar)}function ov(e,t){return e&&qr(e,de(t,3))}function cv(e,t){return e&&Xa(e,de(t,3))}function uv(e){return e==null?[]:Ds(e,zt(e))}function hv(e){return e==null?[]:Ds(e,ar(e))}function To(e,t,n){var o=e==null?r:Ti(e,t);return o===r?n:o}function lv(e,t){return e!=null&&Ru(e,t,Dp)}function No(e,t){return e!=null&&Ru(e,t,jp)}var fv=Eu(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=bs.call(t)),e[t]=n},Do(or)),pv=Eu(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=bs.call(t)),ke.call(e,t)?e[t].push(n):e[t]=[n]},de),dv=Ce(Pn);function zt(e){return sr(e)?zc(e):ro(e)}function ar(e){return sr(e)?zc(e,!0):Kp(e)}function gv(e,t){var n={};return t=de(t,3),qr(e,function(o,u,d){Wr(n,t(o,u,d),o)}),n}function yv(e,t){var n={};return t=de(t,3),qr(e,function(o,u,d){Wr(n,u,t(o,u,d))}),n}var vv=tn(function(e,t,n){js(e,t,n)}),lh=tn(function(e,t,n,o){js(e,t,n,o)}),_v=Qr(function(e,t){var n={};if(e==null)return n;var o=!1;t=nt(t,function(d){return d=fi(d,e),o||(o=d.length>1),d}),Lr(e,vo(e),n),o&&(n=Er(n,Y|X|Z,fd));for(var u=t.length;u--;)co(n,t[u]);return n});function mv(e,t){return fh(e,Qs(de(t)))}var wv=Qr(function(e,t){return e==null?{}:Gp(e,t)});function fh(e,t){if(e==null)return{};var n=nt(vo(e),function(o){return[o]});return t=de(t),iu(e,n,function(o,u){return t(o,u[0])})}function bv(e,t,n){t=fi(t,e);var o=-1,u=t.length;for(u||(u=1,e=r);++o<u;){var d=e==null?r:e[Mr(t[o])];d===r&&(o=u,d=n),e=Xr(d)?d.call(e):d}return e}function Ev(e,t,n){return e==null?e:Cn(e,t,n)}function Iv(e,t,n,o){return o=typeof o=="function"?o:r,e==null?e:Cn(e,t,n,o)}var ph=Su(zt),dh=Su(ar);function xv(e,t,n){var o=xe(e),u=o||di(e)||sn(e);if(t=de(t,4),n==null){var d=e&&e.constructor;u?n=o?new d:[]:ct(e)?n=Xr(d)?en(xs(e)):{}:n={}}return(u?mr:qr)(e,function(E,x,R){return t(n,E,x,R)}),n}function Sv(e,t){return e==null?!0:co(e,t)}function Pv(e,t,n){return e==null?e:cu(e,t,lo(n))}function Ov(e,t,n,o){return o=typeof o=="function"?o:r,e==null?e:cu(e,t,lo(n),o)}function an(e){return e==null?[]:Ha(e,zt(e))}function Cv(e){return e==null?[]:Ha(e,ar(e))}function Av(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Sr(n),n=n===n?n:0),t!==r&&(t=Sr(t),t=t===t?t:0),Ri(Sr(e),t,n)}function Rv(e,t,n){return t=Zr(t),n===r?(n=t,t=0):n=Zr(n),e=Sr(e),$p(e,t,n)}function Tv(e,t,n){if(n&&typeof n!="boolean"&&Xt(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Zr(e),t===r?(t=e,e=0):t=Zr(t)),e>t){var o=e;e=t,t=o}if(n||e%1||t%1){var u=Lc();return Kt(e+u*(t-e+Ge("1e-"+((u+"").length-1))),t)}return so(e,t)}var Nv=rn(function(e,t,n){return t=t.toLowerCase(),e+(n?gh(t):t)});function gh(e){return Fo(ze(e).toLowerCase())}function yh(e){return e=ze(e),e&&e.replace(Vr,Ef).replace(Da,"")}function Fv(e,t,n){e=ze(e),t=fr(t);var o=e.length;n=n===r?o:Ri(Se(n),0,o);var u=n;return n-=t.length,n>=0&&e.slice(n,u)==t}function Dv(e){return e=ze(e),e&&rt.test(e)?e.replace(bi,If):e}function jv(e){return e=ze(e),e&&At.test(e)?e.replace(dt,"\\$&"):e}var $v=rn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),qv=rn(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Lv=mu("toLowerCase");function Mv(e,t,n){e=ze(e),t=Se(t);var o=t?Ji(e):0;if(!t||o>=t)return e;var u=(t-o)/2;return Us(Cs(u),n)+e+Us(Os(u),n)}function zv(e,t,n){e=ze(e),t=Se(t);var o=t?Ji(e):0;return t&&o<t?e+Us(t-o,n):e}function Uv(e,t,n){e=ze(e),t=Se(t);var o=t?Ji(e):0;return t&&o<t?Us(t-o,n)+e:e}function kv(e,t,n){return n||t==null?t=0:t&&(t=+t),Jf(ze(e).replace(gt,""),t||0)}function Hv(e,t,n){return(n?Xt(e,t,n):t===r)?t=1:t=Se(t),ao(ze(e),t)}function Vv(){var e=arguments,t=ze(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Kv=rn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Bv(e,t,n){return n&&typeof n!="number"&&Xt(e,t,n)&&(t=n=r),n=n===r?Q:n>>>0,n?(e=ze(e),e&&(typeof t=="string"||t!=null&&!Ro(t))&&(t=fr(t),!t&&Wi(e))?pi(Ar(e),0,n):e.split(t,n)):[]}var Gv=rn(function(e,t,n){return e+(n?" ":"")+Fo(t)});function Wv(e,t,n){return e=ze(e),n=n==null?0:Ri(Se(n),0,e.length),t=fr(t),e.slice(n,n+t.length)==t}function Jv(e,t,n){var o=p.templateSettings;n&&Xt(e,t,n)&&(t=r),e=ze(e),t=Zs({},t,o,Pu);var u=Zs({},t.imports,o.imports,Pu),d=zt(u),E=Ha(u,d),x,R,k=0,H=t.interpolate||zi,G="__p += '",te=Ka((t.escape||zi).source+"|"+H.source+"|"+(H===ot?va:zi).source+"|"+(t.evaluate||zi).source+"|$","g"),oe="//# sourceURL="+(ke.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ja+"]")+`
`;e.replace(te,function(ve,Ae,Fe,dr,Zt,gr){return Fe||(Fe=dr),G+=e.slice(k,gr).replace(Ia,xf),Ae&&(x=!0,G+=`' +
__e(`+Ae+`) +
'`),Zt&&(R=!0,G+=`';
`+Zt+`;
__p += '`),Fe&&(G+=`' +
((__t = (`+Fe+`)) == null ? '' : __t) +
'`),k=gr+ve.length,ve}),G+=`';
`;var ye=ke.call(t,"variable")&&t.variable;if(!ye)G=`with (obj) {
`+G+`
}
`;else if(ga.test(ye))throw new Ee(b);G=(R?G.replace(Dr,""):G).replace(Jt,"$1").replace(Hr,"$1;"),G="function("+(ye||"obj")+`) {
`+(ye?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(x?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var Oe=_h(function(){return Le(d,oe+"return "+G).apply(r,E)});if(Oe.source=G,Ao(Oe))throw Oe;return Oe}function Qv(e){return ze(e).toLowerCase()}function Yv(e){return ze(e).toUpperCase()}function Xv(e,t,n){if(e=ze(e),e&&(n||t===r))return Oc(e);if(!e||!(t=fr(t)))return e;var o=Ar(e),u=Ar(t),d=Cc(o,u),E=Ac(o,u)+1;return pi(o,d,E).join("")}function Zv(e,t,n){if(e=ze(e),e&&(n||t===r))return e.slice(0,Tc(e)+1);if(!e||!(t=fr(t)))return e;var o=Ar(e),u=Ac(o,Ar(t))+1;return pi(o,0,u).join("")}function e0(e,t,n){if(e=ze(e),e&&(n||t===r))return e.replace(gt,"");if(!e||!(t=fr(t)))return e;var o=Ar(e),u=Cc(o,Ar(t));return pi(o,u).join("")}function t0(e,t){var n=f,o=v;if(ct(t)){var u="separator"in t?t.separator:u;n="length"in t?Se(t.length):n,o="omission"in t?fr(t.omission):o}e=ze(e);var d=e.length;if(Wi(e)){var E=Ar(e);d=E.length}if(n>=d)return e;var x=n-Ji(o);if(x<1)return o;var R=E?pi(E,0,x).join(""):e.slice(0,x);if(u===r)return R+o;if(E&&(x+=R.length-x),Ro(u)){if(e.slice(x).search(u)){var k,H=R;for(u.global||(u=Ka(u.source,ze(vr.exec(u))+"g")),u.lastIndex=0;k=u.exec(H);)var G=k.index;R=R.slice(0,G===r?x:G)}}else if(e.indexOf(fr(u),x)!=x){var te=R.lastIndexOf(u);te>-1&&(R=R.slice(0,te))}return R+o}function r0(e){return e=ze(e),e&&lt.test(e)?e.replace(ni,Tf):e}var i0=rn(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Fo=mu("toUpperCase");function vh(e,t,n){return e=ze(e),t=n?r:t,t===r?Pf(e)?Df(e):vf(e):e.match(t)||[]}var _h=Ce(function(e,t){try{return Mt(e,r,t)}catch(n){return Ao(n)?n:new Ee(n)}}),n0=Qr(function(e,t){return mr(t,function(n){n=Mr(n),Wr(e,n,Oo(e[n],e))}),e});function s0(e){var t=e==null?0:e.length,n=de();return e=t?nt(e,function(o){if(typeof o[1]!="function")throw new wr(m);return[n(o[0]),o[1]]}):[],Ce(function(o){for(var u=-1;++u<t;){var d=e[u];if(Mt(d[0],this,o))return Mt(d[1],this,o)}})}function a0(e){return Tp(Er(e,Y))}function Do(e){return function(){return e}}function o0(e,t){return e==null||e!==e?t:e}var c0=bu(),u0=bu(!0);function or(e){return e}function jo(e){return Yc(typeof e=="function"?e:Er(e,Y))}function h0(e){return Zc(Er(e,Y))}function l0(e,t){return eu(e,Er(t,Y))}var f0=Ce(function(e,t){return function(n){return Pn(n,e,t)}}),p0=Ce(function(e,t){return function(n){return Pn(e,n,t)}});function $o(e,t,n){var o=zt(t),u=Ds(t,o);n==null&&!(ct(t)&&(u.length||!o.length))&&(n=t,t=e,e=this,u=Ds(t,zt(t)));var d=!(ct(n)&&"chain"in n)||!!n.chain,E=Xr(e);return mr(u,function(x){var R=t[x];e[x]=R,E&&(e.prototype[x]=function(){var k=this.__chain__;if(d||k){var H=e(this.__wrapped__),G=H.__actions__=nr(this.__actions__);return G.push({func:R,args:arguments,thisArg:e}),H.__chain__=k,H}return R.apply(e,oi([this.value()],arguments))})}),e}function d0(){return Ne._===this&&(Ne._=zf),this}function qo(){}function g0(e){return e=Se(e),Ce(function(t){return tu(t,e)})}var y0=po(nt),v0=po(Ec),_0=po(La);function mh(e){return bo(e)?Ma(Mr(e)):Wp(e)}function m0(e){return function(t){return e==null?r:Ti(e,t)}}var w0=Iu(),b0=Iu(!0);function Lo(){return[]}function Mo(){return!1}function E0(){return{}}function I0(){return""}function x0(){return!0}function S0(e,t){if(e=Se(e),e<1||e>J)return[];var n=Q,o=Kt(e,Q);t=de(t),e-=Q;for(var u=ka(o,t);++n<e;)t(n);return u}function P0(e){return xe(e)?nt(e,Mr):pr(e)?[e]:nr(Mu(ze(e)))}function O0(e){var t=++Lf;return ze(e)+t}var C0=zs(function(e,t){return e+t},0),A0=go("ceil"),R0=zs(function(e,t){return e/t},1),T0=go("floor");function N0(e){return e&&e.length?Fs(e,or,Za):r}function F0(e,t){return e&&e.length?Fs(e,de(t,2),Za):r}function D0(e){return Sc(e,or)}function j0(e,t){return Sc(e,de(t,2))}function $0(e){return e&&e.length?Fs(e,or,io):r}function q0(e,t){return e&&e.length?Fs(e,de(t,2),io):r}var L0=zs(function(e,t){return e*t},1),M0=go("round"),z0=zs(function(e,t){return e-t},0);function U0(e){return e&&e.length?Ua(e,or):0}function k0(e,t){return e&&e.length?Ua(e,de(t,2)):0}return p.after=hy,p.ary=Qu,p.assign=Yy,p.assignIn=hh,p.assignInWith=Zs,p.assignWith=Xy,p.at=Zy,p.before=Yu,p.bind=Oo,p.bindAll=n0,p.bindKey=Xu,p.castArray=Ey,p.chain=Gu,p.chunk=Td,p.compact=Nd,p.concat=Fd,p.cond=s0,p.conforms=a0,p.constant=Do,p.countBy=Ug,p.create=ev,p.curry=Zu,p.curryRight=eh,p.debounce=th,p.defaults=tv,p.defaultsDeep=rv,p.defer=ly,p.delay=fy,p.difference=Dd,p.differenceBy=jd,p.differenceWith=$d,p.drop=qd,p.dropRight=Ld,p.dropRightWhile=Md,p.dropWhile=zd,p.fill=Ud,p.filter=Hg,p.flatMap=Bg,p.flatMapDeep=Gg,p.flatMapDepth=Wg,p.flatten=Hu,p.flattenDeep=kd,p.flattenDepth=Hd,p.flip=py,p.flow=c0,p.flowRight=u0,p.fromPairs=Vd,p.functions=uv,p.functionsIn=hv,p.groupBy=Jg,p.initial=Bd,p.intersection=Gd,p.intersectionBy=Wd,p.intersectionWith=Jd,p.invert=fv,p.invertBy=pv,p.invokeMap=Yg,p.iteratee=jo,p.keyBy=Xg,p.keys=zt,p.keysIn=ar,p.map=Gs,p.mapKeys=gv,p.mapValues=yv,p.matches=h0,p.matchesProperty=l0,p.memoize=Js,p.merge=vv,p.mergeWith=lh,p.method=f0,p.methodOf=p0,p.mixin=$o,p.negate=Qs,p.nthArg=g0,p.omit=_v,p.omitBy=mv,p.once=dy,p.orderBy=Zg,p.over=y0,p.overArgs=gy,p.overEvery=v0,p.overSome=_0,p.partial=Co,p.partialRight=rh,p.partition=ey,p.pick=wv,p.pickBy=fh,p.property=mh,p.propertyOf=m0,p.pull=Zd,p.pullAll=Ku,p.pullAllBy=eg,p.pullAllWith=tg,p.pullAt=rg,p.range=w0,p.rangeRight=b0,p.rearg=yy,p.reject=iy,p.remove=ig,p.rest=vy,p.reverse=So,p.sampleSize=sy,p.set=Ev,p.setWith=Iv,p.shuffle=ay,p.slice=ng,p.sortBy=uy,p.sortedUniq=lg,p.sortedUniqBy=fg,p.split=Bv,p.spread=_y,p.tail=pg,p.take=dg,p.takeRight=gg,p.takeRightWhile=yg,p.takeWhile=vg,p.tap=Ng,p.throttle=my,p.thru=Bs,p.toArray=oh,p.toPairs=ph,p.toPairsIn=dh,p.toPath=P0,p.toPlainObject=uh,p.transform=xv,p.unary=wy,p.union=_g,p.unionBy=mg,p.unionWith=wg,p.uniq=bg,p.uniqBy=Eg,p.uniqWith=Ig,p.unset=Sv,p.unzip=Po,p.unzipWith=Bu,p.update=Pv,p.updateWith=Ov,p.values=an,p.valuesIn=Cv,p.without=xg,p.words=vh,p.wrap=by,p.xor=Sg,p.xorBy=Pg,p.xorWith=Og,p.zip=Cg,p.zipObject=Ag,p.zipObjectDeep=Rg,p.zipWith=Tg,p.entries=ph,p.entriesIn=dh,p.extend=hh,p.extendWith=Zs,$o(p,p),p.add=C0,p.attempt=_h,p.camelCase=Nv,p.capitalize=gh,p.ceil=A0,p.clamp=Av,p.clone=Iy,p.cloneDeep=Sy,p.cloneDeepWith=Py,p.cloneWith=xy,p.conformsTo=Oy,p.deburr=yh,p.defaultTo=o0,p.divide=R0,p.endsWith=Fv,p.eq=Tr,p.escape=Dv,p.escapeRegExp=jv,p.every=kg,p.find=Vg,p.findIndex=Uu,p.findKey=iv,p.findLast=Kg,p.findLastIndex=ku,p.findLastKey=nv,p.floor=T0,p.forEach=Wu,p.forEachRight=Ju,p.forIn=sv,p.forInRight=av,p.forOwn=ov,p.forOwnRight=cv,p.get=To,p.gt=Cy,p.gte=Ay,p.has=lv,p.hasIn=No,p.head=Vu,p.identity=or,p.includes=Qg,p.indexOf=Kd,p.inRange=Rv,p.invoke=dv,p.isArguments=Di,p.isArray=xe,p.isArrayBuffer=Ry,p.isArrayLike=sr,p.isArrayLikeObject=bt,p.isBoolean=Ty,p.isBuffer=di,p.isDate=Ny,p.isElement=Fy,p.isEmpty=Dy,p.isEqual=jy,p.isEqualWith=$y,p.isError=Ao,p.isFinite=qy,p.isFunction=Xr,p.isInteger=ih,p.isLength=Ys,p.isMap=nh,p.isMatch=Ly,p.isMatchWith=My,p.isNaN=zy,p.isNative=Uy,p.isNil=Hy,p.isNull=ky,p.isNumber=sh,p.isObject=ct,p.isObjectLike=vt,p.isPlainObject=Nn,p.isRegExp=Ro,p.isSafeInteger=Vy,p.isSet=ah,p.isString=Xs,p.isSymbol=pr,p.isTypedArray=sn,p.isUndefined=Ky,p.isWeakMap=By,p.isWeakSet=Gy,p.join=Qd,p.kebabCase=$v,p.last=xr,p.lastIndexOf=Yd,p.lowerCase=qv,p.lowerFirst=Lv,p.lt=Wy,p.lte=Jy,p.max=N0,p.maxBy=F0,p.mean=D0,p.meanBy=j0,p.min=$0,p.minBy=q0,p.stubArray=Lo,p.stubFalse=Mo,p.stubObject=E0,p.stubString=I0,p.stubTrue=x0,p.multiply=L0,p.nth=Xd,p.noConflict=d0,p.noop=qo,p.now=Ws,p.pad=Mv,p.padEnd=zv,p.padStart=Uv,p.parseInt=kv,p.random=Tv,p.reduce=ty,p.reduceRight=ry,p.repeat=Hv,p.replace=Vv,p.result=bv,p.round=M0,p.runInContext=A,p.sample=ny,p.size=oy,p.snakeCase=Kv,p.some=cy,p.sortedIndex=sg,p.sortedIndexBy=ag,p.sortedIndexOf=og,p.sortedLastIndex=cg,p.sortedLastIndexBy=ug,p.sortedLastIndexOf=hg,p.startCase=Gv,p.startsWith=Wv,p.subtract=z0,p.sum=U0,p.sumBy=k0,p.template=Jv,p.times=S0,p.toFinite=Zr,p.toInteger=Se,p.toLength=ch,p.toLower=Qv,p.toNumber=Sr,p.toSafeInteger=Qy,p.toString=ze,p.toUpper=Yv,p.trim=Xv,p.trimEnd=Zv,p.trimStart=e0,p.truncate=t0,p.unescape=r0,p.uniqueId=O0,p.upperCase=i0,p.upperFirst=Fo,p.each=Wu,p.eachRight=Ju,p.first=Vu,$o(p,function(){var e={};return qr(p,function(t,n){ke.call(p.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),p.VERSION=s,mr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),mr(["drop","take"],function(e,t){Te.prototype[e]=function(n){n=n===r?1:qt(Se(n),0);var o=this.__filtered__&&!t?new Te(this):this.clone();return o.__filtered__?o.__takeCount__=Kt(n,o.__takeCount__):o.__views__.push({size:Kt(n,Q),type:e+(o.__dir__<0?"Right":"")}),o},Te.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),mr(["filter","map","takeWhile"],function(e,t){var n=t+1,o=n==y||n==j;Te.prototype[e]=function(u){var d=this.clone();return d.__iteratees__.push({iteratee:de(u,3),type:n}),d.__filtered__=d.__filtered__||o,d}}),mr(["head","last"],function(e,t){var n="take"+(t?"Right":"");Te.prototype[e]=function(){return this[n](1).value()[0]}}),mr(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");Te.prototype[e]=function(){return this.__filtered__?new Te(this):this[n](1)}}),Te.prototype.compact=function(){return this.filter(or)},Te.prototype.find=function(e){return this.filter(e).head()},Te.prototype.findLast=function(e){return this.reverse().find(e)},Te.prototype.invokeMap=Ce(function(e,t){return typeof e=="function"?new Te(this):this.map(function(n){return Pn(n,e,t)})}),Te.prototype.reject=function(e){return this.filter(Qs(de(e)))},Te.prototype.slice=function(e,t){e=Se(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Te(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=Se(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},Te.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Te.prototype.toArray=function(){return this.take(Q)},qr(Te.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),u=p[o?"take"+(t=="last"?"Right":""):t],d=o||/^find/.test(t);u&&(p.prototype[t]=function(){var E=this.__wrapped__,x=o?[1]:arguments,R=E instanceof Te,k=x[0],H=R||xe(E),G=function(Ae){var Fe=u.apply(p,oi([Ae],x));return o&&te?Fe[0]:Fe};H&&n&&typeof k=="function"&&k.length!=1&&(R=H=!1);var te=this.__chain__,oe=!!this.__actions__.length,ye=d&&!te,Oe=R&&!oe;if(!d&&H){E=Oe?E:new Te(this);var ve=e.apply(E,x);return ve.__actions__.push({func:Bs,args:[G],thisArg:r}),new br(ve,te)}return ye&&Oe?e.apply(this,x):(ve=this.thru(G),ye?o?ve.value()[0]:ve.value():ve)})}),mr(["pop","push","shift","sort","splice","unshift"],function(e){var t=_s[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var u=arguments;if(o&&!this.__chain__){var d=this.value();return t.apply(xe(d)?d:[],u)}return this[n](function(E){return t.apply(xe(E)?E:[],u)})}}),qr(Te.prototype,function(e,t){var n=p[t];if(n){var o=n.name+"";ke.call(Zi,o)||(Zi[o]=[]),Zi[o].push({name:t,func:n})}}),Zi[Ms(r,me).name]=[{name:"wrapper",func:r}],Te.prototype.clone=rp,Te.prototype.reverse=ip,Te.prototype.value=np,p.prototype.at=Fg,p.prototype.chain=Dg,p.prototype.commit=jg,p.prototype.next=$g,p.prototype.plant=Lg,p.prototype.reverse=Mg,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=zg,p.prototype.first=p.prototype.head,mn&&(p.prototype[mn]=qg),p},Qi=jf();wt?((wt.exports=Qi)._=Qi,We._=Qi):Ne._=Qi}).call(kn)})(ac,ac.exports);var Eb=Object.defineProperty,Ib=Object.defineProperties,xb=Object.getOwnPropertyDescriptors,gl=Object.getOwnPropertySymbols,Sb=Object.prototype.hasOwnProperty,Pb=Object.prototype.propertyIsEnumerable,yl=(h,i,r)=>i in h?Eb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,ra=(h,i)=>{for(var r in i||(i={}))Sb.call(i,r)&&yl(h,r,i[r]);if(gl)for(var r of gl(i))Pb.call(i,r)&&yl(h,r,i[r]);return h},Ob=(h,i)=>Ib(h,xb(i));function pn(h,i,r){var s;const a=A1(h);return((s=i.rpcMap)==null?void 0:s[a.reference])||`${bb}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Mi(h){return h.includes(":")?h.split(":")[1]:h}function hf(h){return h.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function Cb(h,i){const r=Object.keys(i.namespaces).filter(a=>a.includes(h));if(!r.length)return[];const s=[];return r.forEach(a=>{const l=i.namespaces[a].accounts;s.push(...l)}),s}function Ab(h={},i={}){const r=vl(h),s=vl(i);return ac.exports.merge(r,s)}function vl(h){var i,r,s,a;const l={};if(!sa(h))return l;for(const[m,b]of Object.entries(h)){const I=Rl(m)?[m]:b.chains,T=b.methods||[],M=b.events||[],Y=b.rpcMap||{},X=Hn(m);l[X]=Ob(ra(ra({},l[X]),b),{chains:Uo(I,(i=l[X])==null?void 0:i.chains),methods:Uo(T,(r=l[X])==null?void 0:r.methods),events:Uo(M,(s=l[X])==null?void 0:s.events),rpcMap:ra(ra({},Y),(a=l[X])==null?void 0:a.rpcMap)})}return l}function Rb(h){return h.includes(":")?h.split(":")[2]:h}function Tb(h){const i={};for(const[r,s]of Object.entries(h)){const a=s.methods||[],l=s.events||[],m=s.accounts||[],b=Rl(r)?[r]:s.chains?s.chains:hf(s.accounts);i[r]={chains:b,methods:a,events:l,accounts:m}}return i}function Xo(h){return typeof h=="number"?h:h.includes("0x")?parseInt(h,16):h.includes(":")?Number(h.split(":")[1]):Number(h)}const lf={},It=h=>lf[h],Zo=(h,i)=>{lf[h]=i};class Nb{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const a=Mi(r);i[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||pn(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}}class Fb{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(parseInt(i),r),this.chainId=parseInt(i),this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const s=r||pn(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Mi(r));i[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}async handleSwitchChain(i){var r,s;let a=i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const l=parseInt(a,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class Db{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const a=Mi(r);i[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||pn(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}}class jb{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const a=Mi(r);i[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||pn(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}}class $b{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Mi(r);i[a]=this.createHttpProvider(a,s)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||this.getCardanoRPCUrl(i);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}}class qb{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const a=Mi(r);i[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||pn(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}}class Lb{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(wi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const a=Mi(r);i[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||pn(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new mi(new qi(s,It("disableProviderPing")))}}var Mb=Object.defineProperty,zb=Object.defineProperties,Ub=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,Hb=Object.prototype.propertyIsEnumerable,ml=(h,i,r)=>i in h?Mb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,ia=(h,i)=>{for(var r in i||(i={}))kb.call(i,r)&&ml(h,r,i[r]);if(_l)for(var r of _l(i))Hb.call(i,r)&&ml(h,r,i[r]);return h},ec=(h,i)=>zb(h,Ub(i));class wc{constructor(i){this.events=new hc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:De.pino(De.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||pl})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const r=new wc(i);return await r.initialize(),r}async request(i,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ia({},i),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(i,r,s){this.request(i,s).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:tr("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(l=>{this.session=l,this.namespaces||(this.namespaces=Tb(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==cf)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{if(!this.session)return;const[s,a]=this.validateChain(i);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ln(r)){for(const s of r)i.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await vb.init({logger:this.providerOpts.logger||pl,relayUrl:this.providerOpts.relayUrl||_b,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>Hn(r)))];Zo("client",this.client),Zo("events",this.events),Zo("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const s=Cb(r,this.session),a=hf(s),l=Ab(this.namespaces,this.optionalNamespaces),m=ec(ia({},l[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new Fb({namespace:m});break;case"solana":this.rpcProviders[r]=new Db({namespace:m});break;case"cosmos":this.rpcProviders[r]=new jb({namespace:m});break;case"polkadot":this.rpcProviders[r]=new Nb({namespace:m});break;case"cip34":this.rpcProviders[r]=new $b({namespace:m});break;case"elrond":this.rpcProviders[r]=new qb({namespace:m});break;case"multiversx":this.rpcProviders[r]=new Lb({namespace:m});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&ln(a)&&this.events.emit("accountsChanged",a.map(Rb))}else if(s.name==="chainChanged"){const a=r.chainId,l=r.event.data,m=Hn(a),b=Xo(a)!==Xo(l)?`${m}:${Xo(l)}`:a;this.onChainChanged(b)}else this.events.emit(s.name,s.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var s;const{namespaces:a}=r,l=(s=this.client)==null?void 0:s.session.get(i);this.session=ec(ia({},l),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",ec(ia({},tr("USER_DISCONNECTED")),{data:i.topic}))}),this.on(wi.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=i;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(i){const[r,s]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(m=>Hn(m)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Hn(Object.keys(this.namespaces)[0]),l=this.rpcProviders[a].getDefaultChain();return[a,l]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var s;if(!this.namespaces)return;const[a,l]=this.validateChain(i);r||this.getProvider(a).setDefaultChain(l),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${dl}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${dl}/${i}`)}}const Vb=wc,Kb="wc",Bb="ethereum_provider",Gb=`${Kb}@2:${Bb}:`,Wb="https://rpc.walletconnect.com/v1/",oc=["eth_sendTransaction","personal_sign"],Jb=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],cc=["chainChanged","accountsChanged"],Qb=["chainChanged","accountsChanged","message","disconnect","connect"];var Yb=Object.defineProperty,Xb=Object.defineProperties,Zb=Object.getOwnPropertyDescriptors,wl=Object.getOwnPropertySymbols,eE=Object.prototype.hasOwnProperty,tE=Object.prototype.propertyIsEnumerable,bl=(h,i,r)=>i in h?Yb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,Kn=(h,i)=>{for(var r in i||(i={}))eE.call(i,r)&&bl(h,r,i[r]);if(wl)for(var r of wl(i))tE.call(i,r)&&bl(h,r,i[r]);return h},El=(h,i)=>Xb(h,Zb(i));function ua(h){return Number(h[0].split(":")[1])}function tc(h){return`0x${h.toString(16)}`}function rE(h){const{chains:i,optionalChains:r,methods:s,optionalMethods:a,events:l,optionalEvents:m,rpcMap:b}=h;if(!ln(i))throw new Error("Invalid chains");const I={chains:i,methods:s||oc,events:l||cc,rpcMap:Kn({},i.length?{[ua(i)]:b[ua(i)]}:{})},T=l==null?void 0:l.filter(Z=>!cc.includes(Z)),M=s==null?void 0:s.filter(Z=>!oc.includes(Z));if(!r&&!m&&!a&&!(T!=null&&T.length)&&!(M!=null&&M.length))return{required:i.length?I:void 0};const Y=(T==null?void 0:T.length)&&(M==null?void 0:M.length)||!r,X={chains:[...new Set(Y?I.chains.concat(r||[]):r)],methods:[...new Set(I.methods.concat(a!=null&&a.length?a:Jb))],events:[...new Set(I.events.concat(m!=null&&m.length?m:Qb))],rpcMap:b};return{required:i.length?I:void 0,optional:r.length?X:void 0}}class bc{constructor(){this.events=new kr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Gb,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new bc;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:s}=rE(this.rpc);try{const a=await new Promise(async(m,b)=>{var I;this.rpc.showQrModal&&((I=this.modal)==null||I.subscribeModal(T=>{!T.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),b(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(El(Kn({namespaces:Kn({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(T=>{m(T)}).catch(T=>{b(new Error(T.message))})});if(!a)return;const l=R1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:tc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",tc(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",El(Kn({},tr("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",tc(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(i){const[r,s,a]=i.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,s;const a=(r=i==null?void 0:i.chains)!=null?r:[],l=(s=i==null?void 0:i.optionalChains)!=null?s:[],m=a.concat(l);if(!m.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const b=a.length?(i==null?void 0:i.methods)||oc:[],I=a.length?(i==null?void 0:i.events)||cc:[],T=(i==null?void 0:i.optionalMethods)||[],M=(i==null?void 0:i.optionalEvents)||[],Y=(i==null?void 0:i.rpcMap)||this.buildRpcMap(m,i.projectId),X=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(Z=>this.formatChainId(Z)),optionalChains:l.map(Z=>this.formatChainId(Z)),methods:b,events:I,optionalMethods:T,optionalEvents:M,rpcMap:Y,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:X,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const s={};return i.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?ua(this.rpc.chains):ua(this.rpc.optionalChains),this.signer=await Vb.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await T1(()=>import("./index-406688cf.js").then(a=>a.i),["assets/index-406688cf.js","assets/index-6f9f7e15.js","assets/index-65982705.css"]);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Kn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:s,rpcMap:a}=i;r&&ln(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)})),s&&ln(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(l=>this.formatChainId(l)),s.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)}))}getRpcUrl(i,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[i])||`${Wb}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}const fE=bc;export{fE as EthereumProvider,Qb as OPTIONAL_EVENTS,Jb as OPTIONAL_METHODS,cc as REQUIRED_EVENTS,oc as REQUIRED_METHODS,bc as default};
